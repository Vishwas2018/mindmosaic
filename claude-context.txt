### MindMosaic Frontend Context Export
Generated on: Wed, Feb 18, 2026  9:44:57 PM

## Project Structure
```
.
docs
public
scripts
src
src/app
src/app/components
src/app/components/navigation
src/app/examples
src/app/layouts
src/app/pages
src/app/pages/admin
src/app/pages/admin/exams
src/app/pages/admin/questions
src/app/pages/admin/reporting
src/app/pages/auth
src/app/pages/parent
src/app/pages/public
src/app/pages/student
src/app/pages/system
src/app/routes
src/assets
src/assets/branding
src/components
src/components/ui
src/config
src/constants
src/context
src/contracts
src/contracts/examples
src/features
src/features/exam
src/features/exam/components
src/features/exam/hooks
src/features/exam/scoring
src/features/exam/types
src/features/exam/validation
src/features/exams
src/features/exams/components
src/features/exams/hooks
src/features/exams/types
src/features/exams/utils
src/features/marking
src/features/marking/components
src/features/marking/hooks
src/features/parent
src/features/parent/components
src/features/parent/hooks
src/features/parent/types
src/features/questions
src/features/questions/hooks
src/features/questions/types
src/features/reporting
src/features/reporting/components
src/features/reporting/hooks
src/guards
src/ingestion
src/lib
src/shared
src/shared/ui
src/styles
src/types
src/validation
summary
supabase
supabase/.temp
supabase/functions
supabase/functions/ingest-exam-package
supabase/functions/save-response
supabase/functions/score-attempt
supabase/functions/start-attempt
supabase/functions/submit-attempt
supabase/migrations
tests
tests/fixtures
tests/ingestion
tests/rls
tests/runtime
```

## Configuration Files

### package.json
```
{
  "name": "mindmosaic",
  "private": true,
  "version": "0.0.0",
  "type": "module",
  "scripts": {
    "dev": "vite",
    "build": "tsc -b && vite build",
    "lint": "eslint .",
    "lint:brand": "node scripts/lint-brand-lock.mjs",
    "validate:exams": "tsx scripts/validate-exam-examples.mjs",
    "preview": "vite preview",
    "test": "vitest run",
    "test:watch": "vitest"
  },
  "dependencies": {
    "@supabase/supabase-js": "^2.93.3",
    "ajv": "^8.17.1",
    "ajv-formats": "^3.0.1",
    "react": "^19.2.0",
    "react-dom": "^19.2.0",
    "react-router-dom": "^7.13.0",
    "zod": "^4.3.6"
  },
  "devDependencies": {
    "@eslint/js": "^9.39.1",
    "@tailwindcss/vite": "^4.1.18",
    "@types/node": "^24.10.9",
    "@types/react": "^19.2.5",
    "@types/react-dom": "^19.2.3",
    "@vitejs/plugin-react": "^5.1.1",
    "eslint": "^9.39.1",
    "eslint-plugin-react-hooks": "^7.0.1",
    "eslint-plugin-react-refresh": "^0.4.24",
    "globals": "^16.5.0",
    "tailwindcss": "^4.1.18",
    "tsx": "^4.21.0",
    "typescript": "~5.9.3",
    "typescript-eslint": "^8.46.4",
    "vite": "^7.2.4",
    "vitest": "^4.0.18"
  }
}
```

### tsconfig.json
```
{
  "files": [],
  "references": [
    { "path": "./tsconfig.app.json" },
    { "path": "./tsconfig.node.json" }
  ]
}
```

### vite.config.ts
```
import { defineConfig } from 'vite'
import react from '@vitejs/plugin-react'
import tailwindcss from '@tailwindcss/vite'
import path from 'path'

export default defineConfig({
  plugins: [react(), tailwindcss()],
  resolve: {
    alias: {
      '@': path.resolve(__dirname, './src'),
    },
  },
})
```

### tailwind.config.ts
```
import type { Config } from "tailwindcss";

export default {
  content: ["./index.html", "./src/**/*.{js,ts,jsx,tsx}"],
  theme: {
    extend: {
      colors: {
        brand: {
          primary: "var(--brand-primary)",
          primaryLight: "var(--brand-primary-light)",
          bgSoft: "var(--brand-bg-soft)",
          text: "var(--brand-text)",
          textMuted: "var(--brand-text-muted)",
          borderSubtle: "var(--brand-border-subtle)",
          accentAmber: "var(--brand-accent-amber)",
          success: "var(--brand-success)",
          danger: "var(--brand-danger)",
        },
      },
      fontFamily: {
        brand: ["var(--brand-font)"],
      },
      letterSpacing: {
        base: "var(--letter-spacing-base)",
        label: "var(--letter-spacing-label)",
        heading: "var(--letter-spacing-heading)",
      },
    },
  },
  plugins: [],
} satisfies Config;
```

### src/main.tsx
```
/**
 * MindMosaic â€” Application Entry Point
 *
 * Day 15: Added AuthProvider for real Supabase auth
 */

import { StrictMode } from "react";
import { createRoot } from "react-dom/client";
import { RouterProvider } from "react-router-dom";

import { AuthProvider } from "./context/AuthContext";
import { router } from "./app/router";

import "./index.css";

createRoot(document.getElementById("root")!).render(
  <StrictMode>
    <AuthProvider>
      <RouterProvider router={router} />
    </AuthProvider>
  </StrictMode>
);
```

## Routing & Layout

### src/app/layouts/AdminLayout.tsx
```
/**
 * MindMosaic â€” Admin Layout
 *
 * Layout for authenticated admin pages
 */

import { Outlet, useNavigate } from "react-router-dom";
import { useAuth } from "../../context/useAuth";

export function AdminLayout() {
  const { user, signOut } = useAuth();
  const navigate = useNavigate();

  const handleSignOut = async () => {
    await signOut();
    navigate("/auth/login");
  };

  return (
    <div className="min-h-screen bg-background-soft">
      {/* Header */}
      <header className="bg-white border-b border-border-subtle">
        <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
          <div className="flex items-center justify-between h-16">
            {/* Logo */}
            <div className="flex items-center gap-2">
              <span className="text-2xl" aria-hidden="true">ğŸ§ </span>
              <span className="font-semibold text-text-primary">
                MindMosaic
              </span>
              <span className="text-xs bg-red-100 text-red-800 px-2 py-0.5 rounded">
                Admin
              </span>
            </div>

            {/* User menu */}
            <div className="flex items-center gap-4">
              <span className="text-sm text-text-muted hidden sm:block">
                {user?.email}
              </span>
              <button
                onClick={handleSignOut}
                className="text-sm text-text-muted hover:text-primary-blue transition-colors"
              >
                Sign out
              </button>
            </div>
          </div>
        </div>
      </header>

      {/* Main content */}
      <main className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        <Outlet />
      </main>
    </div>
  );
}```

### src/app/layouts/AuthLayout.tsx
```
/**
 * MindMosaic â€” Auth Layout
 *
 * Layout for authentication pages (login, signup)
 */

import { Outlet, Navigate } from "react-router-dom";
import { useAuth } from "../../context/useAuth";

export function AuthLayout() {
  const { isAuthenticated, role, isLoading } = useAuth();

  // Show loading while checking auth
  if (isLoading) {
    return (
      <div className="min-h-screen flex items-center justify-center bg-background-soft">
        <div className="text-center">
          <div className="mb-4 h-8 w-8 animate-spin rounded-full border-4 border-primary-blue border-t-transparent mx-auto" />
          <p className="text-text-muted">Loading...</p>
        </div>
      </div>
    );
  }

  // Redirect to appropriate dashboard if already authenticated
  if (isAuthenticated && role) {
    return <Navigate to={`/${role}`} replace />;
  }

  return (
    <div className="min-h-screen bg-background-soft">
      <Outlet />
    </div>
  );
}
```

### src/app/layouts/ParentLayout.tsx
```
/**
 * MindMosaic â€” Parent Layout
 *
 * Layout for authenticated parent pages
 */

import { Outlet, useNavigate } from "react-router-dom";
import { useAuth } from "../../context/useAuth";

export function ParentLayout() {
  const { user, signOut } = useAuth();
  const navigate = useNavigate();

  const handleSignOut = async () => {
    await signOut();
    navigate("/auth/login");
  };

  return (
    <div className="min-h-screen bg-background-soft">
      {/* Header */}
      <header className="bg-white border-b border-border-subtle">
        <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
          <div className="flex items-center justify-between h-16">
            {/* Logo */}
            <div className="flex items-center gap-2">
              <span className="text-2xl" aria-hidden="true">
                ğŸ§ 
              </span>
              <span className="font-semibold text-text-primary">
                MindMosaic
              </span>
              <span className="text-xs bg-purple-100 text-purple-800 px-2 py-0.5 rounded">
                Parent
              </span>
            </div>

            {/* User menu */}
            <div className="flex items-center gap-4">
              <span className="text-sm text-text-muted hidden sm:block">
                {user?.email}
              </span>
              <button
                onClick={handleSignOut}
                className="text-sm text-text-muted hover:text-primary-blue transition-colors"
              >
                Sign out
              </button>
            </div>
          </div>
        </div>
      </header>

      {/* Main content */}
      <main className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        <Outlet />
      </main>
    </div>
  );
}
```

### src/app/layouts/PublicLayout.tsx
```
/**
 * MindMosaic â€” Public Layout
 *
 * Layout for public (unauthenticated) pages
 */

import { Outlet } from "react-router-dom";

export function PublicLayout() {
  return (
    <div className="min-h-screen bg-background-soft">
      <Outlet />
    </div>
  );
}
```

### src/app/layouts/StudentLayout.tsx
```
/**
 * MindMosaic â€” Student Layout
 *
 * Layout for authenticated student pages
 * Includes navigation sidebar and header
 */

import { Outlet, NavLink, useNavigate } from "react-router-dom";
import { useAuth } from "../../context/useAuth";

export function StudentLayout() {
  const { user, signOut } = useAuth();
  const navigate = useNavigate();

  const handleSignOut = async () => {
    await signOut();
    navigate("/auth/login");
  };

  return (
    <div className="min-h-screen bg-background-soft">
      {/* Header */}
      <header className="bg-white border-b border-border-subtle sticky top-0 z-20">
        <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
          <div className="flex items-center justify-between h-16">
            {/* Logo */}
            <div className="flex items-center gap-2">
              <span className="text-2xl" aria-hidden="true">
                ğŸ§ 
              </span>
              <span className="font-semibold text-text-primary">
                MindMosaic
              </span>
            </div>

            {/* User menu */}
            <div className="flex items-center gap-4">
              <span className="text-sm text-text-muted hidden sm:block">
                {user?.email}
              </span>
              <button
                onClick={handleSignOut}
                className="text-sm text-text-muted hover:text-primary-blue transition-colors"
              >
                Sign out
              </button>
            </div>
          </div>
        </div>
      </header>

      <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        <div className="flex gap-8">
          {/* Sidebar navigation */}
          <nav className="hidden md:block w-48 shrink-0">
            <ul className="space-y-1">
              <NavItem to="/student" end>
                <span aria-hidden="true">ğŸ </span> Dashboard
              </NavItem>
              <NavItem to="/student/exams">
                <span aria-hidden="true">ğŸ“</span> Practice Exams
              </NavItem>
              <NavItem to="/student/progress" disabled>
                <span aria-hidden="true">ğŸ“Š</span> My Progress
              </NavItem>
            </ul>
          </nav>

          {/* Main content */}
          <main className="flex-1 min-w-0">
            <Outlet />
          </main>
        </div>
      </div>

      {/* Mobile bottom nav */}
      <nav className="md:hidden fixed bottom-0 left-0 right-0 bg-white border-t border-border-subtle z-20">
        <div className="flex justify-around py-2">
          <MobileNavItem to="/student" end icon="ğŸ " label="Home" />
          <MobileNavItem to="/student/exams" icon="ğŸ“" label="Exams" />
          <MobileNavItem
            to="/student/progress"
            icon="ğŸ“Š"
            label="Progress"
            disabled
          />
        </div>
      </nav>
    </div>
  );
}

// =============================================================================
// Navigation Components
// =============================================================================

interface NavItemProps {
  to: string;
  children: React.ReactNode;
  end?: boolean;
  disabled?: boolean;
}

function NavItem({ to, children, end, disabled }: NavItemProps) {
  if (disabled) {
    return (
      <li>
        <span className="flex items-center gap-2 px-3 py-2 rounded-lg text-text-muted opacity-50 cursor-not-allowed">
          {children}
        </span>
      </li>
    );
  }

  return (
    <li>
      <NavLink
        to={to}
        end={end}
        className={({ isActive }) =>
          `flex items-center gap-2 px-3 py-2 rounded-lg transition-colors ${
            isActive
              ? "bg-primary-blue/10 text-primary-blue font-medium"
              : "text-text-muted hover:bg-gray-100"
          }`
        }
      >
        {children}
      </NavLink>
    </li>
  );
}

interface MobileNavItemProps {
  to: string;
  icon: string;
  label: string;
  end?: boolean;
  disabled?: boolean;
}

function MobileNavItem({ to, icon, label, end, disabled }: MobileNavItemProps) {
  if (disabled) {
    return (
      <span className="flex flex-col items-center gap-1 px-4 py-1 text-text-muted opacity-50">
        <span className="text-xl" aria-hidden="true">
          {icon}
        </span>
        <span className="text-xs">{label}</span>
      </span>
    );
  }

  return (
    <NavLink
      to={to}
      end={end}
      className={({ isActive }) =>
        `flex flex-col items-center gap-1 px-4 py-1 ${
          isActive ? "text-primary-blue" : "text-text-muted"
        }`
      }
    >
      <span className="text-xl" aria-hidden="true">
        {icon}
      </span>
      <span className="text-xs">{label}</span>
    </NavLink>
  );
}
```

## Exam Runtime (Core)

### src/app/examples/StudentExamListExample.tsx
```
/**
 * EXAMPLE: Student Exam List with Day 20 Visibility Filtering
 *
 * This file shows how to update your existing student exam list
 * to enforce Day 20 visibility rules.
 *
 * USAGE:
 * Replace your existing exam loading logic with this pattern.
 */

import { useEffect, useState } from "react";
import { supabase } from "../../lib/supabase";
import {
  filterVisibleExams,
  canStartAttempt,
  getAvailabilityStatus,
} from "../../features/exams";
import type { ExamPackage } from "../../features/exams/types/exam-publishing.types";

export function ExampleStudentExamList() {
  const [exams, setExams] = useState<ExamPackage[]>([]);
  const [loading, setLoading] = useState(true);

  const loadExams = async () => {
    setLoading(true);

    // 1. Load all packages from database
    const { data, error } = await supabase
      .from("exam_packages")
      .select("*")
      .order("created_at", { ascending: false });

    if (error) {
      console.error("Failed to load exams:", error);
      setLoading(false);
      return;
    }

    // 2. Apply Day 20 visibility filtering
    // This removes draft/archived exams and enforces availability windows
    const visibleExams = filterVisibleExams((data as ExamPackage[]) || []);

    setExams(visibleExams);
    setLoading(false);
  };

  useEffect(() => {
    // eslint-disable-next-line react-hooks/set-state-in-effect
    loadExams();
  }, []);

  if (loading) {
    return <div className="text-center text-text-muted">Loading exams...</div>;
  }

  if (exams.length === 0) {
    return (
      <div className="text-center text-text-muted">
        No exams available at this time
      </div>
    );
  }

  return (
    <div className="space-y-4">
      {exams.map((exam) => (
        <ExamCard key={exam.id} exam={exam} />
      ))}
    </div>
  );
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// Exam Card
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

function ExamCard({ exam }: { exam: ExamPackage }) {
  // Check if student can start attempt
  const { allowed, reason } = canStartAttempt(exam);

  // Get availability status for display
  const availabilityStatus = getAvailabilityStatus(exam);

  return (
    <div className="rounded-lg border border-border-subtle bg-white p-4">
      <div className="mb-2 flex items-start justify-between">
        <h3 className="font-semibold text-text-primary">{exam.title}</h3>
        <AvailabilityBadge status={availabilityStatus.status} />
      </div>

      <div className="mb-3 flex items-center gap-4 text-sm text-text-muted">
        <span>
          Year {exam.year_level} {exam.subject}
        </span>
        <span>{exam.duration_minutes} minutes</span>
        <span>{exam.total_marks} marks</span>
      </div>

      {/* Availability message */}
      {!allowed && reason && (
        <div className="mb-3 text-sm text-text-muted">{reason}</div>
      )}

      {/* Actions */}
      <div className="flex gap-2">
        {allowed ? (
          <button
            type="button"
            className="rounded-md bg-primary-blue px-4 py-2 text-sm font-medium text-white hover:bg-primary-blue-light"
          >
            Start Exam
          </button>
        ) : (
          <button
            type="button"
            disabled
            className="rounded-md bg-gray-100 px-4 py-2 text-sm font-medium text-gray-400"
          >
            {availabilityStatus.status === "upcoming"
              ? "Not Yet Available"
              : "Closed"}
          </button>
        )}
      </div>
    </div>
  );
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// Availability Badge
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

function AvailabilityBadge({
  status,
}: {
  status: "upcoming" | "open" | "closed" | "draft" | "archived";
}) {
  const styles = {
    upcoming: "bg-primary-blue/10 text-primary-blue",
    open: "bg-success-green/10 text-success-green",
    closed: "bg-text-muted/10 text-text-muted",
    draft: "bg-gray-100 text-gray-700",
    archived: "bg-text-muted/10 text-text-muted",
  };

  const labels = {
    upcoming: "Upcoming",
    open: "Open",
    closed: "Closed",
    draft: "Draft",
    archived: "Archived",
  };

  return (
    <span
      className={`rounded-full px-2.5 py-0.5 text-xs font-medium ${styles[status]}`}
    >
      {labels[status]}
    </span>
  );
}
```

### src/app/pages/admin/ExamAttempts.tsx
```
/**
 * ExamAttemptsPage â€” Admin view of all attempts for a specific exam.
 *
 * Route: /admin/exams/:id/attempts
 *
 * Shows:
 *  - ExamSummaryPanel with aggregate stats
 *  - ExamAttemptsTable with sortable rows
 *  - Clicking a row navigates to the Day 17 AttemptMarkingPage
 */

import { useParams, useNavigate } from "react-router-dom";
import { useExamAttempts } from "../../../features/reporting/hooks/useExamAttempts";
import { ExamSummaryPanel } from "../../../features/reporting/components/ExamSummaryPanel";
import { ExamAttemptsTable } from "../../../features/reporting/components/ExamAttemptsTable";

export function ExamAttemptsPage() {
  const { id: packageId } = useParams<{ id: string }>();
  const navigate = useNavigate();
  const { status, examPackage, attempts, summary, error, reload } =
    useExamAttempts(packageId);

  // â”€â”€ Loading â”€â”€
  if (status === "loading") {
    return (
      <div className="flex min-h-[60vh] items-center justify-center">
        <div className="text-center">
          <div className="mx-auto mb-3 h-8 w-8 animate-spin rounded-full border-2 border-primary-blue border-t-transparent" />
          <p className="text-sm text-text-muted">Loading exam dataâ€¦</p>
        </div>
      </div>
    );
  }

  // â”€â”€ Not found â”€â”€
  if (status === "not-found") {
    return (
      <div className="flex min-h-[60vh] items-center justify-center">
        <div className="text-center">
          <p className="text-lg font-semibold text-text-primary">
            Exam Not Found
          </p>
          <p className="mt-1 text-sm text-text-muted">
            {error ?? "The exam package could not be found."}
          </p>
          <button
            type="button"
            onClick={() => navigate("/admin/exams")}
            className="mt-4 rounded-md bg-primary-blue px-4 py-2 text-sm font-medium text-white hover:bg-primary-blue-light"
          >
            Back to Exams
          </button>
        </div>
      </div>
    );
  }

  // â”€â”€ Error â”€â”€
  if (status === "error" || !examPackage || !summary) {
    return (
      <div className="flex min-h-[60vh] items-center justify-center">
        <div className="text-center">
          <p className="text-lg font-semibold text-danger-red">
            Something went wrong
          </p>
          <p className="mt-1 text-sm text-text-muted">
            {error ?? "An unexpected error occurred."}
          </p>
          <button
            type="button"
            onClick={reload}
            className="mt-4 rounded-md bg-primary-blue px-4 py-2 text-sm font-medium text-white hover:bg-primary-blue-light"
          >
            Retry
          </button>
        </div>
      </div>
    );
  }

  return (
    <div className="mx-auto max-w-5xl px-4 py-6">
      {/* Back link */}
      <button
        type="button"
        onClick={() => navigate("/admin/exams")}
        className="mb-4 flex items-center gap-1.5 text-sm font-medium text-primary-blue hover:text-primary-blue-light"
      >
        <svg className="h-4 w-4" viewBox="0 0 20 20" fill="currentColor">
          <path
            fillRule="evenodd"
            d="M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z"
            clipRule="evenodd"
          />
        </svg>
        Back to Exams
      </button>

      {/* Page title */}
      <h1 className="mb-5 text-xl font-bold text-text-primary">
        Exam Attempts
      </h1>

      {/* Summary panel */}
      <ExamSummaryPanel examPackage={examPackage} summary={summary} />

      {/* Attempts table */}
      <div className="mt-5">
        <div className="mb-3 flex items-center justify-between">
          <p className="text-sm font-medium text-text-primary">
            All Attempts ({attempts.length})
          </p>
          <button
            type="button"
            onClick={reload}
            className="rounded-md border border-border-subtle bg-white px-3 py-1.5 text-xs font-medium text-text-muted hover:text-text-primary"
          >
            Refresh
          </button>
        </div>
        <ExamAttemptsTable
          attempts={attempts}
          onOpenAttempt={(attemptId) => navigate(`/admin/marking/${attemptId}`)}
        />
      </div>
    </div>
  );
}
```

### src/app/pages/admin/ExamList.tsx
```
/**
 * AdminExamListPage â€” Admin picks an exam to view its attempts.
 *
 * Route: /admin/exams
 *
 * This is the entry point to the Day 18 reporting flow.
 * Shows all exam packages (draft + published) with attempt counts.
 * Clicking a row navigates to /admin/exams/:id/attempts.
 */

import { useNavigate } from "react-router-dom";
import { useExamList } from "../../../features/reporting/hooks/useExamList";

export function AdminExamListPage() {
  const { status, exams, error, reload } = useExamList();
  const navigate = useNavigate();

  // â”€â”€ Loading â”€â”€
  if (status === "loading") {
    return (
      <div className="flex min-h-[60vh] items-center justify-center">
        <div className="text-center">
          <div className="mx-auto mb-3 h-8 w-8 animate-spin rounded-full border-2 border-primary-blue border-t-transparent" />
          <p className="text-sm text-text-muted">Loading examsâ€¦</p>
        </div>
      </div>
    );
  }

  // â”€â”€ Error â”€â”€
  if (status === "error") {
    return (
      <div className="flex min-h-[60vh] items-center justify-center">
        <div className="text-center">
          <p className="text-lg font-semibold text-danger-red">
            Failed to load exams
          </p>
          <p className="mt-1 text-sm text-text-muted">{error}</p>
          <button
            type="button"
            onClick={reload}
            className="mt-4 rounded-md bg-primary-blue px-4 py-2 text-sm font-medium text-white hover:bg-primary-blue-light"
          >
            Retry
          </button>
        </div>
      </div>
    );
  }

  return (
    <div className="mx-auto max-w-5xl px-4 py-6">
      <h1 className="mb-1 text-xl font-bold text-text-primary">Exam Reports</h1>
      <p className="mb-5 text-sm text-text-muted">
        Select an exam to view attempt details and performance summary.
      </p>

      {exams.length === 0 ? (
        <div className="rounded-lg border border-border-subtle bg-white p-8 text-center">
          <p className="text-sm text-text-muted">No exam packages found.</p>
        </div>
      ) : (
        <div className="overflow-hidden rounded-lg border border-border-subtle bg-white">
          <table className="w-full text-left text-sm">
            <thead>
              <tr className="border-b border-border-subtle bg-background-soft">
                <th className="px-4 py-3 font-medium text-text-muted">Exam</th>
                <th className="px-4 py-3 font-medium text-text-muted">Year</th>
                <th className="px-4 py-3 font-medium text-text-muted">
                  Subject
                </th>
                <th className="px-4 py-3 font-medium text-text-muted">
                  Status
                </th>
                <th className="px-4 py-3 font-medium text-text-muted">
                  Attempts
                </th>
                <th className="px-4 py-3 font-medium text-text-muted">
                  Action
                </th>
              </tr>
            </thead>
            <tbody>
              {exams.map((exam) => (
                <tr
                  key={exam.id}
                  className="border-b border-border-subtle last:border-b-0 hover:bg-background-soft/50"
                >
                  <td className="px-4 py-3">
                    <p className="font-medium text-text-primary">
                      {exam.title}
                    </p>
                    <p className="text-xs text-text-muted">
                      {exam.assessment_type.toUpperCase()} Â· {exam.total_marks}{" "}
                      marks
                    </p>
                  </td>
                  <td className="px-4 py-3 text-text-primary">
                    {exam.year_level}
                  </td>
                  <td className="px-4 py-3 text-text-primary capitalize">
                    {exam.subject}
                  </td>
                  <td className="px-4 py-3">
                    {exam.status === "published" ? (
                      <span className="inline-flex items-center rounded-full bg-success-green/10 px-2.5 py-0.5 text-xs font-medium text-success-green">
                        Published
                      </span>
                    ) : (
                      <span className="inline-flex items-center rounded-full bg-background-soft px-2.5 py-0.5 text-xs font-medium text-text-muted">
                        Draft
                      </span>
                    )}
                  </td>
                  <td className="px-4 py-3">
                    <span
                      className={`text-sm font-medium ${
                        exam.attempt_count > 0
                          ? "text-text-primary"
                          : "text-text-muted"
                      }`}
                    >
                      {exam.attempt_count}
                    </span>
                  </td>
                  <td className="px-4 py-3">
                    <button
                      type="button"
                      onClick={() =>
                        navigate(`/admin/exams/${exam.id}/attempts`)
                      }
                      className="rounded-md bg-primary-blue px-3 py-1.5 text-xs font-medium text-white hover:bg-primary-blue-light"
                    >
                      View
                    </button>
                  </td>
                </tr>
              ))}
            </tbody>
          </table>
        </div>
      )}
    </div>
  );
}
```

### src/app/pages/admin/exams/ExamGenerate.tsx
```
/**
 * ExamGeneratePage â€” Generate an exam from a blueprint
 *
 * Route: /admin/exams/generate
 */

import { useState } from "react";
import { useNavigate } from "react-router-dom";
import { useExamGeneration } from "../../../../features/exams/hooks/useExamGeneration";
import type {
  ExamBlueprint,
  BlueprintSection,
} from "../../../../features/questions/types/question-bank.types";

export function ExamGeneratePage() {
  const navigate = useNavigate();
  const { isGenerating, generateError, generateExam } = useExamGeneration();

  // Blueprint form state
  const [title, setTitle] = useState("");
  const [subject, setSubject] = useState("numeracy");
  const [yearLevel, setYearLevel] = useState(3);
  const [assessmentType, setAssessmentType] = useState<"naplan" | "icas">(
    "naplan",
  );
  const [durationMinutes, setDurationMinutes] = useState(60);

  // Sections
  const [sections, setSections] = useState<BlueprintSection[]>([
    {
      name: "Section 1",
      question_count: 10,
      filters: {
        difficulty: ["easy", "medium"],
        response_type: ["mcq"],
      },
    },
  ]);

  // Generation result
  const [generatedPackageId, setGeneratedPackageId] = useState<string | null>(
    null,
  );

  // Add section
  const handleAddSection = () => {
    setSections([
      ...sections,
      {
        name: `Section ${sections.length + 1}`,
        question_count: 5,
        filters: {},
      },
    ]);
  };

  // Update section
  const handleUpdateSection = (
    idx: number,
    updates: Partial<BlueprintSection>,
  ) => {
    const updated = [...sections];
    updated[idx] = { ...updated[idx], ...updates };
    setSections(updated);
  };

  // Remove section
  const handleRemoveSection = (idx: number) => {
    setSections(sections.filter((_, i) => i !== idx));
  };

  // Handle generate
  const handleGenerate = async () => {
    if (!title) {
      alert("Please enter an exam title");
      return;
    }

    if (sections.length === 0) {
      alert("Please add at least one section");
      return;
    }

    const blueprint: ExamBlueprint = {
      title,
      subject,
      year_level: yearLevel,
      assessment_type: assessmentType,
      duration_minutes: durationMinutes,
      sections,
    };

    const result = await generateExam(blueprint);

    if (result.success && result.exam) {
      setGeneratedPackageId(result.exam.package_id);
    }
  };

  // Success view
  if (generatedPackageId) {
    return (
      <div className="mx-auto max-w-2xl px-4 py-6">
        <div className="rounded-lg border border-success-green bg-success-green/5 p-8 text-center">
          <div className="mb-4 text-5xl">âœ“</div>
          <h2 className="mb-2 text-xl font-semibold text-text-primary">
            Exam Generated Successfully
          </h2>
          <p className="mb-6 text-sm text-text-muted">
            Your exam package has been created in draft status.
          </p>
          <div className="flex justify-center gap-3">
            <button
              type="button"
              onClick={() =>
                navigate(`/admin/exams/${generatedPackageId}/attempts`)
              }
              className="rounded-md bg-primary-blue px-4 py-2 text-sm font-medium text-white hover:bg-primary-blue-light"
            >
              View Exam
            </button>
            <button
              type="button"
              onClick={() => {
                setGeneratedPackageId(null);
                setTitle("");
                setSections([
                  {
                    name: "Section 1",
                    question_count: 10,
                    filters: {
                      difficulty: ["easy", "medium"],
                      response_type: ["mcq"],
                    },
                  },
                ]);
              }}
              className="rounded-md border border-border-subtle bg-white px-4 py-2 text-sm font-medium text-text-primary hover:bg-background-soft"
            >
              Generate Another
            </button>
          </div>
        </div>
      </div>
    );
  }

  return (
    <div className="mx-auto max-w-4xl px-4 py-6">
      {/* Header */}
      <div className="mb-6">
        <h1 className="text-xl font-bold text-text-primary">
          Generate Exam from Blueprint
        </h1>
        <p className="mt-1 text-sm text-text-muted">
          Define selection rules to automatically generate an exam from the
          question bank
        </p>
      </div>

      {/* Form */}
      <div className="space-y-6 rounded-lg border border-border-subtle bg-white p-6">
        {/* Basic Info */}
        <div className="space-y-4">
          <h3 className="font-semibold text-text-primary">Exam Details</h3>

          <div>
            <label className="mb-1 block text-sm font-medium text-text-primary">
              Title
            </label>
            <input
              type="text"
              value={title}
              onChange={(e) => setTitle(e.target.value)}
              placeholder="e.g., Year 3 Numeracy Practice Test"
              className="w-full rounded-md border border-border-subtle px-3 py-2 text-sm"
            />
          </div>

          <div className="grid gap-4 sm:grid-cols-3">
            <div>
              <label className="mb-1 block text-sm font-medium text-text-primary">
                Subject
              </label>
              <select
                value={subject}
                onChange={(e) => setSubject(e.target.value)}
                className="w-full rounded-md border border-border-subtle px-3 py-2 text-sm"
              >
                <option value="numeracy">Numeracy</option>
                <option value="reading">Reading</option>
                <option value="writing">Writing</option>
                <option value="language-conventions">
                  Language Conventions
                </option>
                <option value="mathematics">Mathematics</option>
                <option value="english">English</option>
                <option value="science">Science</option>
              </select>
            </div>

            <div>
              <label className="mb-1 block text-sm font-medium text-text-primary">
                Year Level
              </label>
              <input
                type="number"
                min={1}
                max={9}
                value={yearLevel}
                onChange={(e) => setYearLevel(parseInt(e.target.value) || 3)}
                className="w-full rounded-md border border-border-subtle px-3 py-2 text-sm"
              />
            </div>

            <div>
              <label className="mb-1 block text-sm font-medium text-text-primary">
                Assessment Type
              </label>
              <select
                value={assessmentType}
                onChange={(e) =>
                  setAssessmentType(e.target.value as "naplan" | "icas")
                }
                className="w-full rounded-md border border-border-subtle px-3 py-2 text-sm"
              >
                <option value="naplan">NAPLAN</option>
                <option value="icas">ICAS</option>
              </select>
            </div>
          </div>

          <div>
            <label className="mb-1 block text-sm font-medium text-text-primary">
              Duration (minutes)
            </label>
            <input
              type="number"
              min={5}
              max={180}
              value={durationMinutes}
              onChange={(e) =>
                setDurationMinutes(parseInt(e.target.value) || 60)
              }
              className="w-full rounded-md border border-border-subtle px-3 py-2 text-sm"
            />
          </div>
        </div>

        {/* Sections */}
        <div className="border-t border-border-subtle pt-6">
          <div className="mb-4 flex items-center justify-between">
            <h3 className="font-semibold text-text-primary">Sections</h3>
            <button
              type="button"
              onClick={handleAddSection}
              className="text-sm text-primary-blue hover:underline"
            >
              + Add Section
            </button>
          </div>

          <div className="space-y-4">
            {sections.map((section, idx) => (
              <SectionEditor
                key={idx}
                section={section}
                onUpdate={(updates) => handleUpdateSection(idx, updates)}
                onRemove={() => handleRemoveSection(idx)}
                canRemove={sections.length > 1}
              />
            ))}
          </div>
        </div>

        {/* Error */}
        {generateError && (
          <div className="rounded-md bg-danger-red/10 px-4 py-3 text-sm text-danger-red">
            {generateError}
          </div>
        )}

        {/* Actions */}
        <div className="flex justify-end gap-3 border-t border-border-subtle pt-4">
          <button
            type="button"
            onClick={() => navigate("/admin/exams")}
            disabled={isGenerating}
            className="rounded-md border border-border-subtle bg-white px-4 py-2 text-sm font-medium text-text-primary hover:bg-background-soft disabled:opacity-50"
          >
            Cancel
          </button>
          <button
            type="button"
            onClick={handleGenerate}
            disabled={isGenerating}
            className="rounded-md bg-primary-blue px-4 py-2 text-sm font-medium text-white hover:bg-primary-blue-light disabled:opacity-50"
          >
            {isGenerating ? "Generating..." : "Generate Exam"}
          </button>
        </div>
      </div>
    </div>
  );
}

// â”€â”€ Section Editor â”€â”€

interface SectionEditorProps {
  section: BlueprintSection;
  onUpdate: (updates: Partial<BlueprintSection>) => void;
  onRemove: () => void;
  canRemove: boolean;
}

function SectionEditor({
  section,
  onUpdate,
  onRemove,
  canRemove,
}: SectionEditorProps) {
  return (
    <div className="rounded-md border border-border-subtle bg-background-soft p-4">
      <div className="mb-3 flex items-center justify-between">
        <input
          type="text"
          value={section.name}
          onChange={(e) => onUpdate({ name: e.target.value })}
          placeholder="Section name"
          className="rounded-md border border-border-subtle bg-white px-3 py-1.5 text-sm font-medium"
        />
        {canRemove && (
          <button
            type="button"
            onClick={onRemove}
            className="text-sm text-danger-red hover:underline"
          >
            Remove
          </button>
        )}
      </div>

      <div className="space-y-3">
        {/* Question count */}
        <div>
          <label className="mb-1 block text-xs font-medium text-text-muted">
            Number of Questions
          </label>
          <input
            type="number"
            min={1}
            value={section.question_count}
            onChange={(e) =>
              onUpdate({ question_count: parseInt(e.target.value) || 1 })
            }
            className="w-full rounded-md border border-border-subtle bg-white px-3 py-1.5 text-sm"
          />
        </div>

        {/* Filters */}
        <div>
          <label className="mb-1 block text-xs font-medium text-text-muted">
            Filters (optional)
          </label>
          <div className="space-y-2">
            {/* Difficulty */}
            <div className="flex items-center gap-2">
              <span className="text-xs text-text-muted">Difficulty:</span>
              <div className="flex gap-2">
                {(["easy", "medium", "hard"] as const).map((d) => (
                  <label key={d} className="flex items-center gap-1 text-xs">
                    <input
                      type="checkbox"
                      checked={section.filters.difficulty?.includes(d)}
                      onChange={(e) => {
                        const current = section.filters.difficulty || [];
                        const updated = e.target.checked
                          ? [...current, d]
                          : current.filter((x) => x !== d);
                        onUpdate({
                          filters: { ...section.filters, difficulty: updated },
                        });
                      }}
                      className="rounded"
                    />
                    {d}
                  </label>
                ))}
              </div>
            </div>

            {/* Type */}
            <div className="flex items-center gap-2">
              <span className="text-xs text-text-muted">Type:</span>
              <div className="flex flex-wrap gap-2">
                {(
                  ["mcq", "multi", "short", "extended", "numeric"] as const
                ).map((t) => (
                  <label key={t} className="flex items-center gap-1 text-xs">
                    <input
```

### src/app/pages/admin/exams/ExamPublish.tsx
```
/**
 * ExamPublishPage â€” Manage exam lifecycle and scheduling
 *
 * Route: /admin/exams/:id/publish
 */

import { useEffect, useState } from "react";
import { useParams, Link } from "react-router-dom";
import { supabase } from "../../../../lib/supabase";
import { ExamPublishControls } from "../../../../features/exams/components/ExamPublishControls";
import type { ExamPackage } from "../../../../features/exams/types/exam-publishing.types";

export function ExamPublishPage() {
  const { id } = useParams<{ id: string }>();
  const [status, setStatus] = useState<"idle" | "loading" | "error">("idle");
  const [exam, setExam] = useState<ExamPackage | null>(null);
  const [error, setError] = useState<string | null>(null);

  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  // Load Exam
  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  useEffect(() => {
    if (!id) return;

    const loadExam = async () => {
      setStatus("loading");
      setError(null);

      try {
        const { data, error: err } = await supabase
          .from("exam_packages")
          .select("*")
          .eq("id", id)
          .single();

        if (err) throw err;

        if (!data) {
          throw new Error("Exam not found");
        }

        setExam(data as ExamPackage);
        setStatus("idle");
      } catch (err) {
        const message =
          err instanceof Error ? err.message : "Failed to load exam";
        setError(message);
        setStatus("error");
      }
    };

    loadExam();
  }, [id]);

  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  // Handle Status Change
  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  const handleStatusChange = async () => {
    // Reload exam to get updated status
    if (!id) return;

    const { data } = await supabase
      .from("exam_packages")
      .select("*")
      .eq("id", id)
      .single();

    if (data) {
      setExam(data as ExamPackage);
    }
  };

  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  // Render Loading
  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  if (status === "loading") {
    return (
      <div className="mx-auto max-w-3xl px-4 py-6">
        <div className="text-center text-text-muted">Loading exam...</div>
      </div>
    );
  }

  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  // Render Error
  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  if (status === "error" || !exam) {
    return (
      <div className="mx-auto max-w-3xl px-4 py-6">
        <div className="rounded-md bg-danger-red/10 px-4 py-3 text-sm text-danger-red">
          {error || "Exam not found"}
        </div>
        <div className="mt-4">
          <Link
            to="/admin/exams"
            className="text-sm text-primary-blue hover:underline"
          >
            â† Back to Exams
          </Link>
        </div>
      </div>
    );
  }

  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  // Render Main
  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  return (
    <div className="mx-auto max-w-3xl px-4 py-6">
      {/* Header */}
      <div className="mb-6">
        <Link
          to="/admin/exams"
          className="mb-2 inline-block text-sm text-primary-blue hover:underline"
        >
          â† Back to Exams
        </Link>
        <h1 className="text-xl font-bold text-text-primary">{exam.title}</h1>
        <div className="mt-1 flex items-center gap-4 text-sm text-text-muted">
          <span>
            Year {exam.year_level} {exam.subject}
          </span>
          <span>{exam.duration_minutes} minutes</span>
          <span>{exam.total_marks} marks</span>
        </div>
      </div>

      {/* Publishing Controls */}
      <div className="rounded-lg border border-border-subtle bg-white p-6">
        <h2 className="mb-4 font-semibold text-text-primary">
          Exam Lifecycle & Scheduling
        </h2>
        <ExamPublishControls exam={exam} onStatusChange={handleStatusChange} />
      </div>

      {/* Info Boxes */}
      <div className="mt-6 space-y-4">
        <InfoBox
          title="Lifecycle Rules"
          items={[
            "Draft: Editable by admins, hidden from students",
            "Published: Read-only, visible to students",
            "Archived: Hidden from students, preserved for reporting",
          ]}
        />

        <InfoBox
          title="Scheduling"
          items={[
            "Set availability window to control when students can start attempts",
            "Students can still review submitted attempts after window closes",
            "Leave blank for immediate/indefinite availability",
          ]}
        />

        {exam.status === "published" && (
          <InfoBox
            title="Important"
            items={[
              "Published exams cannot be edited",
              "To make changes, unpublish first (only if no student attempts exist)",
              "If attempts exist, archive this version and create a new exam",
            ]}
            variant="warning"
          />
        )}
      </div>
    </div>
  );
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// Info Box
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

interface InfoBoxProps {
  title: string;
  items: string[];
  variant?: "info" | "warning";
}

function InfoBox({ title, items, variant = "info" }: InfoBoxProps) {
  const styles = {
    info: "bg-primary-blue/5 border-primary-blue/20",
    warning: "bg-accent-amber/10 border-accent-amber/30",
  };

  return (
    <div className={`rounded-md border p-4 ${styles[variant]}`}>
      <div className="mb-2 text-sm font-medium text-text-primary">{title}</div>
      <ul className="space-y-1 text-sm text-text-muted">
        {items.map((item, idx) => (
          <li key={idx} className="flex gap-2">
            <span className="text-text-muted">â€¢</span>
            <span>{item}</span>
          </li>
        ))}
      </ul>
    </div>
  );
}
```

### src/app/pages/admin/questions/QuestionEditor.tsx
```
/**
 * QuestionEditorPage â€” Create or edit a question
 *
 * Routes:
 * - /admin/questions/create (new)
 * - /admin/questions/edit/:id (edit)
 */

import { useState, useEffect } from "react";
import { useParams, useNavigate } from "react-router-dom";
import { supabase } from "../../../../lib/supabase";
import {
  useQuestionEditor,
  type SaveQuestionInput,
} from "../../../../features/questions/hooks/useQuestionEditor";
import type {
  PromptBlock,
  QuestionOption,
  CorrectAnswer,
} from "../../../../features/questions/types/question-bank.types";

export function QuestionEditorPage() {
  const { id } = useParams<{ id: string }>();
  const navigate = useNavigate();
  const { isSaving, saveError, saveQuestion, deleteQuestion } =
    useQuestionEditor();

  const isEdit = !!id;

  // Form state
  const [difficulty, setDifficulty] = useState<"easy" | "medium" | "hard">(
    "medium",
  );
  const [responseType, setResponseType] = useState<
    "mcq" | "multi" | "short" | "extended" | "numeric"
  >("mcq");
  const [marks, setMarks] = useState(1);
  const [tags, setTags] = useState<string[]>([]);
  const [tagInput, setTagInput] = useState("");
  const [hint, setHint] = useState("");

  // Prompt blocks
  const [promptBlocks, setPromptBlocks] = useState<PromptBlock[]>([
    { type: "text", content: "" },
  ]);

  // MCQ options
  const [options, setOptions] = useState<QuestionOption[]>([
    { question_id: "", option_id: "A", content: "", media_reference: null },
    { question_id: "", option_id: "B", content: "", media_reference: null },
    { question_id: "", option_id: "C", content: "", media_reference: null },
    { question_id: "", option_id: "D", content: "", media_reference: null },
  ]);

  // Correct answer
  const [correctAnswer, setCorrectAnswer] = useState<Partial<CorrectAnswer>>({
    answer_type: "mcq",
    correct_option_id: "A",
  });

  // Loading state
  const [isLoading, setIsLoading] = useState(isEdit);

  // Load existing question if editing
  useEffect(() => {
    const questionId = id ?? "";
    if (!isEdit || questionId === "") return;

    async function load() {
      try {
        const { data: q, error: qErr } = await supabase
          .from("exam_questions")
          .select("*")
          .eq("id", questionId)
          .single();

        if (qErr) throw qErr;

        const question = q as {
          difficulty: "easy" | "medium" | "hard";
          response_type: "mcq" | "multi" | "short" | "extended" | "numeric";
          marks: number;
          tags: string[] | null;
          hint: string | null;
          prompt_blocks: unknown;
        };

        setDifficulty(question.difficulty);
        setResponseType(question.response_type);
        setMarks(question.marks);
        setTags(question.tags ?? []);
        setHint(question.hint ?? "");
        setPromptBlocks(
          Array.isArray(question.prompt_blocks) && question.prompt_blocks.length > 0
            ? (question.prompt_blocks as PromptBlock[])
            : [{ type: "text", content: "" }],
        );

        // Load options if MCQ
        if (
          question.response_type === "mcq" ||
          question.response_type === "multi"
        ) {
          const { data: opts } = await supabase
            .from("exam_question_options")
            .select("*")
            .eq("question_id", questionId)
            .order("option_id");

          if (opts && opts.length > 0) {
            setOptions(opts as QuestionOption[]);
          }
        }

        // Load correct answer
        const { data: ans } = await supabase
          .from("exam_correct_answers")
          .select("*")
          .eq("question_id", questionId)
          .single();

        if (ans) {
          setCorrectAnswer(ans as Partial<CorrectAnswer>);
        }

        setIsLoading(false);
      } catch (err) {
        console.error("Failed to load question:", err);
        setIsLoading(false);
      }
    }

    load();
  }, [isEdit, id]);

  // Handle save
  const handleSave = async () => {
    // Validation
    const firstBlock = promptBlocks[0];
    if (
      promptBlocks.length === 0 ||
      firstBlock.type !== "text" ||
      !firstBlock.content.trim()
    ) {
      alert("Please add question content");
      return;
    }

    if (
      (responseType === "mcq" || responseType === "multi") &&
      options.some((o) => !o.content)
    ) {
      alert("Please fill in all options");
      return;
    }

    const input: SaveQuestionInput = {
      id: isEdit ? id : undefined,
      exam_package_id: "question-bank", // Special package ID for bank
      sequence_number: 1, // Will be overridden during generation
      difficulty,
      response_type: responseType,
      marks,
      prompt_blocks: promptBlocks as unknown[],
      tags,
      hint: hint || null,
      options:
        responseType === "mcq" || responseType === "multi"
          ? options
          : undefined,
      correctAnswer: correctAnswer as CorrectAnswer,
    };

    const result = await saveQuestion(input);

    if (result.success) {
      navigate("/admin/questions");
    }
  };

  // Handle delete
  const handleDelete = async () => {
    if (!id) return;
    if (!confirm("Delete this question? This cannot be undone.")) return;

    const result = await deleteQuestion(id);

    if (result.success) {
      navigate("/admin/questions");
    }
  };

  // Add tag
  const handleAddTag = () => {
    if (tagInput && !tags.includes(tagInput)) {
      setTags([...tags, tagInput]);
      setTagInput("");
    }
  };

  if (isLoading) {
    return (
      <div className="flex min-h-[60vh] items-center justify-center">
        <div className="text-center">
          <div className="mx-auto mb-3 h-8 w-8 animate-spin rounded-full border-2 border-primary-blue border-t-transparent" />
          <p className="text-sm text-text-muted">Loading questionâ€¦</p>
        </div>
      </div>
    );
  }

  return (
    <div className="mx-auto max-w-4xl px-4 py-6">
      {/* Header */}
      <div className="mb-6">
        <button
          type="button"
          onClick={() => navigate("/admin/questions")}
          className="mb-2 text-sm text-primary-blue hover:underline"
        >
          â† Back to Question Bank
        </button>
        <h1 className="text-xl font-bold text-text-primary">
          {isEdit ? "Edit Question" : "Create Question"}
        </h1>
      </div>

      {/* Form */}
      <div className="space-y-6 rounded-lg border border-border-subtle bg-white p-6">
        {/* Type & Difficulty */}
        <div className="grid gap-4 sm:grid-cols-2">
          <div>
            <label className="mb-1 block text-sm font-medium text-text-primary">
              Question Type
            </label>
            <select
              value={responseType}
              onChange={(e) =>
                setResponseType(e.target.value as typeof responseType)
              }
              className="w-full rounded-md border border-border-subtle px-3 py-2 text-sm"
            >
              <option value="mcq">Multiple Choice</option>
              <option value="multi">Multi-Select</option>
              <option value="short">Short Answer</option>
              <option value="extended">Extended Response</option>
              <option value="numeric">Numeric</option>
            </select>
          </div>

          <div>
            <label className="mb-1 block text-sm font-medium text-text-primary">
              Difficulty
            </label>
            <select
              value={difficulty}
              onChange={(e) =>
                setDifficulty(e.target.value as typeof difficulty)
              }
              className="w-full rounded-md border border-border-subtle px-3 py-2 text-sm"
            >
              <option value="easy">Easy</option>
              <option value="medium">Medium</option>
              <option value="hard">Hard</option>
            </select>
          </div>
        </div>

        {/* Marks */}
        <div>
          <label className="mb-1 block text-sm font-medium text-text-primary">
            Marks
          </label>
          <input
            type="number"
            min={1}
            max={10}
            value={marks}
            onChange={(e) => setMarks(parseInt(e.target.value) || 1)}
            className="w-full rounded-md border border-border-subtle px-3 py-2 text-sm"
          />
        </div>

        {/* Prompt */}
        <div>
          <label className="mb-1 block text-sm font-medium text-text-primary">
            Question Content
          </label>
          {promptBlocks.map((block, idx) => (
            <div key={idx} className="mb-2">
              <textarea
                value={block.type === "text" ? block.content : ""}
                onChange={(e) => {
                  const updated = [...promptBlocks];
                  updated[idx] = { type: "text", content: e.target.value };
                  setPromptBlocks(updated);
                }}
                rows={4}
                className="w-full rounded-md border border-border-subtle px-3 py-2 text-sm"
                placeholder="Enter question text..."
              />
            </div>
          ))}
        </div>

        {/* Options (MCQ/Multi only) */}
        {(responseType === "mcq" || responseType === "multi") && (
          <div>
            <label className="mb-2 block text-sm font-medium text-text-primary">
              Answer Options
            </label>
            <div className="space-y-2">
              {options.map((opt, idx) => (
                <div key={opt.option_id} className="flex items-center gap-2">
                  <span className="text-sm font-medium text-text-muted">
                    {opt.option_id}.
                  </span>
                  <input
                    type="text"
                    value={opt.content}
                    onChange={(e) => {
                      const updated = [...options];
                      updated[idx].content = e.target.value;
                      setOptions(updated);
                    }}
                    className="flex-1 rounded-md border border-border-subtle px-3 py-2 text-sm"
                    placeholder={`Option ${opt.option_id}`}
                  />
                </div>
              ))}
            </div>
          </div>
        )}

        {/* Correct Answer */}
        <div>
          <label className="mb-1 block text-sm font-medium text-text-primary">
            Correct Answer
          </label>
          {responseType === "mcq" && (
            <select
              value={correctAnswer.correct_option_id || "A"}
              onChange={(e) =>
                setCorrectAnswer({
                  ...correctAnswer,
                  correct_option_id: e.target.value,
                })
              }
              className="w-full rounded-md border border-border-subtle px-3 py-2 text-sm"
            >
              <option value="A">A</option>
              <option value="B">B</option>
              <option value="C">C</option>
              <option value="D">D</option>
            </select>
          )}
          {responseType === "short" && (
            <input
              type="text"
              value={
                Array.isArray(correctAnswer.accepted_answers)
                  ? (correctAnswer.accepted_answers as string[])[0] || ""
                  : ""
              }
              onChange={(e) =>
                setCorrectAnswer({
                  ...correctAnswer,
                  accepted_answers: [e.target.value],
                })
              }
              placeholder="Expected answer"
              className="w-full rounded-md border border-border-subtle px-3 py-2 text-sm"
            />
          )}
          {responseType === "numeric" && (
            <input
              type="number"
              value={correctAnswer.exact_value ?? ""}
              onChange={(e) =>
                setCorrectAnswer({
                  ...correctAnswer,
                  exact_value: parseFloat(e.target.value) || null,
                })
              }
              placeholder="Numeric answer"
              className="w-full rounded-md border border-border-subtle px-3 py-2 text-sm"
            />
          )}
          {responseType === "extended" && (
            <p className="text-sm text-text-muted">
              Extended responses require manual marking
            </p>
          )}
        </div>

        {/* Tags */}
        <div>
          <label className="mb-1 block text-sm font-medium text-text-primary">
            Tags
          </label>
```

### src/app/pages/admin/questions/QuestionList.tsx
```
/**
 * QuestionListPage â€” Admin view of all questions in the bank
 *
 * Route: /admin/questions
 */

import { useState } from "react";
import { useNavigate } from "react-router-dom";
import { useQuestions } from "../../../../features/questions/hooks/useQuestions";
import type {
  QuestionWithAnswer,
  PromptBlock,
} from "../../../../features/questions/types/question-bank.types";

type FilterDifficulty = "all" | "easy" | "medium" | "hard";
type FilterType = "all" | "mcq" | "multi" | "short" | "extended" | "numeric";

export function QuestionListPage() {
  const { status, questions, error, reload } = useQuestions();
  const navigate = useNavigate();

  const [difficultyFilter, setDifficultyFilter] =
    useState<FilterDifficulty>("all");
  const [typeFilter, setTypeFilter] = useState<FilterType>("all");
  const [searchQuery, setSearchQuery] = useState("");

  // Filter questions
  const filtered = questions.filter((q) => {
    if (difficultyFilter !== "all" && q.difficulty !== difficultyFilter)
      return false;
    if (typeFilter !== "all" && q.response_type !== typeFilter) return false;
    if (searchQuery) {
      const query = searchQuery.toLowerCase();
      const tagsMatch = q.tags.some((tag) => tag.toLowerCase().includes(query));
      const promptMatch = JSON.stringify(q.prompt_blocks)
        .toLowerCase()
        .includes(query);
      if (!tagsMatch && !promptMatch) return false;
    }
    return true;
  });

  if (status === "loading") {
    return (
      <div className="flex min-h-[60vh] items-center justify-center">
        <div className="text-center">
          <div className="mx-auto mb-3 h-8 w-8 animate-spin rounded-full border-2 border-primary-blue border-t-transparent" />
          <p className="text-sm text-text-muted">Loading questionsâ€¦</p>
        </div>
      </div>
    );
  }

  if (status === "error") {
    return (
      <div className="flex min-h-[60vh] items-center justify-center">
        <div className="text-center">
          <p className="text-lg font-semibold text-danger-red">
            Failed to load questions
          </p>
          <p className="mt-1 text-sm text-text-muted">{error}</p>
          <button
            type="button"
            onClick={reload}
            className="mt-4 rounded-md bg-primary-blue px-4 py-2 text-sm font-medium text-white hover:bg-primary-blue-light"
          >
            Retry
          </button>
        </div>
      </div>
    );
  }

  return (
    <div className="mx-auto max-w-7xl px-4 py-6">
      {/* Header */}
      <div className="mb-6 flex items-center justify-between">
        <div>
          <h1 className="text-xl font-bold text-text-primary">Question Bank</h1>
          <p className="mt-1 text-sm text-text-muted">
            {questions.length} questions available
          </p>
        </div>
        <button
          type="button"
          onClick={() => navigate("/admin/questions/create")}
          className="rounded-md bg-primary-blue px-4 py-2 text-sm font-medium text-white hover:bg-primary-blue-light"
        >
          Create Question
        </button>
      </div>

      {/* Filters */}
      <div className="mb-4 flex flex-wrap gap-3">
        {/* Search */}
        <input
          type="text"
          value={searchQuery}
          onChange={(e) => setSearchQuery(e.target.value)}
          placeholder="Search tags or contentâ€¦"
          className="rounded-md border border-border-subtle px-3 py-2 text-sm"
        />

        {/* Difficulty */}
        <select
          value={difficultyFilter}
          onChange={(e) =>
            setDifficultyFilter(e.target.value as FilterDifficulty)
          }
          className="rounded-md border border-border-subtle px-3 py-2 text-sm"
        >
          <option value="all">All Difficulties</option>
          <option value="easy">Easy</option>
          <option value="medium">Medium</option>
          <option value="hard">Hard</option>
        </select>

        {/* Type */}
        <select
          value={typeFilter}
          onChange={(e) => setTypeFilter(e.target.value as FilterType)}
          className="rounded-md border border-border-subtle px-3 py-2 text-sm"
        >
          <option value="all">All Types</option>
          <option value="mcq">Multiple Choice</option>
          <option value="multi">Multi-Select</option>
          <option value="short">Short Answer</option>
          <option value="extended">Extended Response</option>
          <option value="numeric">Numeric</option>
        </select>

        {/* Clear */}
        {(difficultyFilter !== "all" ||
          typeFilter !== "all" ||
          searchQuery) && (
          <button
            type="button"
            onClick={() => {
              setDifficultyFilter("all");
              setTypeFilter("all");
              setSearchQuery("");
            }}
            className="text-sm text-text-muted hover:text-text-primary"
          >
            Clear filters
          </button>
        )}
      </div>

      {/* Results count */}
      <p className="mb-3 text-sm text-text-muted">
        Showing {filtered.length} of {questions.length} questions
      </p>

      {/* Question list */}
      {filtered.length === 0 ? (
        <div className="rounded-lg border border-border-subtle bg-white p-8 text-center">
          <p className="text-sm text-text-muted">
            {questions.length === 0
              ? "No questions in the bank yet."
              : "No questions match your filters."}
          </p>
        </div>
      ) : (
        <div className="space-y-3">
          {filtered.map((q) => (
            <QuestionCard
              key={q.id}
              question={q}
              onEdit={() => navigate(`/admin/questions/edit/${q.id}`)}
            />
          ))}
        </div>
      )}
    </div>
  );
}

// â”€â”€ Question Card â”€â”€

interface QuestionCardProps {
  question: QuestionWithAnswer;
  onEdit: () => void;
}

function QuestionCard({ question, onEdit }: QuestionCardProps) {
  // Extract first text block for preview
  const firstText = question.prompt_blocks.find(
    (b: PromptBlock) => b.type === "text",
  )?.content;

  return (
    <div className="rounded-lg border border-border-subtle bg-white p-4 hover:shadow-sm">
      <div className="flex items-start justify-between gap-4">
        <div className="flex-1 min-w-0">
          {/* Preview */}
          <p className="text-sm text-text-primary line-clamp-2">
            {firstText || "[Question content]"}
          </p>

          {/* Metadata */}
          <div className="mt-2 flex flex-wrap items-center gap-2">
            <span
              className={`rounded-full px-2 py-0.5 text-xs font-medium ${
                question.difficulty === "easy"
                  ? "bg-success-green/10 text-success-green"
                  : question.difficulty === "hard"
                    ? "bg-danger-red/10 text-danger-red"
                    : "bg-accent-amber/10 text-accent-amber"
              }`}
            >
              {question.difficulty}
            </span>

            <span className="rounded-full bg-background-soft px-2 py-0.5 text-xs font-medium text-text-muted">
              {formatType(question.response_type)}
            </span>

            <span className="text-xs text-text-muted">
              {question.marks} {question.marks === 1 ? "mark" : "marks"}
            </span>

            {question.tags.length > 0 && (
              <span className="text-xs text-text-muted">
                Tags: {question.tags.join(", ")}
              </span>
            )}
          </div>
        </div>

        {/* Actions */}
        <button
          type="button"
          onClick={onEdit}
          className="shrink-0 rounded-md bg-primary-blue px-3 py-1.5 text-xs font-medium text-white hover:bg-primary-blue-light"
        >
          Edit
        </button>
      </div>
    </div>
  );
}

function formatType(type: string): string {
  const labels: Record<string, string> = {
    mcq: "Multiple Choice",
    multi: "Multi-Select",
    short: "Short Answer",
    extended: "Extended Response",
    numeric: "Numeric",
  };
  return labels[type] ?? type;
}
```

### src/app/pages/parent/ExamResults.tsx
```
/**
 * ParentExamResults â€” Detailed exam result view (read-only)
 *
 * Route: /parent/exams/:attemptId
 */

import { useParams, Link } from "react-router-dom";
import { useChildProfile } from "../../../features/parent/hooks/useChildProfile";
import { useParentExamDetail } from "../../../features/parent/hooks/useParentExamDetail";

export function ParentExamResults() {
  const { attemptId } = useParams<{ attemptId: string }>();
  const { child } = useChildProfile();
  const { status, result, error } = useParentExamDetail(
    child?.id || null,
    attemptId || null,
  );

  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  // Loading State
  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  if (status === "loading" || !child) {
    return (
      <div className="mx-auto max-w-4xl px-4 py-6">
        <div className="text-center text-text-muted">Loading results...</div>
      </div>
    );
  }

  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  // Error State
  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  if (status === "error" || !result) {
    return (
      <div className="mx-auto max-w-4xl px-4 py-6">
        <div className="mb-4">
          <Link
            to="/parent"
            className="text-sm text-primary-blue hover:underline"
          >
            â† Back to Dashboard
          </Link>
        </div>
        <div className="rounded-md bg-danger-red/10 px-4 py-3 text-sm text-danger-red">
          {error || "Unable to load exam results"}
        </div>
      </div>
    );
  }

  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  // Main View
  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  return (
    <div className="mx-auto max-w-4xl px-4 py-6">
      {/* Header */}
      <div className="mb-6">
        <Link
          to="/parent"
          className="mb-2 inline-block text-sm text-primary-blue hover:underline"
        >
          â† Back to Dashboard
        </Link>
        <h1 className="text-xl font-bold text-text-primary">
          {result.exam_title}
        </h1>
        <div className="mt-1 flex items-center gap-4 text-sm text-text-muted">
          <span>Year {result.year_level}</span>
          <span>{result.subject}</span>
          <span>
            Submitted {new Date(result.submitted_at).toLocaleDateString()}
          </span>
        </div>
      </div>

      {/* Overall Score */}
      <div className="mb-6 rounded-lg border border-border-subtle bg-white p-6">
        <h2 className="mb-4 font-semibold text-text-primary">Overall Score</h2>
        <div className="flex items-baseline gap-2">
          <div className="text-4xl font-bold text-text-primary">
            {result.total_score}
          </div>
          <div className="text-xl text-text-muted">
            / {result.total_marks} marks
          </div>
          <div className="ml-4 rounded-full bg-primary-blue/10 px-3 py-1 text-lg font-semibold text-primary-blue">
            {result.percentage}%
          </div>
        </div>
      </div>

      {/* Question Breakdown */}
      <div className="rounded-lg border border-border-subtle bg-white p-6">
        <h2 className="mb-4 font-semibold text-text-primary">
          Question Breakdown
        </h2>
        <p className="mb-4 text-sm text-text-muted">
          Individual question marks (question content not shown for privacy)
        </p>

        <div className="overflow-hidden rounded-md border border-border-subtle">
          <table className="w-full">
            <thead className="bg-background-soft">
              <tr>
                <th className="px-4 py-2 text-left text-sm font-medium text-text-primary">
                  Question
                </th>
                <th className="px-4 py-2 text-left text-sm font-medium text-text-primary">
                  Type
                </th>
                <th className="px-4 py-2 text-center text-sm font-medium text-text-primary">
                  Marks Available
                </th>
                <th className="px-4 py-2 text-center text-sm font-medium text-text-primary">
                  Marks Awarded
                </th>
                <th className="px-4 py-2 text-center text-sm font-medium text-text-primary">
                  Result
                </th>
              </tr>
            </thead>
            <tbody className="divide-y divide-border-subtle">
              {result.questions.map((q) => {
                const isCorrect =
                  q.marks_awarded !== null &&
                  q.marks_awarded === q.marks_available;
                const isPartial =
                  q.marks_awarded !== null &&
                  q.marks_awarded > 0 &&
                  q.marks_awarded < q.marks_available;

                return (
                  <tr
                    key={q.question_number}
                    className="hover:bg-background-soft"
                  >
                    <td className="px-4 py-3 text-sm font-medium text-text-primary">
                      Q{q.question_number}
                    </td>
                    <td className="px-4 py-3 text-sm text-text-muted">
                      {formatResponseType(q.response_type)}
                    </td>
                    <td className="px-4 py-3 text-center text-sm text-text-muted">
                      {q.marks_available}
                    </td>
                    <td className="px-4 py-3 text-center text-sm font-medium text-text-primary">
                      {q.marks_awarded ?? "â€”"}
                    </td>
                    <td className="px-4 py-3 text-center">
                      {isCorrect && (
                        <span className="inline-flex items-center rounded-full bg-success-green/10 px-2 py-0.5 text-xs font-medium text-success-green">
                          âœ“ Correct
                        </span>
                      )}
                      {isPartial && (
                        <span className="inline-flex items-center rounded-full bg-accent-amber/10 px-2 py-0.5 text-xs font-medium text-accent-amber">
                          â— Partial
                        </span>
                      )}
                      {!isCorrect && !isPartial && q.marks_awarded === 0 && (
                        <span className="inline-flex items-center rounded-full bg-danger-red/10 px-2 py-0.5 text-xs font-medium text-danger-red">
                          âœ— Incorrect
                        </span>
                      )}
                      {q.marks_awarded === null && (
                        <span className="text-xs text-text-muted">â€”</span>
                      )}
                    </td>
                  </tr>
                );
              })}
            </tbody>
          </table>
        </div>
      </div>

      {/* Privacy Notice */}
      <div className="mt-6 rounded-md bg-primary-blue/5 p-4 text-sm text-text-muted">
        <span className="font-medium text-text-primary">Privacy Note:</span>{" "}
        Question content, student responses, and marking comments are not shown
        to protect exam integrity and student privacy.
      </div>
    </div>
  );
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// Helper
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

function formatResponseType(type: string): string {
  const map: Record<string, string> = {
    mcq: "Multiple Choice",
    multi: "Multi-select",
    short: "Short Answer",
    extended: "Extended Response",
    numeric: "Numeric",
  };
  return map[type] || type;
}
```

### src/app/pages/parent/ProgressOverview.tsx
```
/**
 * ParentProgressOverview â€” Progress summary with subject breakdown
 *
 * Route: /parent/progress
 */

import { Link } from "react-router-dom";
import { useChildProfile } from "../../../features/parent/hooks/useChildProfile";
import { useParentExamResults } from "../../../features/parent/hooks/useParentExamResults";
import { useParentProgress } from "../../../features/parent/hooks/useParentProgress";
import { ProgressTable } from "../../../features/parent/components/ProgressTable";

export function ParentProgressOverview() {
  const { child } = useChildProfile();
  const { status, exams, error } = useParentExamResults(child?.id || null);
  const progress = useParentProgress(exams);

  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  // Loading State
  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  if (status === "loading" || !child) {
    return (
      <div className="mx-auto max-w-5xl px-4 py-6">
        <div className="text-center text-text-muted">Loading progress...</div>
      </div>
    );
  }

  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  // Error State
  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  if (status === "error") {
    return (
      <div className="mx-auto max-w-5xl px-4 py-6">
        <div className="mb-4">
          <Link
            to="/parent/dashboard"
            className="text-sm text-primary-blue hover:underline"
          >
            â† Back to Dashboard
          </Link>
        </div>
        <div className="rounded-md bg-danger-red/10 px-4 py-3 text-sm text-danger-red">
          {error || "Failed to load progress data"}
        </div>
      </div>
    );
  }

  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  // Main View
  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  return (
    <div className="mx-auto max-w-5xl px-4 py-6">
      {/* Header */}
      <div className="mb-6">
        <Link
          to="/parent/dashboard"
          className="mb-2 inline-block text-sm text-primary-blue hover:underline"
        >
          â† Back to Dashboard
        </Link>
        <h1 className="text-xl font-bold text-text-primary">
          Progress Overview
        </h1>
        <p className="mt-1 text-sm text-text-muted">
          {child.full_name}'s exam performance summary
        </p>
      </div>

      {/* Progress Table */}
      {exams.length > 0 ? (
        <ProgressTable summary={progress} />
      ) : (
        <div className="rounded-lg border border-border-subtle bg-background-soft p-6 text-center text-text-muted">
          No exam data available yet
        </div>
      )}

      {/* Exam List */}
      {exams.length > 0 && (
        <div className="mt-6 rounded-lg border border-border-subtle bg-white p-6">
          <h2 className="mb-4 font-semibold text-text-primary">All Exams</h2>
          <div className="overflow-hidden rounded-md border border-border-subtle">
            <table className="w-full">
              <thead className="bg-background-soft">
                <tr>
                  <th className="px-4 py-2 text-left text-sm font-medium text-text-primary">
                    Exam
                  </th>
                  <th className="px-4 py-2 text-left text-sm font-medium text-text-primary">
                    Subject
                  </th>
                  <th className="px-4 py-2 text-center text-sm font-medium text-text-primary">
                    Status
                  </th>
                  <th className="px-4 py-2 text-center text-sm font-medium text-text-primary">
                    Score
                  </th>
                  <th className="px-4 py-2 text-center text-sm font-medium text-text-primary">
                    Date
                  </th>
                </tr>
              </thead>
              <tbody className="divide-y divide-border-subtle">
                {exams.map((exam) => (
                  <tr key={exam.exam_id} className="hover:bg-background-soft">
                    <td className="px-4 py-3 text-sm font-medium text-text-primary">
                      {exam.exam_title}
                    </td>
                    <td className="px-4 py-3 text-sm text-text-muted">
                      {exam.subject}
                    </td>
                    <td className="px-4 py-3 text-center">
                      <StatusBadge status={exam.status} />
                    </td>
                    <td className="px-4 py-3 text-center text-sm text-text-primary">
                      {exam.is_marked
                        ? `${exam.total_score}/${exam.total_marks} (${exam.percentage}%)`
                        : exam.status === "submitted"
                          ? "Pending"
                          : "â€”"}
                    </td>
                    <td className="px-4 py-3 text-center text-sm text-text-muted">
                      {exam.submitted_at
                        ? new Date(exam.submitted_at).toLocaleDateString()
                        : "â€”"}
                    </td>
                  </tr>
                ))}
              </tbody>
            </table>
          </div>
        </div>
      )}
    </div>
  );
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// Status Badge
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

function StatusBadge({
  status,
}: {
  status: "not_started" | "in_progress" | "submitted";
}) {
  const styles = {
    not_started: "bg-gray-100 text-gray-700",
    in_progress: "bg-primary-blue/10 text-primary-blue",
    submitted: "bg-success-green/10 text-success-green",
  };

  const labels = {
    not_started: "Not Started",
    in_progress: "In Progress",
    submitted: "Submitted",
  };

  return (
    <span
      className={`inline-flex rounded-full px-2.5 py-0.5 text-xs font-medium ${styles[status]}`}
    >
      {labels[status]}
    </span>
  );
}
```

### src/app/pages/student/ExamAttempt.tsx
```
/**
 * MindMosaic â€” Exam Attempt Page (Day 25)
 *
 * Enhancements over UI polish pass:
 * - <Card> wraps the question area
 * - animate-fade-in on question content (key-driven remount per question)
 * - focus-ring + touch-target on all navigation buttons
 * - aria-labels on Previous/Next/Submit buttons
 * - animate-shake on submit button when unanswered questions remain
 * - Save indicator uses animate-fade-in
 * - Submitted success screen uses animate-slide-up + <Card>
 * - Error/loading states use animate-fade-in
 *
 * No logic, routing, or data flow changes.
 */

import { useState, useCallback, useEffect } from "react";
import { useParams, useNavigate } from "react-router-dom";
import { useExamAttempt } from "../../../features/exam/hooks/useExamAttempt";
import {
  QuestionRenderer,
  ExamTimer,
  CompactTimer,
  ExamProgress,
  CompactProgress,
  SubmitConfirmModal,
} from "../../../features/exam/components";
import type { ResponseData } from "../../../features/exam/types/exam.types";
import { Card } from "../../../components/ui/Card";
import { ProgressRing } from "../../../components/ui/ProgressRing";

export function ExamAttemptPage() {
  const { attemptId } = useParams<{ attemptId: string }>();
  const navigate = useNavigate();

  const {
    isLoading,
    error,
    attempt,
    examPackage,
    questions,
    responses,
    currentQuestionIndex,
    currentQuestion,
    totalQuestions,
    answeredCount,
    goToQuestion,
    goToNext,
    goToPrevious,
    canGoNext,
    canGoPrevious,
    setResponse,
    getResponse,
    isSaving,
    lastSavedAt,
    isSubmitting,
    submitAttempt,
    isSubmitted,
    startedAt,
    durationMinutes,
  } = useExamAttempt({ attemptId: attemptId || "" });

  const [showSubmitModal, setShowSubmitModal] = useState(false);
  const [shakeSubmit, setShakeSubmit] = useState(false);

  // Warn before leaving
  useEffect(() => {
    const handleBeforeUnload = (e: BeforeUnloadEvent) => {
      if (!isSubmitted && answeredCount > 0) {
        e.preventDefault();
        e.returnValue = "";
      }
    };
    window.addEventListener("beforeunload", handleBeforeUnload);
    return () => window.removeEventListener("beforeunload", handleBeforeUnload);
  }, [isSubmitted, answeredCount]);

  const handleResponseChange = useCallback(
    (data: ResponseData) => {
      if (currentQuestion) {
        setResponse(currentQuestion.id, data);
      }
    },
    [currentQuestion, setResponse]
  );

  const handleSubmitClick = useCallback(() => {
    // Shake if there are unanswered questions as a gentle nudge
    if (answeredCount < totalQuestions) {
      setShakeSubmit(true);
      setTimeout(() => setShakeSubmit(false), 500);
    }
    setShowSubmitModal(true);
  }, [answeredCount, totalQuestions]);

  const handleSubmitConfirm = useCallback(async () => {
    const result = await submitAttempt();
    if (result.success) {
      setShowSubmitModal(false);
      setTimeout(() => {
        navigate(`/student/review/${attemptId}`);
      }, 1500);
    } else {
      console.error("Submit failed:", result.error);
    }
  }, [submitAttempt, navigate, attemptId]);

  // Loading
  if (isLoading) {
    return (
      <div className="animate-fade-in flex min-h-screen items-center justify-center bg-background-soft">
        <div className="text-center">
          <div className="mx-auto mb-4 h-8 w-8 animate-spin rounded-full border-4 border-primary-blue border-t-transparent" />
          <p className="text-lg text-text-muted">Getting your exam readyâ€¦</p>
        </div>
      </div>
    );
  }

  // Error
  if (error || !attempt || !examPackage || !questions.length) {
    return (
      <div className="animate-fade-in flex min-h-screen items-center justify-center bg-background-soft px-4">
        <div className="max-w-md text-center">
          <p className="text-4xl" aria-hidden="true">ğŸ˜•</p>
          <h2 className="mt-4 text-xl font-semibold text-text-primary">
            Something went wrong
          </h2>
          <p className="mt-2 text-base leading-relaxed text-text-muted">
            {error || "We couldn't load this exam. Please try again."}
          </p>
          <button
            onClick={() => navigate("/student/exams")}
            className="focus-ring touch-target mt-6 rounded-xl bg-primary-blue px-8 py-3 text-base font-medium text-white hover:bg-primary-blue-light"
          >
            Back to Exams
          </button>
        </div>
      </div>
    );
  }

  // Submitted success
  if (isSubmitted) {
    return (
      <div className="flex min-h-screen items-center justify-center bg-background-soft px-4">
        <div className="animate-slide-up max-w-md text-center">
          <ProgressRing
            value={answeredCount}
            max={totalQuestions}
            size="lg"
            showLabel
            labelFormat="fraction"
            color="success-green"
            aria-label={`You answered ${answeredCount} of ${totalQuestions} questions`}
          />
          <h2 className="mt-6 text-2xl font-bold text-text-primary">
            Great work! ğŸ‰
          </h2>
          <p className="mt-2 text-lg leading-relaxed text-text-muted">
            Your exam has been submitted. You did your best and that's what
            counts.
          </p>
          <button
            onClick={() => navigate(`/student/review/${attemptId}`)}
            className="focus-ring touch-target mt-6 rounded-xl bg-primary-blue px-8 py-3.5 text-base font-medium text-white hover:bg-primary-blue-light"
            aria-label="See your answers and review this exam"
          >
            See Your Answers
          </button>
        </div>
      </div>
    );
  }

  const showTimer = examPackage.year_level >= 3;

  return (
    <div className="min-h-screen bg-background-soft">
      {/* Header */}
      <header className="sticky top-0 z-10 border-b border-border-subtle bg-white">
        <div className="mx-auto max-w-4xl px-4 py-3">
          <div className="flex items-center justify-between">
            <div className="flex items-center gap-4">
              <h1 className="max-w-[200px] truncate font-semibold text-text-primary sm:max-w-none">
                {examPackage.title}
              </h1>
              <CompactProgress
                currentIndex={currentQuestionIndex}
                totalQuestions={totalQuestions}
                answeredCount={answeredCount}
              />
            </div>
            {showTimer && startedAt && (
              <CompactTimer
                startedAt={startedAt}
                durationMinutes={durationMinutes}
              />
            )}
          </div>
        </div>
      </header>

      {/* Main content */}
      <main className="mx-auto max-w-4xl px-4 py-8">
        <div className="grid gap-8 lg:grid-cols-[1fr,280px]">
          {/* Question area */}
          <div className="space-y-6">
            {/* Mobile timer */}
            {showTimer && startedAt && (
              <div className="lg:hidden">
                <ExamTimer
                  startedAt={startedAt}
                  durationMinutes={durationMinutes}
                  showWarnings={true}
                />
              </div>
            )}

            {/* Question card â€” key forces remount for fade-in per question */}
            <Card padding="normal" key={currentQuestion?.id || currentQuestionIndex}>
              <div className="animate-fade-in">
                {currentQuestion ? (
                  <>
                    <p className="mb-4 text-sm font-medium text-text-muted">
                      Question {currentQuestionIndex + 1} of {totalQuestions}
                    </p>
                    <QuestionRenderer
                      question={currentQuestion}
                      questionNumber={currentQuestionIndex + 1}
                      totalQuestions={totalQuestions}
                      value={getResponse(currentQuestion.id)}
                      onChange={handleResponseChange}
                      disabled={false}
                    />
                  </>
                ) : (
                  <p className="text-text-muted">No question to display.</p>
                )}
              </div>
            </Card>

            {/* Navigation */}
            <div className="flex items-center justify-between gap-3">
              <button
                onClick={goToPrevious}
                disabled={!canGoPrevious}
                className="focus-ring touch-target rounded-xl border border-border-subtle bg-white px-6 py-3 text-sm font-medium text-text-primary hover:bg-background-soft disabled:opacity-40 disabled:hover:bg-white"
                aria-label="Go to previous question"
              >
                â† Previous
              </button>

              {currentQuestionIndex === totalQuestions - 1 ? (
                <button
                  onClick={handleSubmitClick}
                  className={`focus-ring touch-target rounded-xl bg-primary-blue px-6 py-3 text-sm font-medium text-white hover:bg-primary-blue-light ${
                    shakeSubmit ? "animate-shake" : ""
                  }`}
                  aria-label={`Submit exam. ${answeredCount} of ${totalQuestions} questions answered.`}
                >
                  Submit Exam
                </button>
              ) : (
                <button
                  onClick={goToNext}
                  disabled={!canGoNext}
                  className="focus-ring touch-target rounded-xl bg-primary-blue px-6 py-3 text-sm font-medium text-white hover:bg-primary-blue-light disabled:opacity-40"
                  aria-label="Go to next question"
                >
                  Next â†’
                </button>
              )}
            </div>

            {/* Save indicator */}
            <div className="text-center text-sm text-text-muted" aria-live="polite">
              {isSaving ? (
                <span className="animate-pulse-soft">Saving your answerâ€¦</span>
              ) : lastSavedAt ? (
                <span className="animate-fade-in">âœ“ Saved</span>
              ) : null}
            </div>
          </div>

          {/* Sidebar: progress grid (desktop) */}
          <div className="hidden lg:block">
            <div className="sticky top-20 space-y-6">
              {showTimer && startedAt && (
                <ExamTimer
                  startedAt={startedAt}
                  durationMinutes={durationMinutes}
                  showWarnings={true}
                />
              )}

              {/* Visual progress ring */}
              <Card padding="compact" className="flex flex-col items-center py-6">
                <ProgressRing
                  value={answeredCount}
                  max={totalQuestions}
                  size="lg"
                  showLabel
                  labelFormat="fraction"
                  color={
                    answeredCount === totalQuestions
                      ? "success-green"
                      : "primary-blue"
                  }
                  aria-label={`${answeredCount} of ${totalQuestions} questions answered`}
                />
                <p className="mt-3 text-sm text-text-muted">
                  {answeredCount === totalQuestions
                    ? "All questions answered!"
                    : `${totalQuestions - answeredCount} remaining`}
                </p>
              </Card>

              <ExamProgress
                totalQuestions={totalQuestions}
                responses={responses}
                currentIndex={currentQuestionIndex}
                questionIds={questions.map((q) => q.id)}
                onJumpTo={goToQuestion}
              />
            </div>
          </div>
        </div>
      </main>

      {/* Submit confirmation modal */}
      <SubmitConfirmModal
        isOpen={showSubmitModal}
        answeredCount={answeredCount}
        totalQuestions={totalQuestions}
        isSubmitting={isSubmitting}
        onConfirm={handleSubmitConfirm}
        onCancel={() => setShowSubmitModal(false)}
      />
    </div>
  );
}
```

### src/app/pages/student/ExamDetail.tsx
```
/**
 * MindMosaic â€” Exam Detail Page (UI Polish Pass)
 *
 * Changes from original:
 * - Warmer pre-exam messaging ("You've got this!")
 * - Larger text and more generous card padding
 * - rounded-2xl and shadow-sm on main card
 * - Friendlier duration/marks display
 * - Clearer primary action button
 * - Encouraging tone for resume state
 * - Better empty/error states
 *
 * No logic, routing, or data flow changes.
 */

import { useState, useEffect } from "react";
import { useParams, useNavigate, Link } from "react-router-dom";
import { supabase } from "../../../lib/supabase";
import { callEdgeFunction } from "../../../lib/supabase";
import type { ExamPackage, ExamAttempt } from "../../../lib/database.types";
import { useAuth } from "../../../context/useAuth";

interface StartAttemptFunctionResponse {
  attempt_id: string;
}

export function ExamDetailPage() {
  const { examId } = useParams<{ examId: string }>();
  const { user } = useAuth();
  const navigate = useNavigate();

  const [examPackage, setExamPackage] = useState<ExamPackage | null>(null);
  const [existingAttempt, setExistingAttempt] = useState<ExamAttempt | null>(
    null,
  );
  const [isLoading, setIsLoading] = useState(true);
  const [isStarting, setIsStarting] = useState(false);
  const [error, setError] = useState<string | null>(null);

  useEffect(() => {
    async function loadData() {
      if (!user || !examId) return;

      setIsLoading(true);
      setError(null);

      try {
        // Fetch exam package
        const { data: pkg, error: pkgError } = await supabase
          .from("exam_packages")
          .select("*")
          .eq("id", examId)
          .eq("status", "published")
          .single();

        const packageRow = (pkg as ExamPackage | null) ?? null;

        if (pkgError || !packageRow) {
          setError("This exam isn't available right now.");
          setIsLoading(false);
          return;
        }

        setExamPackage(packageRow);

        // Check for existing in-progress attempt
        const { data: attemptData } = await supabase
          .from("exam_attempts")
          .select("*")
          .eq("exam_package_id", examId)
          .eq("student_id", user.id)
          .eq("status", "started")
          .order("started_at", { ascending: false })
          .limit(1);

        const attemptRows = ((attemptData as ExamAttempt[] | null) ?? []);
        if (attemptRows.length > 0) {
          setExistingAttempt(attemptRows[0]);
        }
      } catch (err) {
        setError(err instanceof Error ? err.message : "Something went wrong.");
      } finally {
        setIsLoading(false);
      }
    }

    loadData();
  }, [user, examId]);

  const handleStart = async () => {
    if (!examId) return;

    setIsStarting(true);
    setError(null);

    try {
      const { data, error: startError } =
        await callEdgeFunction<StartAttemptFunctionResponse>("start-attempt", {
          exam_package_id: examId,
        });

      if (startError || !data?.attempt_id) {
        setError("Couldn't start the exam. Please try again.");
        return;
      }

      navigate(`/student/attempt/${data.attempt_id}`);
    } catch {
      setError("Something went wrong starting the exam.");
    } finally {
      setIsStarting(false);
    }
  };

  // Loading
  if (isLoading) {
    return (
      <div className="flex items-center justify-center py-20">
        <div className="text-center">
          <div className="mx-auto mb-4 h-8 w-8 animate-spin rounded-full border-4 border-primary-blue border-t-transparent" />
          <p className="text-lg text-text-muted">Loading exam detailsâ€¦</p>
        </div>
      </div>
    );
  }

  // Not found
  if (!examPackage) {
    return (
      <div className="mx-auto max-w-md py-20 text-center">
        <p className="text-4xl" aria-hidden="true">
          ğŸ”
        </p>
        <h2 className="mt-4 text-xl font-semibold text-text-primary">
          Exam not found
        </h2>
        <p className="mt-2 text-base leading-relaxed text-text-muted">
          {error || "This exam doesn't exist or isn't available right now."}
        </p>
        <Link
          to="/student/exams"
          className="mt-6 inline-block rounded-xl bg-primary-blue px-8 py-3 text-base font-medium text-white hover:bg-primary-blue-light"
        >
          Back to Exams
        </Link>
      </div>
    );
  }

  return (
    <div className="mx-auto max-w-2xl py-8">
      <Link
        to="/student/exams"
        className="mb-6 inline-block text-sm font-medium text-primary-blue hover:underline"
      >
        â† Back to Exams
      </Link>

      <div className="rounded-2xl border border-border-subtle bg-white p-8 shadow-sm">
        {/* Exam title and meta */}
        <h1 className="text-2xl font-bold text-text-primary">
          {examPackage.title}
        </h1>
        <p className="mt-1 text-base text-text-muted">
          Year {examPackage.year_level} Â· {examPackage.subject}
        </p>

        {/* Exam details */}
        <div className="mt-6 flex flex-wrap gap-6 text-base text-text-muted">
          {examPackage.duration_minutes && (
            <div className="flex items-center gap-2">
              <span aria-hidden="true">â±ï¸</span>
              <span>{examPackage.duration_minutes} minutes</span>
            </div>
          )}
          {examPackage.total_marks && (
            <div className="flex items-center gap-2">
              <span aria-hidden="true">ğŸ“Š</span>
              <span>{examPackage.total_marks} marks</span>
            </div>
          )}
        </div>

        {/* Instructions */}
        {examPackage.instructions && (
          <div className="mt-6 rounded-xl bg-background-soft p-6">
            <h2 className="text-sm font-medium text-text-primary">
              Before you begin
            </h2>
            <p className="mt-2 text-base leading-relaxed text-text-muted">
              {examPackage.instructions}
            </p>
          </div>
        )}

        {/* Error */}
        {error && (
          <div className="mt-6 rounded-xl bg-danger-red/10 p-4">
            <p className="text-sm text-danger-red">{error}</p>
          </div>
        )}

        {/* Action area */}
        <div className="mt-8">
          {existingAttempt ? (
            <div>
              <p className="mb-4 text-base leading-relaxed text-text-muted">
                ğŸ“˜ You have an exam in progress. Pick up right where you left
                off â€” your answers are saved.
              </p>
              <button
                onClick={() =>
                  navigate(`/student/attempt/${existingAttempt.id}`)
                }
                className="w-full rounded-xl bg-accent-amber px-8 py-3.5 text-base font-medium text-white hover:bg-amber-500 sm:w-auto"
              >
                Continue Exam
              </button>
            </div>
          ) : (
            <div>
              <p className="mb-4 text-base leading-relaxed text-text-muted">
                Take your time and do your best. Your answers are saved
                automatically so nothing gets lost. You've got this! ğŸ’ª
              </p>
              <button
                onClick={handleStart}
                disabled={isStarting}
                className="w-full rounded-xl bg-primary-blue px-8 py-3.5 text-base font-medium text-white hover:bg-primary-blue-light disabled:opacity-50 sm:w-auto"
              >
                {isStarting ? "Startingâ€¦" : "Start Exam"}
              </button>
            </div>
          )}
        </div>
      </div>
    </div>
  );
}
```

### src/app/pages/student/ExamList.tsx
```
/**
 * MindMosaic â€” Exam List Page (Day 24)
 *
 * Enhancements over UI polish pass:
 * - Uses <Card variant="interactive"> for exam tiles
 * - Uses animate-fade-in on page load, stagger-children on card grids
 * - Uses animate-slide-up on individual cards
 * - Uses focus-ring on all interactive elements
 * - Uses touch-target on action buttons
 * - Loading/empty/error states use animate-fade-in
 *
 * No logic, routing, or data flow changes.
 */

import { useState, useEffect } from "react";
import { Link } from "react-router-dom";
import { supabase } from "../../../lib/supabase";
import type { ExamPackage, ExamAttempt } from "../../../lib/database.types";
import { useAuth } from "../../../context/useAuth";
import { Card } from "../../../components/ui/card";

// Subject display names and icons
const SUBJECT_INFO: Record<string, { label: string; icon: string }> = {
  numeracy: { label: "Numeracy", icon: "ğŸ”¢" },
  reading: { label: "Reading", icon: "ğŸ“–" },
  writing: { label: "Writing", icon: "âœï¸" },
  "language-conventions": { label: "Language", icon: "ğŸ“" },
  mathematics: { label: "Mathematics", icon: "ğŸ§®" },
  english: { label: "English", icon: "ğŸ“š" },
  science: { label: "Science", icon: "ğŸ”¬" },
};

// Assessment type badges
const ASSESSMENT_BADGES: Record<string, { label: string; className: string }> =
  {
    naplan: { label: "NAPLAN", className: "bg-blue-100 text-blue-800" },
    icas: { label: "ICAS", className: "bg-purple-100 text-purple-800" },
  };

export function ExamListPage() {
  const { user } = useAuth();
  const [exams, setExams] = useState<ExamPackage[]>([]);
  const [attempts, setAttempts] = useState<Map<string, ExamAttempt>>(new Map());
  const [isLoading, setIsLoading] = useState(true);
  const [error, setError] = useState<string | null>(null);

  useEffect(() => {
    async function loadData() {
      if (!user) return;

      setIsLoading(true);
      setError(null);

      try {
        const { data: examData, error: examError } = await supabase
          .from("exam_packages")
          .select("*")
          .eq("status", "published")
          .order("year_level")
          .order("subject");

        if (examError) {
          throw new Error(`Failed to load exams: ${examError.message}`);
        }

        setExams((examData as ExamPackage[] | null) ?? []);

        const { data: attemptData, error: attemptError } = await supabase
          .from("exam_attempts")
          .select("*")
          .eq("student_id", user.id);

        if (attemptError) {
          console.warn("Failed to load attempts:", attemptError.message);
        } else if (attemptData) {
          const attemptRows = (attemptData as ExamAttempt[]) ?? [];
          const attemptMap = new Map<string, ExamAttempt>();
          attemptRows.forEach((attempt) => {
            const existing = attemptMap.get(attempt.exam_package_id);
            if (
              !existing ||
              new Date(attempt.started_at) > new Date(existing.started_at)
            ) {
              attemptMap.set(attempt.exam_package_id, attempt);
            }
          });
          setAttempts(attemptMap);
        }
      } catch (err) {
        setError(
          err instanceof Error
            ? err.message
            : "Something went wrong loading exams.",
        );
      } finally {
        setIsLoading(false);
      }
    }

    loadData();
  }, [user]);

  // Loading state
  if (isLoading) {
    return (
      <div className="animate-fade-in flex items-center justify-center py-20">
        <div className="text-center">
          <div className="mx-auto mb-4 h-8 w-8 animate-spin rounded-full border-4 border-primary-blue border-t-transparent" />
          <p className="text-lg text-text-muted">Finding your examsâ€¦</p>
        </div>
      </div>
    );
  }

  // Error state
  if (error) {
    return (
      <div className="animate-fade-in mx-auto max-w-md py-20 text-center">
        <p className="text-4xl" aria-hidden="true">
          ğŸ˜•
        </p>
        <h2 className="mt-4 text-xl font-semibold text-text-primary">
          Couldn't load exams
        </h2>
        <p className="mt-2 text-base leading-relaxed text-text-muted">
          {error}
        </p>
        <button
          onClick={() => window.location.reload()}
          className="focus-ring touch-target mt-6 rounded-xl bg-primary-blue px-8 py-3 text-base font-medium text-white hover:bg-primary-blue-light"
        >
          Try Again
        </button>
      </div>
    );
  }

  // Empty state
  if (exams.length === 0) {
    return (
      <div className="animate-fade-in mx-auto max-w-md py-20 text-center">
        <p className="text-4xl" aria-hidden="true">
          ğŸ“˜
        </p>
        <h2 className="mt-4 text-xl font-semibold text-text-primary">
          No exams available yet
        </h2>
        <p className="mt-2 text-base leading-relaxed text-text-muted">
          New practice exams are added regularly. Check back soon!
        </p>
      </div>
    );
  }

  // Group exams by year level
  const grouped = new Map<number, ExamPackage[]>();
  exams.forEach((exam) => {
    const group = grouped.get(exam.year_level) || [];
    group.push(exam);
    grouped.set(exam.year_level, group);
  });

  return (
    <div className="animate-fade-in space-y-10">
      <header>
        <h1 className="text-3xl font-semibold text-text-primary">
          ğŸ“˜ Practice Exams
        </h1>
        <p className="mt-2 text-lg leading-relaxed text-text-muted">
          Choose an exam to get started. Take your time â€” there's no rush.
        </p>
      </header>

      {Array.from(grouped.entries())
        .sort(([a], [b]) => a - b)
        .map(([yearLevel, yearExams]) => (
          <section key={yearLevel}>
            <h2 className="mb-4 text-xl font-medium text-text-primary">
              Year {yearLevel}
            </h2>
            <div className="stagger-children grid gap-6 sm:grid-cols-2 lg:grid-cols-3">
              {yearExams.map((exam) => {
                const attempt = attempts.get(exam.id);
                return <ExamCard key={exam.id} exam={exam} attempt={attempt} />;
              })}
            </div>
          </section>
        ))}
    </div>
  );
}

// =============================================================================
// Exam Card
// =============================================================================

function ExamCard({
  exam,
  attempt,
}: {
  exam: ExamPackage;
  attempt?: ExamAttempt;
}) {
  const subject = SUBJECT_INFO[exam.subject] || {
    label: exam.subject,
    icon: "ğŸ“„",
  };
  const badge = ASSESSMENT_BADGES[exam.assessment_type];

  // Determine status and action
  let statusLabel = "";
  let statusClassName = "";
  let actionLabel = "Start Exam";
  let actionTo = `/student/exams/${exam.id}`;

  if (attempt) {
    if (attempt.status === "started") {
      statusLabel = "In Progress";
      statusClassName = "text-accent-amber bg-accent-amber/10";
      actionLabel = "Continue";
      actionTo = `/student/attempt/${attempt.id}`;
    } else if (
      attempt.status === "submitted" ||
      attempt.status === "evaluated"
    ) {
      statusLabel = "Completed";
      statusClassName = "text-success-green bg-success-green/10";
      actionLabel = "Review";
      actionTo = `/student/review/${attempt.id}`;
    }
  }

  return (
    <div className="animate-slide-up">
      <Card
        variant="interactive"
        padding="normal"
        className="flex h-full flex-col"
      >
        {/* Header row */}
        <div className="mb-4 flex items-start justify-between">
          <span className="text-3xl" aria-hidden="true">
            {subject.icon}
          </span>
          {badge && (
            <span
              className={`rounded-full px-2.5 py-1 text-xs font-medium ${badge.className}`}
            >
              {badge.label}
            </span>
          )}
        </div>

        {/* Title and meta */}
        <h3 className="text-lg font-semibold leading-snug text-text-primary">
          {exam.title}
        </h3>
        <p className="mt-1 text-base text-text-muted">{subject.label}</p>

        {/* Details */}
        <div className="mt-3 flex flex-wrap gap-3 text-sm text-text-muted">
          {exam.duration_minutes && (
            <span className="flex items-center gap-1">
              <span aria-hidden="true">â±ï¸</span>
              {exam.duration_minutes} min
            </span>
          )}
          {exam.total_marks && (
            <span className="flex items-center gap-1">
              <span aria-hidden="true">ğŸ“Š</span>
              {exam.total_marks} marks
            </span>
          )}
        </div>

        {/* Spacer */}
        <div className="flex-1" />

        {/* Status + Action */}
        <div className="mt-6 flex items-center justify-between">
          {statusLabel && (
            <span
              className={`rounded-full px-3 py-1 text-xs font-medium ${statusClassName}`}
            >
              {statusLabel}
            </span>
          )}
          <Link
            to={actionTo}
            className={`focus-ring touch-target ml-auto rounded-xl px-6 py-2.5 text-sm font-medium ${
              attempt?.status === "started"
                ? "bg-accent-amber text-white hover:bg-amber-500"
                : attempt?.status === "submitted" ||
                    attempt?.status === "evaluated"
                  ? "border border-primary-blue text-primary-blue hover:bg-background-soft"
                  : "bg-primary-blue text-white hover:bg-primary-blue-light"
            }`}
            aria-label={`${actionLabel}: ${exam.title}`}
          >
            {actionLabel}
          </Link>
        </div>
      </Card>
    </div>
  );
}
```

### src/app/pages/student/ExamReview.tsx
```
import { useState, useRef, useEffect } from "react";
import { useParams, useNavigate, Link } from "react-router-dom";
import { useExamReview } from "../../../features/exam/hooks/useExamReview";
import { AttemptSummaryPanel } from "../../../features/exam/components/AttemptSummaryPanel";
import { ReviewQuestionCard } from "../../../features/exam/components/ReviewQuestionCard";
import { ReviewQuestionNav } from "../../../features/exam/components/ReviewQuestionNav";
import { Card } from "../../../components/ui/Card";
import { ProgressRing } from "../../../components/ui/ProgressRing";
import { Avatar } from "../../../components/ui/Avatar";
import { FloatingShapes } from "../../../components/ui/FloatingShapes";
import { useAuth } from "../../../context/useAuth";

export function ExamReviewPage() {
  const { attemptId } = useParams<{ attemptId: string }>();
  const navigate = useNavigate();
  const { user } = useAuth();
  const [activeQuestionIndex, setActiveQuestionIndex] = useState(0);
  const questionRefs = useRef<Map<number, HTMLDivElement>>(new Map());

  const { status, data, error } = useExamReview(attemptId);

  useEffect(() => {
    const el = questionRefs.current.get(activeQuestionIndex);
    if (el) {
      el.scrollIntoView({ behavior: "smooth", block: "start" });
    }
  }, [activeQuestionIndex]);

  if (status === "loading") {
    return (
      <div className="animate-fade-in flex items-center justify-center py-20">
        <div className="text-center">
          <div className="mx-auto mb-4 h-8 w-8 animate-spin rounded-full border-4 border-primary-blue border-t-transparent" />
          <p className="text-lg text-text-muted">Loading your results...</p>
        </div>
      </div>
    );
  }

  if (status === "not-found" || status === "error") {
    return (
      <div className="animate-fade-in mx-auto max-w-md py-20 text-center">
        <h2 className="mt-4 text-xl font-semibold text-text-primary">
          Review not found
        </h2>
        <p className="mt-2 text-base leading-relaxed text-text-muted">
          {error ||
            "We could not find this exam review. It may not exist or you might not have access."}
        </p>
        <button
          onClick={() => navigate("/student/exams")}
          className="focus-ring touch-target mt-6 rounded-xl bg-primary-blue px-8 py-3 text-base font-medium text-white hover:bg-primary-blue-light"
          aria-label="Go back to exam list"
        >
          Back to Exams
        </button>
      </div>
    );
  }

  if (status === "not-submitted") {
    return (
      <div className="animate-fade-in mx-auto max-w-md py-20 text-center">
        <h2 className="mt-4 text-xl font-semibold text-text-primary">
          Exam still in progress
        </h2>
        <p className="mt-2 text-base leading-relaxed text-text-muted">
          You need to submit this exam before you can review it.
        </p>
        <button
          onClick={() => navigate(`/student/attempt/${attemptId}`)}
          className="focus-ring touch-target mt-6 rounded-xl bg-primary-blue px-8 py-3 text-base font-medium text-white hover:bg-primary-blue-light"
          aria-label="Continue your exam"
        >
          Continue Exam
        </button>
      </div>
    );
  }

  if (!data) {
    return (
      <div className="animate-fade-in mx-auto max-w-md py-20 text-center">
        <p className="text-base leading-relaxed text-text-muted">
          Could not load review data.
        </p>
      </div>
    );
  }

  const { attempt, examPackage, questions, result } = data;
  const scoreColor = result?.passed ? "success-green" : "accent-amber";

  return (
    <div className="animate-fade-in mx-auto max-w-4xl px-4 py-8">
      <header className="mb-8">
        <button
          onClick={() => navigate("/student/exams")}
          className="focus-ring mb-4 text-sm font-medium text-primary-blue hover:underline"
          aria-label="Back to exam list"
        >
          Back to Exams
        </button>
        <div className="flex items-center gap-4">
          <Avatar name={user?.email || ""} size="md" />
          <div>
            <h1 className="text-3xl font-bold text-text-primary">
              {examPackage.title}
            </h1>
            <p className="mt-1 text-base text-text-muted">
              Submitted{" "}
              {attempt.submitted_at
                ? new Date(attempt.submitted_at).toLocaleDateString("en-AU", {
                    day: "numeric",
                    month: "long",
                    year: "numeric",
                  })
                : ""}
              {" Â· "}
              {questions.length} questions
            </p>
          </div>
        </div>
      </header>

      {result && (
        <div className="relative mb-8 overflow-hidden rounded-2xl">
          <FloatingShapes variant={result.passed ? "cool" : "warm"} />
          <div
            className={`relative z-10 p-8 ${
              result.passed ? "bg-success-green/5" : "bg-accent-amber/5"
            }`}
          >
            <div className="flex flex-col items-center gap-6 sm:flex-row sm:justify-between">
              <div className="flex items-center gap-6">
                <ProgressRing
                  value={result.total_score}
                  max={result.max_score}
                  size="lg"
                  showLabel
                  labelFormat="percentage"
                  color={scoreColor}
                  aria-label={`Score: ${result.total_score} out of ${result.max_score}, ${result.percentage} percent`}
                />
                <div>
                  <p className="text-base text-text-muted">Your Score</p>
                  <p
                    className={`mt-1 text-3xl font-bold ${
                      result.passed ? "text-success-green" : "text-accent-amber"
                    }`}
                  >
                    {result.total_score} / {result.max_score}
                  </p>
                </div>
              </div>
              <div className="text-center sm:text-right">
                <span
                  className={`inline-block rounded-2xl px-5 py-2.5 text-lg font-semibold text-white ${
                    result.passed ? "bg-success-green" : "bg-accent-amber"
                  }`}
                >
                  {result.passed ? "Well done!" : "Keep practicing!"}
                </span>
                {!result.passed && (
                  <p className="mt-2 text-sm leading-relaxed text-text-muted">
                    Every practice makes you stronger. You will get there.
                  </p>
                )}
              </div>
            </div>
          </div>
        </div>
      )}

      {attempt.status === "submitted" && !result && (
        <Card
          padding="normal"
          className="mb-8 border-l-4 border-l-primary-blue bg-primary-blue/5"
        >
          <p className="text-lg font-medium text-primary-blue">
            Your exam is being reviewed
          </p>
          <p className="mt-1 text-base leading-relaxed text-text-muted">
            Your answers have been submitted. Check back soon for your results.
          </p>
        </Card>
      )}

      {result && (
        <div className="animate-slide-up mb-8">
          <AttemptSummaryPanel data={data} />
        </div>
      )}

      {questions.length > 0 && (
        <div className="mb-8">
          <ReviewQuestionNav
            questions={questions}
            activeIndex={activeQuestionIndex}
            onSelect={setActiveQuestionIndex}
          />
        </div>
      )}

      <div className="stagger-children space-y-8">
        {questions.map((questionData, index) => (
          <div
            key={questionData.question.id}
            className="animate-slide-up"
            ref={(el) => {
              if (el) questionRefs.current.set(index, el);
            }}
          >
            <ReviewQuestionCard data={questionData} />
          </div>
        ))}
      </div>

      <footer className="mt-12 border-t border-border-subtle pt-8 text-center">
        <p className="mb-4 text-base leading-relaxed text-text-muted">
          Want to keep practicing? Every attempt helps you improve.
        </p>
        <Link
          to="/student/exams"
          className="focus-ring touch-target inline-block rounded-xl bg-primary-blue px-8 py-3.5 text-base font-medium text-white hover:bg-primary-blue-light"
          aria-label="Try another exam"
        >
          Try Another Exam
        </Link>
      </footer>
    </div>
  );
}
```

### src/components/ui/ProgressRing.tsx
```
/**
 * MindMosaic â€” ProgressRing Component
 *
 * Circular progress indicator using SVG.
 * Uses theme tokens for colors.
 *
 * Usage:
 *   <ProgressRing value={75} max={100} />
 *   <ProgressRing value={8} max={10} size="lg" showLabel />
 */

type ProgressRingSize = "sm" | "md" | "lg";

interface ProgressRingProps {
  /** Current value */
  value: number;
  /** Maximum value */
  max: number;
  /** Visual size */
  size?: ProgressRingSize;
  /** Show percentage/fraction label in center */
  showLabel?: boolean;
  /** Label format: "percentage" (75%) or "fraction" (8/10) */
  labelFormat?: "percentage" | "fraction";
  /** Override track color (Tailwind color class without prefix) */
  color?: "primary-blue" | "success-green" | "accent-amber" | "danger-red";
  /** Accessible label */
  "aria-label"?: string;
}

const SIZE_CONFIG: Record<
  ProgressRingSize,
  { size: number; stroke: number; fontSize: string }
> = {
  sm: { size: 40, stroke: 3, fontSize: "text-xs" },
  md: { size: 64, stroke: 4, fontSize: "text-sm" },
  lg: { size: 96, stroke: 5, fontSize: "text-lg" },
};

const COLOR_MAP: Record<string, string> = {
  "primary-blue": "#1D4ED8",
  "success-green": "#16A34A",
  "accent-amber": "#F59E0B",
  "danger-red": "#DC2626",
};

export function ProgressRing({
  value,
  max,
  size = "md",
  showLabel = false,
  labelFormat = "percentage",
  color = "primary-blue",
  "aria-label": ariaLabel,
}: ProgressRingProps) {
  const config = SIZE_CONFIG[size];
  const radius = (config.size - config.stroke) / 2;
  const circumference = 2 * Math.PI * radius;
  const clamped = Math.min(Math.max(value, 0), max);
  const percentage = max > 0 ? (clamped / max) * 100 : 0;
  const offset = circumference - (percentage / 100) * circumference;
  const strokeColor = COLOR_MAP[color] || COLOR_MAP["primary-blue"];

  const label =
    labelFormat === "fraction"
      ? `${clamped}/${max}`
      : `${Math.round(percentage)}%`;

  return (
    <div
      className="relative inline-flex items-center justify-center"
      role="progressbar"
      aria-valuenow={clamped}
      aria-valuemin={0}
      aria-valuemax={max}
      aria-label={ariaLabel || `Progress: ${label}`}
    >
      <svg width={config.size} height={config.size} className="-rotate-90">
        {/* Background track */}
        <circle
          cx={config.size / 2}
          cy={config.size / 2}
          r={radius}
          fill="none"
          stroke="#E5E7EB"
          strokeWidth={config.stroke}
        />
        {/* Progress arc */}
        <circle
          cx={config.size / 2}
          cy={config.size / 2}
          r={radius}
          fill="none"
          stroke={strokeColor}
          strokeWidth={config.stroke}
          strokeLinecap="round"
          strokeDasharray={circumference}
          strokeDashoffset={offset}
          className="transition-[stroke-dashoffset] duration-500 ease-out"
        />
      </svg>
      {showLabel && (
        <span
          className={`absolute font-semibold text-text-primary ${config.fontSize}`}
          aria-hidden="true"
        >
          {label}
        </span>
      )}
    </div>
  );
}
```

### src/features/exam/components/BooleanQuestion.tsx
```
/**
 * MindMosaic â€” Boolean (True/False) Question Component
 *
 * Standalone boolean question with optional explanation field.
 * response_type: "boolean"
 * Uses BooleanResponseData { answer: boolean; explanation?: string }
 *
 * Unlike the legacy TrueFalseQuestion (which piggybacks on MCQ options),
 * this is driven by the validation.correct field.
 */

import { useId } from "react";
import type {
  BooleanResponseData,
  BooleanValidation,
} from "../types/exam.types";

interface BooleanQuestionProps {
  questionId: string;
  value: BooleanResponseData | undefined;
  onChange: (data: BooleanResponseData) => void;
  disabled?: boolean;
  validation?: BooleanValidation | null;
}

export function BooleanQuestion({
  questionId,
  value,
  onChange,
  disabled = false,
  validation,
}: BooleanQuestionProps) {
  const explanationId = useId();
  const hasSelection = value !== undefined;
  const requireExplanation = validation?.requireExplanation ?? false;

  const handleSelect = (answer: boolean) => {
    if (disabled) return;
    onChange({ answer, explanation: value?.explanation });
  };

  const handleExplanationChange = (
    e: React.ChangeEvent<HTMLTextAreaElement>,
  ) => {
    if (disabled || value === undefined) return;
    onChange({ answer: value.answer, explanation: e.target.value });
  };

  const options = [
    { answer: true, label: "True" },
    { answer: false, label: "False" },
  ];

  return (
    <div className="space-y-4">
      <div
        className="flex gap-4"
        role="radiogroup"
        aria-labelledby={`question-${questionId}`}
      >
        {options.map((option) => {
          const isSelected = hasSelection && value.answer === option.answer;

          return (
            <button
              key={String(option.answer)}
              type="button"
              role="radio"
              aria-checked={isSelected}
              disabled={disabled}
              onClick={() => handleSelect(option.answer)}
              className={`
                flex-1 py-4 px-6 rounded-lg border-2 transition-all
                font-medium text-center touch-target focus-ring
                ${disabled ? "cursor-not-allowed opacity-60" : "cursor-pointer hover:border-primary-blue-light"}
                ${
                  isSelected
                    ? "border-primary-blue bg-primary-blue text-white"
                    : "border-border-subtle bg-white text-text-primary"
                }
              `}
            >
              {option.label}
            </button>
          );
        })}
      </div>

      {requireExplanation && hasSelection && (
        <div className="space-y-2">
          <label
            htmlFor={explanationId}
            className="block text-sm font-medium text-text-muted"
          >
            Explain your answer
          </label>
          <textarea
            id={explanationId}
            value={value.explanation ?? ""}
            onChange={handleExplanationChange}
            disabled={disabled}
            placeholder="Why did you choose this answer?"
            rows={3}
            className={`
              w-full px-4 py-3 rounded-lg border-2 text-text-primary
              transition-colors resize-none
              focus:outline-none focus:ring-2 focus:ring-primary-blue focus:ring-offset-2
              placeholder:text-text-muted
              ${disabled ? "bg-gray-50 cursor-not-allowed" : "bg-white"}
              ${value.explanation ? "border-primary-blue" : "border-border-subtle"}
            `}
          />
        </div>
      )}
    </div>
  );
}
```

### src/features/exam/components/ClozeQuestion.tsx
```
/**
 * MindMosaic â€” Cloze (Fill-in-the-Blank) Question Component
 *
 * response_type: "cloze"
 * Renders text with ___ blanks replaced by inline input fields.
 * Internally uses ShortResponseData for single-blank cloze.
 *
 * The prompt_blocks contain text with "___" markers.
 * validation: { acceptedAnswers: [...], caseSensitive: false }
 */

import { useId } from "react";
import type { ShortResponseData } from "../types/exam.types";

interface ClozeQuestionProps {
  questionId: string;
  /** The text containing ___ blank markers */
  text: string;
  value: ShortResponseData | undefined;
  onChange: (data: ShortResponseData) => void;
  disabled?: boolean;
}

export function ClozeQuestion({
  questionId,
  text,
  value,
  onChange,
  disabled = false,
}: ClozeQuestionProps) {
  const inputId = useId();
  const answer = value?.answer ?? "";

  const handleChange = (e: React.ChangeEvent<HTMLInputElement>) => {
    if (disabled) return;
    onChange({ answer: e.target.value });
  };

  // Split text around the blank marker(s)
  const parts = text.split(/___+/);

  if (parts.length <= 1) {
    // No blanks found â€” fall back to a standard text input
    return (
      <div className="space-y-3">
        <p className="text-text-primary leading-relaxed">{text}</p>
        <input
          id={inputId}
          type="text"
          value={answer}
          onChange={handleChange}
          disabled={disabled}
          placeholder="Type your answerâ€¦"
          aria-label="Your answer"
          className={`
            w-full px-4 py-3 rounded-lg border-2 text-text-primary
            transition-colors focus-ring
            placeholder:text-text-muted
            ${disabled ? "bg-gray-50 cursor-not-allowed" : "bg-white"}
            ${answer ? "border-primary-blue" : "border-border-subtle"}
          `}
        />
      </div>
    );
  }

  // Render inline blank(s)
  return (
    <div
      className="leading-relaxed text-text-primary text-base"
      aria-labelledby={`question-${questionId}`}
    >
      {parts.map((part, index) => (
        <span key={index}>
          {part}
          {index < parts.length - 1 && (
            <input
              type="text"
              value={answer}
              onChange={handleChange}
              disabled={disabled}
              placeholder="â€¦"
              aria-label={`Blank ${index + 1}`}
              className={`
                inline-block w-32 sm:w-40 mx-1 px-3 py-1.5 rounded-md border-2
                text-center text-text-primary font-medium
                transition-colors focus-ring
                placeholder:text-text-muted
                ${disabled ? "bg-gray-50 cursor-not-allowed" : "bg-white"}
                ${answer ? "border-primary-blue" : "border-border-subtle"}
              `}
            />
          )}
        </span>
      ))}
    </div>
  );
}
```

### src/features/exam/components/ExamNavigation.tsx
```
/**
 * MindMosaic â€” Exam Navigation Component
 *
 * Previous/Next navigation and Submit button.
 */

interface ExamNavigationProps {
  currentIndex: number;
  totalQuestions: number;
  canGoPrevious: boolean;
  canGoNext: boolean;
  onPrevious: () => void;
  onNext: () => void;
  onSubmit: () => void;
  isSubmitting: boolean;
  isSubmitted: boolean;
  isSaving: boolean;
  answeredCount: number;
}

export function ExamNavigation({
  currentIndex,
  totalQuestions,
  canGoPrevious,
  canGoNext,
  onPrevious,
  onNext,
  onSubmit,
  isSubmitting,
  isSubmitted,
  isSaving,
  answeredCount,
}: ExamNavigationProps) {
  const isLastQuestion = currentIndex === totalQuestions - 1;

  return (
    <div className="flex items-center justify-between pt-6 border-t border-border-subtle">
      {/* Previous button */}
      <button
        type="button"
        onClick={onPrevious}
        disabled={!canGoPrevious || isSubmitting || isSubmitted}
        className={`
          px-6 py-3 rounded-lg font-medium transition-all
          focus:outline-none focus:ring-2 focus:ring-primary-blue focus:ring-offset-2
          ${
            canGoPrevious && !isSubmitting && !isSubmitted
              ? "bg-gray-100 text-text-primary hover:bg-gray-200"
              : "bg-gray-50 text-text-muted cursor-not-allowed"
          }
        `}
      >
        â† Previous
      </button>

      {/* Center: Save status */}
      <div className="text-sm text-text-muted">
        <span className="mr-3">
          {answeredCount}/{totalQuestions} answered
        </span>
        {isSaving ? (
          <span className="flex items-center gap-2">
            <span className="animate-spin">â³</span>
            Saving...
          </span>
        ) : (
          <span className="text-success-green">âœ“ Saved</span>
        )}
      </div>

      {/* Next / Submit button */}
      <div className="flex items-center gap-3">
        {isLastQuestion ? (
          <button
            type="button"
            onClick={onSubmit}
            disabled={isSubmitting || isSubmitted}
            className={`
              px-6 py-3 rounded-lg font-medium transition-all
              focus:outline-none focus:ring-2 focus:ring-primary-blue focus:ring-offset-2
              ${
                isSubmitting
                  ? "bg-primary-blue/50 text-white cursor-wait"
                  : isSubmitted
                    ? "bg-success-green text-white cursor-not-allowed"
                    : "bg-primary-blue text-white hover:bg-primary-blue-light"
              }
            `}
          >
            {isSubmitting ? (
              <span className="flex items-center gap-2">
                <span className="animate-spin">â³</span>
                Submitting...
              </span>
            ) : isSubmitted ? (
              "Submitted âœ“"
            ) : (
              "Submit Exam"
            )}
          </button>
        ) : (
          <button
            type="button"
            onClick={onNext}
            disabled={!canGoNext || isSubmitting || isSubmitted}
            className={`
              px-6 py-3 rounded-lg font-medium transition-all
              focus:outline-none focus:ring-2 focus:ring-primary-blue focus:ring-offset-2
              ${
                canGoNext && !isSubmitting && !isSubmitted
                  ? "bg-primary-blue text-white hover:bg-primary-blue-light"
                  : "bg-gray-50 text-text-muted cursor-not-allowed"
              }
            `}
          >
            Next â†’
          </button>
        )}
      </div>
    </div>
  );
}

// =============================================================================
// Submit Confirmation Modal
// =============================================================================

interface SubmitConfirmModalProps {
  isOpen: boolean;
  onConfirm: () => void;
  onCancel: () => void;
  answeredCount: number;
  totalQuestions: number;
  isSubmitting: boolean;
}

export function SubmitConfirmModal({
  isOpen,
  onConfirm,
  onCancel,
  answeredCount,
  totalQuestions,
  isSubmitting,
}: SubmitConfirmModalProps) {
  if (!isOpen) return null;

  const allAnswered = answeredCount === totalQuestions;
  const unansweredCount = totalQuestions - answeredCount;

  return (
    <div
      className="fixed inset-0 z-50 flex items-center justify-center p-4"
      role="dialog"
      aria-modal="true"
      aria-labelledby="submit-modal-title"
    >
      {/* Backdrop */}
      <div
        className="absolute inset-0 bg-black/50"
        onClick={onCancel}
        aria-hidden="true"
      />

      {/* Modal */}
      <div className="relative bg-white rounded-xl shadow-xl max-w-md w-full p-6">
        <h2
          id="submit-modal-title"
          className="text-xl font-semibold text-text-primary mb-4"
        >
          Submit Exam?
        </h2>

        {allAnswered ? (
          <p className="text-text-muted mb-6">
            You have answered all {totalQuestions} questions. Once submitted,
            you cannot change your answers.
          </p>
        ) : (
          <div className="mb-6">
            <p className="text-text-muted mb-2">
              You have answered {answeredCount} of {totalQuestions} questions.
            </p>
            <p className="text-accent-amber font-medium">
              âš ï¸ {unansweredCount} question{unansweredCount > 1 ? "s" : ""}{" "}
              {unansweredCount > 1 ? "are" : "is"} unanswered.
            </p>
          </div>
        )}

        <div className="flex justify-end gap-3">
          <button
            type="button"
            onClick={onCancel}
            disabled={isSubmitting}
            className="px-4 py-2 rounded-lg text-text-muted hover:bg-gray-100 transition-colors"
          >
            Go Back
          </button>
          <button
            type="button"
            onClick={onConfirm}
            disabled={isSubmitting}
            className={`
              px-4 py-2 rounded-lg font-medium transition-colors
              ${
                isSubmitting
                  ? "bg-primary-blue/50 text-white cursor-wait"
                  : "bg-primary-blue text-white hover:bg-primary-blue-light"
              }
            `}
          >
            {isSubmitting ? "Submitting..." : "Yes, Submit"}
          </button>
        </div>
      </div>
    </div>
  );
}
```

### src/features/exam/components/ExamProgress.tsx
```
/**
 * MindMosaic â€” Exam Progress Component
 *
 * Shows progress through exam questions.
 * Displays answered vs total and allows jumping to specific questions.
 */

import type { ResponseData } from "../types/exam.types";

interface ExamProgressProps {
  currentIndex: number;
  totalQuestions: number;
  responses: Map<string, ResponseData>;
  questionIds: string[];
  onJumpTo: (index: number) => void;
  /** Whether to show the grid of question buttons */
  showGrid?: boolean;
}

export function ExamProgress({
  currentIndex,
  totalQuestions,
  responses,
  questionIds,
  onJumpTo,
  showGrid = true,
}: ExamProgressProps) {
  // Calculate answered count
  const answeredCount = questionIds.filter((id) => {
    const response = responses.get(id);
    return response && hasContent(response);
  }).length;

  const percentage = Math.round((answeredCount / totalQuestions) * 100);

  return (
    <div className="space-y-4">
      {/* Progress bar */}
      <div className="space-y-2">
        <div className="flex justify-between text-sm">
          <span className="text-text-muted">
            {answeredCount} of {totalQuestions} answered
          </span>
          <span className="text-text-muted font-medium">{percentage}%</span>
        </div>

        <div className="h-2 bg-gray-100 rounded-full overflow-hidden">
          <div
            className="h-full bg-primary-blue transition-all duration-300"
            style={{ width: `${percentage}%` }}
            role="progressbar"
            aria-valuenow={answeredCount}
            aria-valuemin={0}
            aria-valuemax={totalQuestions}
          />
        </div>
      </div>

      {/* Question grid */}
      {showGrid && (
        <div className="flex flex-wrap gap-2">
          {questionIds.map((id, index) => {
            const response = responses.get(id);
            const isAnswered = response && hasContent(response);
            const isCurrent = index === currentIndex;

            return (
              <button
                key={id}
                type="button"
                onClick={() => onJumpTo(index)}
                aria-current={isCurrent ? "step" : undefined}
                aria-label={`Question ${index + 1}${isAnswered ? " (answered)" : " (unanswered)"}`}
                className={`
                  w-10 h-10 rounded-lg text-sm font-medium
                  transition-all
                  focus:outline-none focus:ring-2 focus:ring-primary-blue focus:ring-offset-2
                  ${
                    isCurrent
                      ? "bg-primary-blue text-white ring-2 ring-primary-blue ring-offset-2"
                      : isAnswered
                        ? "bg-success-green/10 text-success-green border border-success-green"
                        : "bg-gray-100 text-text-muted hover:bg-gray-200"
                  }
                `}
              >
                {index + 1}
              </button>
            );
          })}
        </div>
      )}
    </div>
  );
}

// =============================================================================
// Compact Progress (for header)
// =============================================================================

interface CompactProgressProps {
  currentIndex: number;
  totalQuestions: number;
  answeredCount: number;
}

export function CompactProgress({
  currentIndex,
  totalQuestions,
  answeredCount,
}: CompactProgressProps) {
  return (
    <div className="flex items-center gap-3">
      <span className="text-sm text-text-muted">
        Q{currentIndex + 1}/{totalQuestions}
      </span>
      <span className="text-sm text-success-green">
        âœ“ {answeredCount}
      </span>
    </div>
  );
}

// =============================================================================
// Helper
// =============================================================================

function hasContent(response: ResponseData): boolean {
  if ("selectedOptionId" in response) {
    return response.selectedOptionId !== "";
  }
  if ("selectedOptionIds" in response) {
    return response.selectedOptionIds.length > 0;
  }
  if ("answer" in response) {
    if (typeof response.answer === "string") {
      return response.answer.trim() !== "";
    }
    if (typeof response.answer === "number") {
      return !isNaN(response.answer);
    }
  }
  return false;
}
```

### src/features/exam/components/ExamTimer.tsx
```
/**
 * MindMosaic â€” Exam Timer Component
 *
 * Displays countdown timer for exam attempts.
 * Mandatory for Years 3â€“9.
 *
 * Timer is derived from:
 * - Attempt start time
 * - Exam duration (minutes)
 *
 * No auto-submit (handled server-side).
 *
 * BUG-7 FIX: Added ref guard to prevent onTimeExpired firing multiple times
 * when the callback reference changes between renders.
 */

import { useState, useEffect, useMemo, useRef } from "react";

interface ExamTimerProps {
  /** When the attempt started */
  startedAt: Date;
  /** Exam duration in minutes */
  durationMinutes: number;
  /** Whether to show warning colors when time is low */
  showWarnings?: boolean;
  /** Callback when time expires (informational only) */
  onTimeExpired?: () => void;
}

interface TimeRemaining {
  hours: number;
  minutes: number;
  seconds: number;
  totalSeconds: number;
  isExpired: boolean;
}

function calculateTimeRemaining(
  startedAt: Date,
  durationMinutes: number,
): TimeRemaining {
  const now = new Date();
  const endTime = new Date(startedAt.getTime() + durationMinutes * 60 * 1000);
  const diffMs = endTime.getTime() - now.getTime();

  if (diffMs <= 0) {
    return {
      hours: 0,
      minutes: 0,
      seconds: 0,
      totalSeconds: 0,
      isExpired: true,
    };
  }

  const totalSeconds = Math.floor(diffMs / 1000);
  const hours = Math.floor(totalSeconds / 3600);
  const minutes = Math.floor((totalSeconds % 3600) / 60);
  const seconds = totalSeconds % 60;

  return {
    hours,
    minutes,
    seconds,
    totalSeconds,
    isExpired: false,
  };
}

export function ExamTimer({
  startedAt,
  durationMinutes,
  showWarnings = true,
  onTimeExpired,
}: ExamTimerProps) {
  const [timeRemaining, setTimeRemaining] = useState<TimeRemaining>(() =>
    calculateTimeRemaining(startedAt, durationMinutes),
  );

  // BUG-7 FIX: Ref guard to ensure onTimeExpired only fires once.
  // Without this, if onTimeExpired is not memoized by the parent,
  // the effect re-runs and the callback can fire multiple times.
  const hasExpiredRef = useRef(false);

  // Reset the ref if the timer props change (new attempt)
  useEffect(() => {
    hasExpiredRef.current = false;
  }, [startedAt, durationMinutes]);

  // Update timer every second
  useEffect(() => {
    const interval = setInterval(() => {
      const remaining = calculateTimeRemaining(startedAt, durationMinutes);
      setTimeRemaining(remaining);

      // BUG-7 FIX: Only fire once
      if (remaining.isExpired && !hasExpiredRef.current) {
        hasExpiredRef.current = true;
        clearInterval(interval);
        onTimeExpired?.();
      }
    }, 1000);

    return () => clearInterval(interval);
  }, [startedAt, durationMinutes, onTimeExpired]);

  // Determine warning level
  const warningLevel = useMemo(() => {
    if (!showWarnings) return "normal";

    const { totalSeconds, isExpired } = timeRemaining;
    const totalDurationSeconds = durationMinutes * 60;

    if (isExpired) return "expired";
    if (totalSeconds <= 60) return "critical"; // 1 minute
    if (totalSeconds <= 300) return "warning"; // 5 minutes
    if (totalSeconds <= totalDurationSeconds * 0.1) return "warning"; // 10% remaining

    return "normal";
  }, [timeRemaining, durationMinutes, showWarnings]);

  // Format time display
  const formattedTime = useMemo(() => {
    const { hours, minutes, seconds, isExpired } = timeRemaining;

    if (isExpired) return "00:00";

    const pad = (n: number) => String(n).padStart(2, "0");

    if (hours > 0) {
      return `${pad(hours)}:${pad(minutes)}:${pad(seconds)}`;
    }

    return `${pad(minutes)}:${pad(seconds)}`;
  }, [timeRemaining]);

  // Get styles based on warning level
  const getStyles = () => {
    switch (warningLevel) {
      case "expired":
        return {
          container: "bg-danger-red/10 border-danger-red",
          text: "text-danger-red",
          icon: "â°",
        };
      case "critical":
        return {
          container: "bg-danger-red/10 border-danger-red animate-pulse",
          text: "text-danger-red",
          icon: "âš ï¸",
        };
      case "warning":
        return {
          container: "bg-accent-amber/10 border-accent-amber",
          text: "text-accent-amber",
          icon: "â±ï¸",
        };
      default:
        return {
          container: "bg-background-soft border-border-subtle",
          text: "text-text-primary",
          icon: "â±ï¸",
        };
    }
  };

  const styles = getStyles();

  return (
    <div
      className={`
        inline-flex items-center gap-2 px-4 py-2 rounded-lg border
        ${styles.container}
      `}
      role="timer"
      aria-live="polite"
      aria-label={`Time remaining: ${formattedTime}`}
    >
      <span className="text-lg" aria-hidden="true">
        {styles.icon}
      </span>
      <span className={`font-mono text-lg font-semibold ${styles.text}`}>
        {formattedTime}
      </span>
      {timeRemaining.isExpired && (
        <span className="text-sm text-danger-red font-medium">Time's up!</span>
      )}
    </div>
  );
}

// =============================================================================
// Compact Timer (for header)
// =============================================================================

interface CompactTimerProps {
  startedAt: Date;
  durationMinutes: number;
}

export function CompactTimer({
  startedAt,
  durationMinutes,
}: CompactTimerProps) {
  const [timeRemaining, setTimeRemaining] = useState<TimeRemaining>(() =>
    calculateTimeRemaining(startedAt, durationMinutes),
  );

  useEffect(() => {
    const interval = setInterval(() => {
      setTimeRemaining(calculateTimeRemaining(startedAt, durationMinutes));
    }, 1000);

    return () => clearInterval(interval);
  }, [startedAt, durationMinutes]);

  const { hours, minutes, seconds, isExpired, totalSeconds } = timeRemaining;
  const pad = (n: number) => String(n).padStart(2, "0");

  // Warning when less than 5 minutes
  const isWarning = totalSeconds <= 300;
  const isCritical = totalSeconds <= 60;

  const timeString =
    hours > 0
      ? `${pad(hours)}:${pad(minutes)}:${pad(seconds)}`
      : `${pad(minutes)}:${pad(seconds)}`;

  return (
    <span
      className={`
        font-mono font-medium
        ${isExpired ? "text-danger-red" : ""}
        ${isCritical ? "text-danger-red animate-pulse" : ""}
        ${isWarning && !isCritical ? "text-accent-amber" : ""}
        ${!isWarning && !isCritical && !isExpired ? "text-text-primary" : ""}
      `}
      aria-label={`Time remaining: ${timeString}`}
    >
      {timeString}
    </span>
  );
}
```

### src/features/exam/components/ExtendedQuestion.tsx
```
/**
 * MindMosaic â€” Extended Question Component
 *
 * Multi-line text area for extended/essay responses.
 * Includes word count and character guidance.
 */

import { useId, useMemo } from "react";
import type { ExtendedResponseData } from "../types/exam.types";

interface ExtendedQuestionProps {
  questionId: string;
  value: ExtendedResponseData | undefined;
  onChange: (data: ExtendedResponseData) => void;
  disabled?: boolean;
  /** Placeholder text */
  placeholder?: string;
  /** Minimum number of rows. Default: 6 */
  minRows?: number;
  /** Maximum character length. Default: 5000 */
  maxLength?: number;
  /** Suggested word count range. Optional */
  wordCountGuidance?: { min: number; max: number };
}

export function ExtendedQuestion({  
  value,
  onChange,
  disabled = false,
  placeholder = "Type your response here...",
  minRows = 6,
  maxLength = 5000,
  wordCountGuidance,
}: ExtendedQuestionProps) {
  const textareaId = useId();
  const answer = value?.answer ?? "";

  // Calculate word count
  const wordCount = useMemo(() => {
    if (!answer.trim()) return 0;
    return answer.trim().split(/\s+/).length;
  }, [answer]);

  // Determine word count status
  const wordCountStatus = useMemo(() => {
    if (!wordCountGuidance) return null;

    if (wordCount < wordCountGuidance.min) {
      return "under";
    } else if (wordCount > wordCountGuidance.max) {
      return "over";
    } else {
      return "good";
    }
  }, [wordCount, wordCountGuidance]);

  const handleChange = (e: React.ChangeEvent<HTMLTextAreaElement>) => {
    if (disabled) return;
    onChange({ answer: e.target.value });
  };

  return (
    <div className="space-y-2">
      <label htmlFor={textareaId} className="sr-only">
        Your extended response
      </label>

      <textarea
        id={textareaId}
        value={answer}
        onChange={handleChange}
        disabled={disabled}
        placeholder={placeholder}
        maxLength={maxLength}
        rows={minRows}
        aria-describedby={`${textareaId}-hint`}
        className={`
          w-full px-4 py-3 rounded-lg border-2 text-text-primary
          resize-y min-h-[150px] leading-relaxed
          transition-colors
          focus:outline-none focus:ring-2 focus:ring-primary-blue focus:ring-offset-2
          placeholder:text-text-muted
          ${disabled ? "bg-gray-50 cursor-not-allowed" : "bg-white"}
          ${answer ? "border-primary-blue" : "border-border-subtle"}
        `}
      />

      <div
        id={`${textareaId}-hint`}
        className="flex flex-wrap justify-between gap-2 text-xs"
      >
        {/* Word count */}
        <div className="flex items-center gap-2">
          <span
            className={`
              ${wordCountStatus === "under" ? "text-accent-amber" : ""}
              ${wordCountStatus === "over" ? "text-danger-red" : ""}
              ${wordCountStatus === "good" ? "text-success-green" : ""}
              ${!wordCountStatus ? "text-text-muted" : ""}
            `}
          >
            {wordCount} {wordCount === 1 ? "word" : "words"}
          </span>

          {wordCountGuidance && (
            <span className="text-text-muted">
              (aim for {wordCountGuidance.min}â€“{wordCountGuidance.max} words)
            </span>
          )}
        </div>

        {/* Character count */}
        <span className="text-text-muted">
          {answer.length} / {maxLength} characters
        </span>
      </div>
    </div>
  );
}
```

### src/features/exam/components/MarkingQuestionCard.tsx
```
/**
 * MarkingQuestionCard â€” Displays one question for teacher review/marking.
 *
 * For objective types (mcq, multi, short, numeric): read-only display
 * showing the student response, correct answer, and auto-score result.
 *
 * For extended responses: includes an editable score input and feedback
 * textarea that the teacher can fill in before finalizing.
 *
 * This component is intentionally NOT coupled to the student review
 * components (Day 16). While the visual structure is similar, the
 * teacher view includes correct answers and marking affordances that
 * would be inappropriate in the student context.
 */

import type {
  MarkingQuestionData,
  ManualMark,
} from "../../marking/hooks/useAttemptMarking";

interface MarkingQuestionCardProps {
  data: MarkingQuestionData;
  manualMark: ManualMark | undefined;
  onManualMarkChange: (mark: ManualMark) => void;
  /** When true, the attempt is finalized â€” no edits allowed */
  isFinalized: boolean;
}

export function MarkingQuestionCard({
  data,
  manualMark,
  onManualMarkChange,
  isFinalized,
}: MarkingQuestionCardProps) {
  const { question, options, response, correctAnswer, existingScore } = data;

  const isManualType = question.response_type === "extended";
  const needsManualReview =
    existingScore?.requires_manual_review ?? isManualType;

  // Border color based on scoring status
  const borderClass = !existingScore
    ? "border-border-subtle"
    : needsManualReview && !manualMark
      ? "border-accent-amber"
      : existingScore.is_correct ||
          (manualMark && manualMark.score >= question.marks)
        ? "border-success-green"
        : "border-danger-red";

  return (
    <div className={`rounded-lg border-2 bg-white p-5 ${borderClass}`}>
      {/* Header */}
      <div className="mb-3 flex items-start justify-between gap-3">
        <div className="flex items-center gap-2">
          <span className="flex h-7 w-7 shrink-0 items-center justify-center rounded-full bg-primary-blue text-xs font-bold text-white">
            {question.sequence_number}
          </span>
          <div>
            <span className="text-xs font-medium text-text-muted">
              {formatResponseType(question.response_type)} Â· {question.marks}{" "}
              {question.marks === 1 ? "mark" : "marks"} Â· {question.difficulty}
            </span>
            {question.tags.length > 0 && (
              <div className="mt-0.5 flex flex-wrap gap-1">
                {question.tags.map((tag) => (
                  <span
                    key={tag}
                    className="rounded bg-background-soft px-1.5 py-0.5 text-[10px] text-text-muted"
                  >
                    {tag}
                  </span>
                ))}
              </div>
            )}
          </div>
        </div>

        {/* Score badge */}
        <ScoreBadge
          existingScore={existingScore}
          manualMark={manualMark}
          needsManualReview={needsManualReview}
        />
      </div>

      {/* Question prompt */}
      <div className="mb-4">
        <PromptBlocks blocks={question.prompt_blocks} />
      </div>

      {/* Two-column: student response + correct answer */}
      <div className="grid gap-3 sm:grid-cols-2">
        {/* Student's response */}
        <div className="rounded-md border border-border-subtle bg-background-soft p-3">
          <p className="mb-1.5 text-xs font-semibold text-text-muted">
            Student Response
          </p>
          <StudentResponse
            responseType={question.response_type}
            response={response}
            options={options}
          />
        </div>

        {/* Correct answer */}
        <div className="rounded-md border border-success-green/30 bg-success-green/5 p-3">
          <p className="mb-1.5 text-xs font-semibold text-success-green">
            Correct Answer
          </p>
          <CorrectAnswerDisplay
            responseType={question.response_type}
            correctAnswer={correctAnswer}
            options={options}
          />
        </div>
      </div>

      {/* Manual marking form for extended responses */}
      {isManualType && (
        <ManualMarkingForm
          questionId={question.id}
          maxMarks={question.marks}
          manualMark={manualMark}
          onChange={onManualMarkChange}
          isFinalized={isFinalized}
          sampleResponse={correctAnswer?.sample_response ?? null}
          rubric={correctAnswer?.rubric ?? null}
        />
      )}
    </div>
  );
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// Score Badge
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

function ScoreBadge({
  existingScore,
  manualMark,
  needsManualReview,
}: {
  existingScore: MarkingQuestionData["existingScore"];
  manualMark: ManualMark | undefined;
  needsManualReview: boolean;
}) {
  // Manual mark takes precedence in display
  if (manualMark) {
    const isFullMarks = manualMark.score >= manualMark.maxScore;
    return (
      <span
        className={`rounded-full px-2.5 py-0.5 text-xs font-medium ${
          isFullMarks
            ? "bg-success-green/10 text-success-green"
            : "bg-accent-amber/10 text-accent-amber"
        }`}
      >
        {manualMark.score}/{manualMark.maxScore} (teacher)
      </span>
    );
  }

  if (!existingScore) {
    return (
      <span className="rounded-full bg-background-soft px-2.5 py-0.5 text-xs font-medium text-text-muted">
        Not scored
      </span>
    );
  }

  if (needsManualReview) {
    return (
      <span className="rounded-full bg-accent-amber/10 px-2.5 py-0.5 text-xs font-medium text-accent-amber">
        Needs marking
      </span>
    );
  }

  return (
    <span
      className={`rounded-full px-2.5 py-0.5 text-xs font-medium ${
        existingScore.is_correct
          ? "bg-success-green/10 text-success-green"
          : "bg-danger-red/10 text-danger-red"
      }`}
    >
      {existingScore.score}/{existingScore.max_score}
    </span>
  );
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// Student Response Display
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

function StudentResponse({
  responseType,
  response,
  options,
}: {
  responseType: string;
  response: MarkingQuestionData["response"];
  options: MarkingQuestionData["options"];
}) {
  if (!response) {
    return (
      <p className="text-sm italic text-text-muted">No answer provided.</p>
    );
  }

  const rd = response.response_data;

  switch (responseType) {
    case "mcq": {
      const selectedId = rd.selectedOptionId as string | undefined;
      const opt = options.find((o) => o.option_id === selectedId);
      return (
        <p className="text-sm text-text-primary">
          <span className="mr-1.5 font-semibold">{selectedId}.</span>
          {opt?.content ?? "Unknown option"}
        </p>
      );
    }

    case "multi": {
      const selectedIds = (rd.selectedOptionIds as string[] | undefined) ?? [];
      if (selectedIds.length === 0) {
        return <p className="text-sm italic text-text-muted">None selected.</p>;
      }
      return (
        <ul className="space-y-0.5">
          {selectedIds.map((sid) => {
            const opt = options.find((o) => o.option_id === sid);
            return (
              <li key={sid} className="text-sm text-text-primary">
                <span className="mr-1.5 font-semibold">{sid}.</span>
                {opt?.content ?? "Unknown option"}
              </li>
            );
          })}
        </ul>
      );
    }

    case "short":
    case "extended":
      return (
        <p className="whitespace-pre-wrap text-sm leading-relaxed text-text-primary">
          {(rd.answer as string) || "â€”"}
        </p>
      );

    case "numeric":
      return (
        <p className="text-sm font-mono text-text-primary">
          {rd.answer !== undefined ? String(rd.answer) : "â€”"}
        </p>
      );

    default:
      return <p className="text-sm text-text-muted">Unsupported type.</p>;
  }
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// Correct Answer Display
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

function CorrectAnswerDisplay({
  responseType,
  correctAnswer,
  options,
}: {
  responseType: string;
  correctAnswer: MarkingQuestionData["correctAnswer"];
  options: MarkingQuestionData["options"];
}) {
  if (!correctAnswer) {
    return (
      <p className="text-sm italic text-text-muted">No answer key found.</p>
    );
  }

  switch (responseType) {
    case "mcq": {
      const cid = correctAnswer.correct_option_id;
      const opt = cid ? options.find((o) => o.option_id === cid) : null;
      return (
        <p className="text-sm text-text-primary">
          <span className="mr-1.5 font-semibold">{cid}.</span>
          {opt?.content ?? "â€”"}
        </p>
      );
    }

    case "multi": {
      const cids = correctAnswer.correct_option_ids ?? [];
      return (
        <ul className="space-y-0.5">
          {cids.map((cid) => {
            const opt = options.find((o) => o.option_id === cid);
            return (
              <li key={cid} className="text-sm text-text-primary">
                <span className="mr-1.5 font-semibold">{cid}.</span>
                {opt?.content ?? "â€”"}
              </li>
            );
          })}
        </ul>
      );
    }

    case "short": {
      const accepted = correctAnswer.accepted_answers;
      if (Array.isArray(accepted)) {
        return (
          <p className="text-sm text-text-primary">
            {(accepted as string[]).join(", ")}
          </p>
        );
      }
      return (
        <p className="text-sm text-text-primary">{String(accepted ?? "â€”")}</p>
      );
    }

    case "numeric": {
      if (correctAnswer.exact_value !== null) {
        const parts = [`${correctAnswer.exact_value}`];
        if (correctAnswer.tolerance !== null) {
          parts.push(`Â± ${correctAnswer.tolerance}`);
        }
        if (correctAnswer.unit) {
          parts.push(correctAnswer.unit);
        }
        return (
          <p className="text-sm font-mono text-text-primary">
            {parts.join(" ")}
          </p>
        );
      }
      if (
        correctAnswer.range_min !== null &&
        correctAnswer.range_max !== null
      ) {
        return (
          <p className="text-sm font-mono text-text-primary">
            {correctAnswer.range_min} â€“ {correctAnswer.range_max}
            {correctAnswer.unit ? ` ${correctAnswer.unit}` : ""}
          </p>
        );
      }
      return <p className="text-sm text-text-muted">â€”</p>;
    }

    case "extended": {
      if (correctAnswer.sample_response) {
        return (
          <p className="whitespace-pre-wrap text-sm leading-relaxed text-text-primary">
            {correctAnswer.sample_response}
          </p>
        );
      }
      return (
        <p className="text-sm italic text-text-muted">
          See rubric below for marking criteria.
        </p>
      );
    }

    default:
      return <p className="text-sm text-text-muted">â€”</p>;
  }
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// Manual Marking Form
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

function ManualMarkingForm({
  questionId,
  maxMarks,
  manualMark,
  onChange,
  isFinalized,
  sampleResponse,
  rubric,
}: {
  questionId: string;
  maxMarks: number;
  manualMark: ManualMark | undefined;
  onChange: (mark: ManualMark) => void;
  isFinalized: boolean;
  sampleResponse: string | null;
  rubric: unknown;
}) {
  const currentScore = manualMark?.score ?? 0;
  const currentFeedback = manualMark?.feedback ?? "";

```

### src/features/exam/components/MatchingQuestion.tsx
```
/**
 * MindMosaic â€” Matching Question Component
 *
 * response_type: "matching"
 * Students match left items to right items using dropdown selects.
 * No drag interactions â€” keyboard-first, child-friendly.
 *
 * Data shape:
 *   prompt_blocks may contain { type: "matching", pairs: [{ left, right }] }
 *   validation: { correctPairs: { "France": "Paris", ... } }
 *   response: { pairs: { "France": "Paris", ... } }
 */

import { useMemo } from "react";
import type { MatchingResponseData } from "../types/exam.types";

interface MatchingQuestionProps {
  questionId: string;
  /** Left-side items (keys) */
  leftItems: string[];
  /** Right-side items (values, shuffled) */
  rightItems: string[];
  value: MatchingResponseData | undefined;
  onChange: (data: MatchingResponseData) => void;
  disabled?: boolean;
}

export function MatchingQuestion({
  questionId,
  leftItems,
  rightItems,
  value,
  onChange,
  disabled = false,
}: MatchingQuestionProps) {
  const currentPairs = value?.pairs ?? {};

  // Shuffle right items once for display (stable via useMemo)
  const shuffledRight = useMemo(() => {
    return [...rightItems].sort(() => 0.5 - Math.random());
    // eslint-disable-next-line react-hooks/exhaustive-deps
  }, [rightItems.join(",")]);

  const handlePairChange = (leftItem: string, rightItem: string) => {
    if (disabled) return;
    const newPairs = { ...currentPairs };
    if (rightItem === "") {
      delete newPairs[leftItem];
    } else {
      newPairs[leftItem] = rightItem;
    }
    onChange({ pairs: newPairs });
  };

  // Track which right items are already used
  const usedRightItems = new Set(Object.values(currentPairs));

  return (
    <div
      className="space-y-4"
      role="group"
      aria-labelledby={`question-${questionId}`}
      aria-describedby={`matching-hint-${questionId}`}
    >
      <p
        id={`matching-hint-${questionId}`}
        className="text-sm text-text-muted mb-2"
      >
        Match each item on the left with the correct item on the right.
      </p>

      <div className="space-y-3">
        {leftItems.map((leftItem) => {
          const selectedRight = currentPairs[leftItem] ?? "";

          return (
            <div
              key={leftItem}
              className={`
                flex items-center gap-4 rounded-lg border-2 bg-white p-4
                transition-all
                ${disabled ? "opacity-60" : ""}
                ${selectedRight ? "border-primary-blue/30" : "border-border-subtle"}
              `}
            >
              {/* Left item */}
              <span className="flex-1 font-medium text-text-primary">
                {leftItem}
              </span>

              {/* Arrow */}
              <span className="text-text-muted shrink-0" aria-hidden="true">
                â†’
              </span>

              {/* Right item dropdown */}
              <select
                value={selectedRight}
                onChange={(e) => handlePairChange(leftItem, e.target.value)}
                disabled={disabled}
                aria-label={`Match for ${leftItem}`}
                className={`
                  flex-1 rounded-lg border-2 px-3 py-2.5 text-text-primary
                  transition-colors focus-ring
                  ${disabled ? "bg-gray-50 cursor-not-allowed" : "bg-white cursor-pointer"}
                  ${selectedRight ? "border-primary-blue" : "border-border-subtle"}
                `}
              >
                <option value="">Select a matchâ€¦</option>
                {shuffledRight.map((rightItem) => {
                  // Show option if: it's the currently selected one, or it's not used elsewhere
                  const isCurrentSelection = rightItem === selectedRight;
                  const isUsedElsewhere =
                    usedRightItems.has(rightItem) && !isCurrentSelection;

                  return (
                    <option
                      key={rightItem}
                      value={rightItem}
                      disabled={isUsedElsewhere}
                    >
                      {rightItem}
                      {isUsedElsewhere ? " (used)" : ""}
                    </option>
                  );
                })}
              </select>
            </div>
          );
        })}
      </div>

      {/* Progress indicator */}
      <p className="text-xs text-text-muted text-right">
        {Object.keys(currentPairs).length} of {leftItems.length} matched
      </p>
    </div>
  );
}
```

### src/features/exam/components/McqQuestion.tsx
```
/**
 * MindMosaic â€” MCQ Question Component
 *
 * Multiple choice question with single selection.
 * Renders options A, B, C, D with radio button behavior.
 */

import type { ExamQuestionOption, McqResponseData } from "../types/exam.types";

interface McqQuestionProps {
  questionId: string;
  options: ExamQuestionOption[];
  value: McqResponseData | undefined;
  onChange: (data: McqResponseData) => void;
  disabled?: boolean;
}

export function McqQuestion({
  questionId,
  options,
  value,
  onChange,
  disabled = false,
}: McqQuestionProps) {
  const selectedOptionId = value?.selectedOptionId ?? "";

  const handleSelect = (optionId: string) => {
    if (disabled) return;
    onChange({ selectedOptionId: optionId });
  };

  return (
    <div className="space-y-3" role="radiogroup" aria-labelledby={`question-${questionId}`}>
      {options.map((option) => {
        const isSelected = selectedOptionId === option.option_id;

        return (
          <button
            key={option.option_id}
            type="button"
            role="radio"
            aria-checked={isSelected}
            disabled={disabled}
            onClick={() => handleSelect(option.option_id)}
            className={`
              w-full text-left p-4 rounded-lg border-2 transition-all
              focus:outline-none focus:ring-2 focus:ring-primary-blue focus:ring-offset-2
              ${disabled ? "cursor-not-allowed opacity-60" : "cursor-pointer hover:border-primary-blue-light"}
              ${
                isSelected
                  ? "border-primary-blue bg-primary-blue/5"
                  : "border-border-subtle bg-white"
              }
            `}
          >
            <div className="flex items-start gap-3">
              {/* Option letter badge */}
              <span
                className={`
                  shrink-0 w-8 h-8 rounded-full flex items-center justify-center
                  font-semibold text-sm transition-colors
                  ${
                    isSelected
                      ? "bg-primary-blue text-white"
                      : "bg-gray-100 text-text-muted"
                  }
                `}
              >
                {option.option_id}
              </span>

              {/* Option content */}
              <span className="text-text-primary pt-1">{option.content}</span>
            </div>
          </button>
        );
      })}
    </div>
  );
}
```

### src/features/exam/components/MultiSelectQuestion.tsx
```
/**
 * MindMosaic â€” Multi-Select Question Component
 *
 * Multiple choice question allowing multiple selections.
 * Uses checkbox behavior instead of radio buttons.
 */

import type {
  ExamQuestionOption,
  MultiSelectResponseData,
} from "../types/exam.types";

interface MultiSelectQuestionProps {
  questionId: string;
  options: ExamQuestionOption[];
  value: MultiSelectResponseData | undefined;
  onChange: (data: MultiSelectResponseData) => void;
  disabled?: boolean;
}

export function MultiSelectQuestion({
  questionId,
  options,
  value,
  onChange,
  disabled = false,
}: MultiSelectQuestionProps) {
  const selectedOptionIds = value?.selectedOptionIds ?? [];

  const handleToggle = (optionId: string) => {
    if (disabled) return;

    const isCurrentlySelected = selectedOptionIds.includes(optionId);
    let newSelectedIds: string[];

    if (isCurrentlySelected) {
      // Remove from selection
      newSelectedIds = selectedOptionIds.filter((id) => id !== optionId);
    } else {
      // Add to selection
      newSelectedIds = [...selectedOptionIds, optionId];
    }

    onChange({ selectedOptionIds: newSelectedIds });
  };

  return (
    <div className="space-y-3" role="group" aria-labelledby={`question-${questionId}`}>
      <p className="text-sm text-text-muted mb-2">
        Select all that apply
      </p>

      {options.map((option) => {
        const isSelected = selectedOptionIds.includes(option.option_id);

        return (
          <button
            key={option.option_id}
            type="button"
            role="checkbox"
            aria-checked={isSelected}
            disabled={disabled}
            onClick={() => handleToggle(option.option_id)}
            className={`
              w-full text-left p-4 rounded-lg border-2 transition-all
              focus:outline-none focus:ring-2 focus:ring-primary-blue focus:ring-offset-2
              ${disabled ? "cursor-not-allowed opacity-60" : "cursor-pointer hover:border-primary-blue-light"}
              ${
                isSelected
                  ? "border-primary-blue bg-primary-blue/5"
                  : "border-border-subtle bg-white"
              }
            `}
          >
            <div className="flex items-start gap-3">
              {/* Checkbox indicator */}
              <span
                className={`
                  shrink-0 w-6 h-6 rounded border-2 flex items-center justify-center
                  transition-colors mt-0.5
                  ${
                    isSelected
                      ? "border-primary-blue bg-primary-blue"
                      : "border-gray-300 bg-white"
                  }
                `}
              >
                {isSelected && (
                  <svg
                    className="w-4 h-4 text-white"
                    fill="none"
                    stroke="currentColor"
                    viewBox="0 0 24 24"
                  >
                    <path
                      strokeLinecap="round"
                      strokeLinejoin="round"
                      strokeWidth={2}
                      d="M5 13l4 4L19 7"
                    />
                  </svg>
                )}
              </span>

              {/* Option letter badge */}
              <span
                className={`
                  shrink-0 w-8 h-8 rounded-full flex items-center justify-center
                  font-semibold text-sm transition-colors
                  ${
                    isSelected
                      ? "bg-primary-blue text-white"
                      : "bg-gray-100 text-text-muted"
                  }
                `}
              >
                {option.option_id}
              </span>

              {/* Option content */}
              <span className="text-text-primary pt-1">{option.content}</span>
            </div>
          </button>
        );
      })}
    </div>
  );
}
```

### src/features/exam/components/NumericQuestion.tsx
```
/**
 * MindMosaic â€” Numeric Question Component
 *
 * Number input for numeric answers.
 * Supports decimal values and optional unit display.
 */

import { useId, useState } from "react";
import type { NumericResponseData } from "../types/exam.types";

interface NumericQuestionProps {
  questionId: string;
  value: NumericResponseData | undefined;
  onChange: (data: NumericResponseData) => void;
  disabled?: boolean;
  /** Placeholder text. Default: "Enter a number" */
  placeholder?: string;
  /** Unit to display (e.g., "cm", "kg"). Optional */
  unit?: string;
  /** Minimum value. Optional */
  min?: number;
  /** Maximum value. Optional */
  max?: number;
  /** Step value for increment/decrement. Default: "any" */
  step?: number | "any";
}

export function NumericQuestion({
  value,
  onChange,
  disabled = false,
  placeholder = "Enter a number",
  unit,
  min,
  max,
  step = "any",
}: NumericQuestionProps) {
  const inputId = useId();

  // Track raw input value for better UX with decimals and negative numbers
  const [inputValue, setInputValue] = useState<string>(
    value?.answer !== undefined ? String(value.answer) : ""
  );

  const handleChange = (e: React.ChangeEvent<HTMLInputElement>) => {
    if (disabled) return;

    const rawValue = e.target.value;
    setInputValue(rawValue);

    // Parse the value
    const numValue = parseFloat(rawValue);

    if (!isNaN(numValue)) {
      onChange({ answer: numValue });
    }
  };

  const handleBlur = () => {
    // On blur, format the display value to match the actual value
    if (value?.answer !== undefined) {
      setInputValue(String(value.answer));
    }
  };

  return (
    <div className="space-y-2">
      <label htmlFor={inputId} className="sr-only">
        Your numeric answer
      </label>

      <div className="relative">
        <input
          id={inputId}
          type="number"
          value={inputValue}
          onChange={handleChange}
          onBlur={handleBlur}
          disabled={disabled}
          placeholder={placeholder}
          min={min}
          max={max}
          step={step}
          className={`
            w-full px-4 py-3 rounded-lg border-2 text-text-primary
            transition-colors
            focus:outline-none focus:ring-2 focus:ring-primary-blue focus:ring-offset-2
            placeholder:text-text-muted
            ${disabled ? "bg-gray-50 cursor-not-allowed" : "bg-white"}
            ${inputValue ? "border-primary-blue" : "border-border-subtle"}
            ${unit ? "pr-16" : ""}
            [appearance:textfield] [&::-webkit-outer-spin-button]:appearance-none [&::-webkit-inner-spin-button]:appearance-none
          `}
        />

        {unit && (
          <span className="absolute right-4 top-1/2 -translate-y-1/2 text-text-muted font-medium">
            {unit}
          </span>
        )}
      </div>

      <p className="text-xs text-text-muted">
        Enter a numeric value
        {min !== undefined && max !== undefined && ` between ${min} and ${max}`}
        {min !== undefined && max === undefined && ` (minimum: ${min})`}
        {max !== undefined && min === undefined && ` (maximum: ${max})`}
      </p>
    </div>
  );
}
```

### src/features/exam/components/OrderingQuestion.tsx
```
/**
 * MindMosaic â€” Ordering Question Component
 *
 * response_type: "ordering"
 * Students arrange items in the correct order using up/down buttons.
 * No drag interactions â€” keyboard-first, child-friendly.
 *
 * Data shape:
 *   prompt_blocks may contain { type: "ordering", instruction, items }
 *   validation: { correctOrder: [...] }
 *   response: { orderedItems: [...] }
 */

import { useCallback } from "react";
import type { OrderingResponseData } from "../types/exam.types";

interface OrderingQuestionProps {
  questionId: string;
  /** The initial shuffled items from the prompt block */
  items: string[];
  value: OrderingResponseData | undefined;
  onChange: (data: OrderingResponseData) => void;
  disabled?: boolean;
}

export function OrderingQuestion({
  questionId,
  items,
  value,
  onChange,
  disabled = false,
}: OrderingQuestionProps) {
  // Use the current ordering from response, or fall back to the initial items
  const currentOrder = value?.orderedItems ?? items;

  const moveItem = useCallback(
    (index: number, direction: -1 | 1) => {
      if (disabled) return;
      const targetIndex = index + direction;
      if (targetIndex < 0 || targetIndex >= currentOrder.length) return;

      const newOrder = [...currentOrder];
      [newOrder[index], newOrder[targetIndex]] = [
        newOrder[targetIndex],
        newOrder[index],
      ];
      onChange({ orderedItems: newOrder });
    },
    [currentOrder, disabled, onChange],
  );

  return (
    <div
      className="space-y-2"
      role="list"
      aria-labelledby={`question-${questionId}`}
      aria-describedby={`ordering-hint-${questionId}`}
    >
      <p
        id={`ordering-hint-${questionId}`}
        className="text-sm text-text-muted mb-3"
      >
        Arrange these items in the correct order. Use the arrows to move items
        up or down.
      </p>

      {currentOrder.map((item, index) => (
        <div
          key={`${item}-${index}`}
          role="listitem"
          className={`
            flex items-center gap-3 rounded-lg border-2 bg-white p-4
            transition-all
            ${disabled ? "opacity-60" : ""}
            ${value ? "border-primary-blue/30" : "border-border-subtle"}
          `}
        >
          {/* Position number */}
          <span className="flex h-8 w-8 shrink-0 items-center justify-center rounded-full bg-primary-blue text-sm font-bold text-white">
            {index + 1}
          </span>

          {/* Item content */}
          <span className="flex-1 text-text-primary">{item}</span>

          {/* Move buttons */}
          <div className="flex flex-col gap-1">
            <button
              type="button"
              disabled={disabled || index === 0}
              onClick={() => moveItem(index, -1)}
              aria-label={`Move "${item}" up`}
              className={`
                rounded p-1.5 transition-colors touch-target focus-ring
                ${
                  disabled || index === 0
                    ? "text-gray-300 cursor-not-allowed"
                    : "text-text-muted hover:bg-background-soft hover:text-primary-blue"
                }
              `}
            >
              <svg
                className="h-4 w-4"
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
              >
                <path
                  strokeLinecap="round"
                  strokeLinejoin="round"
                  strokeWidth={2}
                  d="M5 15l7-7 7 7"
                />
              </svg>
            </button>
            <button
              type="button"
              disabled={disabled || index === currentOrder.length - 1}
              onClick={() => moveItem(index, 1)}
              aria-label={`Move "${item}" down`}
              className={`
                rounded p-1.5 transition-colors touch-target focus-ring
                ${
                  disabled || index === currentOrder.length - 1
                    ? "text-gray-300 cursor-not-allowed"
                    : "text-text-muted hover:bg-background-soft hover:text-primary-blue"
                }
              `}
            >
              <svg
                className="h-4 w-4"
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
              >
                <path
                  strokeLinecap="round"
                  strokeLinejoin="round"
                  strokeWidth={2}
                  d="M19 9l-7 7-7-7"
                />
              </svg>
            </button>
          </div>
        </div>
      ))}
    </div>
  );
}
```

### src/features/exam/components/QuestionRenderer.tsx
```
/**
 * MindMosaic â€” Question Renderer
 *
 * Routes to appropriate question component based on response_type.
 * Combines prompt blocks with response input.
 */

import { PromptBlockRenderer } from "./PromptBlockRenderer";
import { McqQuestion } from "./McqQuestion";
import { MultiSelectQuestion } from "./MultiSelectQuestion";
import { TrueFalseQuestion } from "./TrueFalseQuestion";
import { ShortAnswerQuestion } from "./ShortAnswerQuestion";
import { NumericQuestion } from "./NumericQuestion";
import { ExtendedQuestion } from "./ExtendedQuestion";
import { BooleanQuestion } from "./BooleanQuestion";
import { OrderingQuestion } from "./OrderingQuestion";
import { MatchingQuestion } from "./MatchingQuestion";
import { ClozeQuestion } from "./ClozeQuestion";
import type {
  QuestionWithOptions,
  ResponseData,
  PromptBlock,
  McqResponseData,
  MultiSelectResponseData,
  ShortResponseData,
  NumericResponseData,
  ExtendedResponseData,
  BooleanResponseData,
  BooleanValidation,
  OrderingResponseData,
  OrderingPromptBlock,
  MatchingResponseData,
  MatchingPromptBlock,
} from "../types/exam.types";

interface QuestionRendererProps {
  question: QuestionWithOptions;
  questionNumber: number;
  totalQuestions: number;
  value: ResponseData | undefined;
  onChange: (data: ResponseData) => void;
  disabled?: boolean;
  showHint?: boolean;
}

export function QuestionRenderer({
  question,
  questionNumber,
  totalQuestions,
  value,
  onChange,
  disabled = false,
  showHint = false,
}: QuestionRendererProps) {
  const promptBlocks = question.prompt_blocks as PromptBlock[];

  return (
    <div className="space-y-6">
      {/* Question header */}
      <div className="flex items-center justify-between">
        <span className="text-sm font-medium text-text-muted">
          Question {questionNumber} of {totalQuestions}
        </span>
        <span className="text-sm text-text-muted">
          {question.marks} {question.marks === 1 ? "mark" : "marks"}
        </span>
      </div>

      {/* Question prompt */}
      <div className="bg-white rounded-lg border border-border-subtle p-6">
        <PromptBlockRenderer blocks={promptBlocks} />
      </div>

      {/* Hint (optional) */}
      {showHint && question.hint && (
        <div className="bg-blue-50 border border-primary-blue-light rounded-lg p-4">
          <p className="text-sm text-primary-blue flex items-start gap-2">
            <span className="shrink-0">ğŸ’¡</span>
            <span>{question.hint}</span>
          </p>
        </div>
      )}

      {/* Response input */}
      <div className="pt-2">
        <ResponseInput
          question={question}
          value={value}
          onChange={onChange}
          disabled={disabled}
        />
      </div>
    </div>
  );
}

// =============================================================================
// Response Input Router
// =============================================================================

interface ResponseInputProps {
  question: QuestionWithOptions;
  value: ResponseData | undefined;
  onChange: (data: ResponseData) => void;
  disabled: boolean;
}

function ResponseInput({
  question,
  value,
  onChange,
  disabled,
}: ResponseInputProps) {
  switch (question.response_type) {
    case "mcq":
      // Check if this is a true/false question (only 2 options with True/False content)
      if (
        question.options?.length === 2 &&
        question.options.some((o) =>
          ["true", "false"].includes(o.content.toLowerCase())
        )
      ) {
        return (
          <TrueFalseQuestion
            questionId={question.id}
            value={value as McqResponseData | undefined}
            onChange={onChange}
            disabled={disabled}
          />
        );
      }

      // Regular MCQ
      if (!question.options || question.options.length === 0) {
        return (
          <p className="text-danger-red">
            Error: No options available for this question
          </p>
        );
      }

      return (
        <McqQuestion
          questionId={question.id}
          options={question.options}
          value={value as McqResponseData | undefined}
          onChange={onChange}
          disabled={disabled}
        />
      );

    // multi_select is the canonical type; "multi" is a legacy alias
    case "multi_select":
    case "multi":
      if (!question.options || question.options.length === 0) {
        return (
          <p className="text-danger-red">
            Error: No options available for this question
          </p>
        );
      }

      return (
        <MultiSelectQuestion
          questionId={question.id}
          options={question.options}
          value={value as MultiSelectResponseData | undefined}
          onChange={onChange}
          disabled={disabled}
        />
      );

    case "short": {
      // Detect cloze presentation: text prompt contains ___ blanks
      const textBlock = (question.prompt_blocks as PromptBlock[]).find(
        (b) => b.type === "text",
      );
      const hasBlanks =
        textBlock && "content" in textBlock && /___+/.test(textBlock.content);

      if (hasBlanks) {
        return (
          <ClozeQuestion
            questionId={question.id}
            text={textBlock.content}
            value={value as ShortResponseData | undefined}
            onChange={onChange}
            disabled={disabled}
          />
        );
      }

      return (
        <ShortAnswerQuestion
          questionId={question.id}
          value={value as ShortResponseData | undefined}
          onChange={onChange}
          disabled={disabled}
        />
      );
    }

    case "numeric":
      return (
        <NumericQuestion
          questionId={question.id}
          value={value as NumericResponseData | undefined}
          onChange={onChange}
          disabled={disabled}
        />
      );

    case "boolean": {
      return (
        <BooleanQuestion
          questionId={question.id}
          value={value as BooleanResponseData | undefined}
          onChange={onChange}
          disabled={disabled}
          validation={question.validation as BooleanValidation | null | undefined}
        />
      );
    }

    case "ordering": {
      const orderingBlock = (question.prompt_blocks as PromptBlock[]).find(
        (b): b is OrderingPromptBlock => b.type === "ordering",
      );
      const items = orderingBlock?.items ?? [];

      if (items.length === 0) {
        return (
          <p className="text-danger-red">
            Error: No items available for ordering question
          </p>
        );
      }

      return (
        <OrderingQuestion
          questionId={question.id}
          items={items}
          value={value as OrderingResponseData | undefined}
          onChange={onChange}
          disabled={disabled}
        />
      );
    }

    case "matching": {
      const matchingBlock = (question.prompt_blocks as PromptBlock[]).find(
        (b): b is MatchingPromptBlock => b.type === "matching",
      );
      const pairs = matchingBlock?.pairs ?? [];

      if (pairs.length === 0) {
        return (
          <p className="text-danger-red">
            Error: No pairs available for matching question
          </p>
        );
      }

      const leftItems = pairs.map((p) => p.left);
      const rightItems = pairs.map((p) => p.right);

      return (
        <MatchingQuestion
          questionId={question.id}
          leftItems={leftItems}
          rightItems={rightItems}
          value={value as MatchingResponseData | undefined}
          onChange={onChange}
          disabled={disabled}
        />
      );
    }

    // Legacy: extended is no longer a supported type but existing data should
    // render gracefully. Re-use ExtendedQuestion for backward compatibility.
    case "extended":
      return (
        <ExtendedQuestion
          questionId={question.id}
          value={value as ExtendedResponseData | undefined}
          onChange={onChange}
          disabled={disabled}
        />
      );

    default:
      return (
        <p className="text-danger-red">
          Unsupported question type: {question.response_type}
        </p>
      );
  }
}```

### src/features/exam/components/ReviewQuestionCard.tsx
```
import type { ReviewQuestionData } from "../hooks/useExamReview";

interface ReviewQuestionCardProps {
  data: ReviewQuestionData;
}

/**
 * Read-only card showing one question, the student's response,
 * and (when scored) whether it was correct plus the correct answer.
 *
 * Assumption: prompt_blocks follow the PromptBlock union from Day 15.
 * This component renders them inline â€” it does NOT reuse the Day 15
 * PromptBlockRenderer to avoid coupling review code to attempt-runtime code.
 * If a shared renderer is preferred later, this can be swapped in.
 */
export function ReviewQuestionCard({ data }: ReviewQuestionCardProps) {
  const { question, options, response, breakdown } = data;

  // Correctness state: null = not yet scored
  const isScored = breakdown !== null;
  const isCorrect = breakdown?.correct ?? null;
  const requiresManualReview = breakdown?.requires_manual_review ?? false;

  // Border color based on correctness
  const borderClass = !isScored
    ? "border-border-subtle"
    : isCorrect
      ? "border-success-green"
      : requiresManualReview
        ? "border-accent-amber"
        : "border-danger-red";

  return (
    <div
      className={`rounded-lg border-2 bg-white p-5 ${borderClass}`}
      role="article"
      aria-label={`Question ${question.sequence_number}`}
    >
      {/* Header row */}
      <div className="mb-3 flex items-start justify-between gap-3">
        <div className="flex items-center gap-2">
          <span className="flex h-7 w-7 shrink-0 items-center justify-center rounded-full bg-primary-blue text-xs font-bold text-white">
            {question.sequence_number}
          </span>
          <span className="text-xs font-medium text-text-muted">
            {question.marks} {question.marks === 1 ? "mark" : "marks"} Â·{" "}
            {formatResponseType(question.response_type)}
          </span>
        </div>

        {/* Correctness badge */}
        {isScored && (
          <CorrectnessBadge correct={isCorrect} manual={requiresManualReview} />
        )}
      </div>

      {/* Question prompt */}
      <div className="mb-4">
        <PromptBlocks blocks={question.prompt_blocks} />
      </div>

      {/* Answer section â€” varies by response type */}
      <AnswerDisplay
        responseType={question.response_type}
        options={options}
        response={response}
        breakdown={breakdown}
      />

      {/* Score breakdown */}
      {isScored && (
        <div className="mt-3 border-t border-border-subtle pt-3">
          <p className="text-xs text-text-muted">
            Score: {breakdown.marks_awarded} / {breakdown.marks_possible}
          </p>
        </div>
      )}
    </div>
  );
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// Sub-components
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

function CorrectnessBadge({
  correct,
  manual,
}: {
  correct: boolean | null;
  manual: boolean;
}) {
  if (manual) {
    return (
      <span className="inline-flex items-center gap-1 rounded-full bg-accent-amber/10 px-2.5 py-0.5 text-xs font-medium text-accent-amber">
        <svg className="h-3.5 w-3.5" viewBox="0 0 20 20" fill="currentColor">
          <path
            fillRule="evenodd"
            d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z"
            clipRule="evenodd"
          />
        </svg>
        Pending Review
      </span>
    );
  }

  if (correct) {
    return (
      <span className="inline-flex items-center gap-1 rounded-full bg-success-green/10 px-2.5 py-0.5 text-xs font-medium text-success-green">
        <svg className="h-3.5 w-3.5" viewBox="0 0 20 20" fill="currentColor">
          <path
            fillRule="evenodd"
            d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z"
            clipRule="evenodd"
          />
        </svg>
        Correct
      </span>
    );
  }

  return (
    <span className="inline-flex items-center gap-1 rounded-full bg-danger-red/10 px-2.5 py-0.5 text-xs font-medium text-danger-red">
      <svg className="h-3.5 w-3.5" viewBox="0 0 20 20" fill="currentColor">
        <path
          fillRule="evenodd"
          d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z"
          clipRule="evenodd"
        />
      </svg>
      Incorrect
    </span>
  );
}

// â”€â”€ Prompt block renderer (self-contained for review) â”€â”€

interface PromptBlocksProps {
  blocks: Array<Record<string, unknown>>;
}

function PromptBlocks({ blocks }: PromptBlocksProps) {
  return (
    <div className="space-y-2">
      {blocks.map((block, i) => {
        const key = `pb-${i}`;
        switch (block.type) {
          case "text":
            return (
              <p
                key={key}
                className="text-sm text-text-primary leading-relaxed"
              >
                {block.content as string}
              </p>
            );
          case "heading": {
            const level = block.level as number;
            const Tag = level === 1 ? "h3" : level === 2 ? "h4" : "h5";
            return (
              <Tag
                key={key}
                className="text-sm font-semibold text-text-primary"
              >
                {block.content as string}
              </Tag>
            );
          }
          case "list": {
            const ListTag = (block.ordered as boolean) ? "ol" : "ul";
            const listClass = (block.ordered as boolean)
              ? "list-decimal"
              : "list-disc";
            return (
              <ListTag
                key={key}
                className={`ml-5 space-y-1 text-sm text-text-primary ${listClass}`}
              >
                {(block.items as string[]).map((item, j) => (
                  <li key={j}>{item}</li>
                ))}
              </ListTag>
            );
          }
          case "quote":
            return (
              <blockquote
                key={key}
                className="border-l-3 border-primary-blue pl-3 text-sm italic text-text-muted"
              >
                {block.content as string}
                {typeof block.attribution === "string" && (
                  <span className="mt-1 block text-xs not-italic">
                    - {block.attribution}
                  </span>
                )}
              </blockquote>
            );
          case "instruction":
            return (
              <p
                key={key}
                className="rounded-md bg-background-soft px-3 py-2 text-sm font-medium text-primary-blue"
              >
                {block.content as string}
              </p>
            );
          case "image":
            return (
              <img
                key={key}
                src={block.src as string}
                alt={block.alt as string}
                className="max-w-full rounded-md"
              />
            );
          default:
            return null;
        }
      })}
    </div>
  );
}

// â”€â”€ Answer display by response type â”€â”€

interface AnswerDisplayProps {
  responseType: string;
  options: Array<{
    question_id: string;
    option_id: string;
    content: string;
    media_reference: unknown;
  }>;
  response: {
    response_data: Record<string, unknown>;
  } | null;
  breakdown: {
    correct_answer?: unknown;
  } | null;
}

function AnswerDisplay({
  responseType,
  options,
  response,
  breakdown,
}: AnswerDisplayProps) {
  const responseData = response?.response_data ?? null;
  const correctAnswer = breakdown?.correct_answer ?? null;

  switch (responseType) {
    case "mcq":
      return (
        <McqReview
          options={options}
          selectedId={responseData?.selectedOptionId as string | undefined}
          correctId={correctAnswer as string | undefined}
        />
      );

    case "multi_select":
    case "multi":
      return (
        <MultiSelectReview
          options={options}
          selectedIds={
            (responseData?.selectedOptionIds as string[] | undefined) ?? []
          }
          correctIds={(correctAnswer as string[] | undefined) ?? []}
        />
      );

    case "short":
      return (
        <TextAnswerReview
          label="Your answer"
          answer={responseData?.answer as string | undefined}
          correctAnswer={
            // correct_answer for short may be a string or array
            typeof correctAnswer === "string"
              ? correctAnswer
              : Array.isArray(correctAnswer)
                ? (correctAnswer as string[]).join(", ")
                : undefined
          }
        />
      );

    case "numeric":
      return (
        <TextAnswerReview
          label="Your answer"
          answer={
            responseData?.answer !== undefined
              ? String(responseData.answer)
              : undefined
          }
          correctAnswer={
            correctAnswer !== undefined && correctAnswer !== null
              ? String(correctAnswer)
              : undefined
          }
        />
      );

    case "extended":
      return (
        <ExtendedReview answer={responseData?.answer as string | undefined} />
      );

    case "boolean":
      return (
        <BooleanReview
          answer={responseData?.answer as boolean | undefined}
          explanation={responseData?.explanation as string | undefined}
          correctAnswer={correctAnswer as boolean | undefined}
        />
      );

    case "ordering":
      return (
        <OrderingReview
          orderedItems={
            (responseData?.orderedItems as string[] | undefined) ?? []
          }
          correctOrder={(correctAnswer as string[] | undefined) ?? []}
        />
      );

    case "matching":
      return (
        <MatchingReview
          pairs={
            (responseData?.pairs as Record<string, string> | undefined) ?? {}
          }
          correctPairs={
            (correctAnswer as Record<string, string> | undefined) ?? {}
          }
        />
      );

    default:
      return (
        <p className="text-sm text-text-muted italic">
          Unsupported response type: {responseType}
        </p>
      );
  }
}

// â”€â”€ MCQ review â”€â”€

function McqReview({
  options,
  selectedId,
  correctId,
}: {
  options: Array<{ option_id: string; content: string }>;
  selectedId?: string;
  correctId?: string;
}) {
  if (options.length === 0) {
    return (
      <p className="text-sm text-text-muted italic">No options available.</p>
    );
  }

  return (
    <div className="space-y-2">
      {options.map((opt) => {
        const isSelected = opt.option_id === selectedId;
        const isCorrectOption =
          correctId !== undefined && opt.option_id === correctId;

        let bgClass = "bg-white";
        let borderColorClass = "border-border-subtle";
        let iconSlot: React.ReactNode = null;

        if (isSelected && isCorrectOption) {
          bgClass = "bg-success-green/5";
          borderColorClass = "border-success-green";
          iconSlot = <CheckIcon className="text-success-green" />;
        } else if (isSelected && !isCorrectOption && correctId !== undefined) {
          bgClass = "bg-danger-red/5";
          borderColorClass = "border-danger-red";
          iconSlot = <CrossIcon className="text-danger-red" />;
        } else if (isCorrectOption) {
          bgClass = "bg-success-green/5";
          borderColorClass = "border-success-green/50";
          iconSlot = <CheckIcon className="text-success-green/60" />;
        }

        return (
          <div
            key={opt.option_id}
            className={`flex items-center gap-3 rounded-md border px-3 py-2.5 text-sm ${bgClass} ${borderColorClass}`}
          >
            <span className="flex h-6 w-6 shrink-0 items-center justify-center rounded-full border border-border-subtle text-xs font-semibold text-text-muted">
```

### src/features/exam/components/ReviewQuestionNav.tsx
```
import type { ReviewQuestionData } from "../hooks/useExamReview";

interface ReviewQuestionNavProps {
  questions: ReviewQuestionData[];
  activeIndex: number;
  onSelect: (index: number) => void;
}

function getButtonColorClass(
  isActive: boolean,
  isScored: boolean,
  isManual: boolean,
  isCorrect: boolean,
): string {
  if (!isScored) {
    return isActive
      ? "bg-primary-blue text-white"
      : "bg-background-soft text-text-muted hover:bg-border-subtle";
  }
  if (isManual) {
    return isActive
      ? "bg-accent-amber text-white"
      : "bg-accent-amber/10 text-accent-amber hover:bg-accent-amber/20";
  }
  if (isCorrect) {
    return isActive
      ? "bg-success-green text-white"
      : "bg-success-green/10 text-success-green hover:bg-success-green/20";
  }
  return isActive
    ? "bg-danger-red text-white"
    : "bg-danger-red/10 text-danger-red hover:bg-danger-red/20";
}

/**
 * Compact question navigator for the review page.
 * Shows numbered buttons with color-coded correctness.
 */
export function ReviewQuestionNav({
  questions,
  activeIndex,
  onSelect,
}: ReviewQuestionNavProps) {
  return (
    <div className="flex flex-wrap gap-1.5">
      {questions.map((q, i) => {
        const isActive = i === activeIndex;
        const breakdown = q.breakdown;
        const isScored = breakdown !== null;
        const isCorrect = breakdown?.correct ?? false;
        const isManual = breakdown?.requires_manual_review ?? false;

        const colorClass = getButtonColorClass(
          isActive,
          isScored,
          isManual,
          isCorrect,
        );

        // Unanswered indicator
        const unanswered = q.response === null;

        return (
          <button
            key={q.question.id}
            type="button"
            onClick={() => onSelect(i)}
            className={`relative flex h-8 w-8 items-center justify-center rounded-md text-xs font-semibold transition-colors ${colorClass}`}
            aria-label={`Go to question ${q.question.sequence_number}`}
            aria-current={isActive ? "step" : undefined}
          >
            {q.question.sequence_number}
            {/* Small dot for unanswered */}
            {unanswered && (
              <span className="absolute -right-0.5 -top-0.5 h-2 w-2 rounded-full bg-accent-amber" />
            )}
          </button>
        );
      })}
    </div>
  );
}
```

### src/features/exam/components/ShortAnswerQuestion.tsx
```
/**
 * MindMosaic â€” Short Answer Question Component
 *
 * Single-line or short text input for brief answers.
 */

import { useId } from "react";
import type { ShortResponseData } from "../types/exam.types";

interface ShortAnswerQuestionProps {
  questionId: string;
  value: ShortResponseData | undefined;
  onChange: (data: ShortResponseData) => void;
  disabled?: boolean;
  /** Placeholder text. Default: "Type your answer here..." */
  placeholder?: string;
  /** Maximum character length */
  maxLength?: number;
}

export function ShortAnswerQuestion({  
  value,
  onChange,
  disabled = false,
  placeholder = "Type your answer here...",
  maxLength = 500,
}: ShortAnswerQuestionProps) {
  const inputId = useId();
  const answer = value?.answer ?? "";

  const handleChange = (e: React.ChangeEvent<HTMLInputElement>) => {
    if (disabled) return;
    onChange({ answer: e.target.value });
  };

  return (
    <div className="space-y-2">
      <label htmlFor={inputId} className="sr-only">
        Your answer
      </label>

      <input
        id={inputId}
        type="text"
        value={answer}
        onChange={handleChange}
        disabled={disabled}
        placeholder={placeholder}
        maxLength={maxLength}
        aria-describedby={`${inputId}-hint`}
        className={`
          w-full px-4 py-3 rounded-lg border-2 text-text-primary
          transition-colors
          focus:outline-none focus:ring-2 focus:ring-primary-blue focus:ring-offset-2
          placeholder:text-text-muted
          ${disabled ? "bg-gray-50 cursor-not-allowed" : "bg-white"}
          ${answer ? "border-primary-blue" : "border-border-subtle"}
        `}
      />

      <div
        id={`${inputId}-hint`}
        className="flex justify-between text-xs text-text-muted"
      >
        <span>Enter a short answer</span>
        <span>
          {answer.length} / {maxLength}
        </span>
      </div>
    </div>
  );
}
```

### src/features/exam/components/TrueFalseQuestion.tsx
```
/**
 * MindMosaic â€” True/False Question Component
 *
 * Simplified MCQ with True/False options.
 * Uses the same response data structure as MCQ (selectedOptionId: "A" or "B")
 */

import type { McqResponseData } from "../types/exam.types";

interface TrueFalseQuestionProps {
  questionId: string;
  value: McqResponseData | undefined;
  onChange: (data: McqResponseData) => void;
  disabled?: boolean;
  /** Custom labels for the options. Defaults to "True" and "False" */
  labels?: { true: string; false: string };
}

export function TrueFalseQuestion({
  questionId,
  value,
  onChange,
  disabled = false,
  labels = { true: "True", false: "False" },
}: TrueFalseQuestionProps) {
  // Map to option IDs: A = True, B = False
  const selectedOptionId = value?.selectedOptionId ?? "";

  const handleSelect = (optionId: "A" | "B") => {
    if (disabled) return;
    onChange({ selectedOptionId: optionId });
  };

  const options = [
    { id: "A" as const, label: labels.true },
    { id: "B" as const, label: labels.false },
  ];

  return (
    <div
      className="flex gap-4"
      role="radiogroup"
      aria-labelledby={`question-${questionId}`}
    >
      {options.map((option) => {
        const isSelected = selectedOptionId === option.id;

        return (
          <button
            key={option.id}
            type="button"
            role="radio"
            aria-checked={isSelected}
            disabled={disabled}
            onClick={() => handleSelect(option.id)}
            className={`
              flex-1 py-4 px-6 rounded-lg border-2 transition-all
              font-medium text-center
              focus:outline-none focus:ring-2 focus:ring-primary-blue focus:ring-offset-2
              ${disabled ? "cursor-not-allowed opacity-60" : "cursor-pointer hover:border-primary-blue-light"}
              ${
                isSelected
                  ? "border-primary-blue bg-primary-blue text-white"
                  : "border-border-subtle bg-white text-text-primary"
              }
            `}
          >
            {option.label}
          </button>
        );
      })}
    </div>
  );
}
```

### src/features/exams/components/ExamPublishControls.tsx
```
/**
 * ExamPublishControls â€” Admin controls for exam lifecycle
 *
 * Displays current status and provides actions:
 * - Publish (with optional scheduling)
 * - Unpublish (back to draft)
 * - Archive
 */

import { useState } from "react";
import { useExamPublishing } from "../hooks/useExamPublishing";
import type { ExamPackage, ExamStatus } from "../types/exam-publishing.types";

interface ExamPublishControlsProps {
  exam: ExamPackage;
  onStatusChange?: () => void;
}

export function ExamPublishControls({
  exam,
  onStatusChange,
}: ExamPublishControlsProps) {
  const { isUpdating, updateError, publishExam, unpublishExam, archiveExam } =
    useExamPublishing();

  // Scheduling state
  const [showScheduling, setShowScheduling] = useState(false);
  const [availableFrom, setAvailableFrom] = useState(
    exam.available_from
      ? new Date(exam.available_from).toISOString().slice(0, 16)
      : "",
  );
  const [availableUntil, setAvailableUntil] = useState(
    exam.available_until
      ? new Date(exam.available_until).toISOString().slice(0, 16)
      : "",
  );

  // Confirmation state
  const [confirmAction, setConfirmAction] = useState<
    "publish" | "unpublish" | "archive" | null
  >(null);

  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  // Handle Publish
  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  const handlePublish = async () => {
    const from = availableFrom || null;
    const until = availableUntil || null;

    const result = await publishExam(exam.id, from, until);

    if (result.success) {
      setConfirmAction(null);
      setShowScheduling(false);
      onStatusChange?.();
    }
  };

  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  // Handle Unpublish
  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  const handleUnpublish = async () => {
    const result = await unpublishExam(exam.id);

    if (result.success) {
      setConfirmAction(null);
      onStatusChange?.();
    }
  };

  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  // Handle Archive
  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  const handleArchive = async () => {
    const result = await archiveExam(exam.id);

    if (result.success) {
      setConfirmAction(null);
      onStatusChange?.();
    }
  };

  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  // Render
  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  return (
    <div className="space-y-4">
      {/* Status Badge */}
      <div className="flex items-center gap-2">
        <span className="text-sm font-medium text-text-muted">Status:</span>
        <StatusBadge status={exam.status} />
      </div>

      {/* Availability Info */}
      {exam.status === "published" && (
        <div className="rounded-md bg-background-soft p-3 text-sm">
          <div className="font-medium text-text-primary">
            Availability Window
          </div>
          <div className="mt-1 space-y-1 text-text-muted">
            {exam.available_from ? (
              <div>
                Opens:{" "}
                {new Date(exam.available_from).toLocaleString("en-AU", {
                  dateStyle: "medium",
                  timeStyle: "short",
                })}
              </div>
            ) : (
              <div>Opens: Immediately</div>
            )}
            {exam.available_until ? (
              <div>
                Closes:{" "}
                {new Date(exam.available_until).toLocaleString("en-AU", {
                  dateStyle: "medium",
                  timeStyle: "short",
                })}
              </div>
            ) : (
              <div>Closes: No end date</div>
            )}
          </div>
        </div>
      )}

      {/* Error Display */}
      {updateError && (
        <div className="rounded-md bg-danger-red/10 px-4 py-3 text-sm text-danger-red">
          {updateError}
        </div>
      )}

      {/* Confirmation Modal */}
      {confirmAction && (
        <div className="rounded-md border border-border-subtle bg-background-soft p-4">
          <ConfirmationPrompt
            action={confirmAction}
            onConfirm={async () => {
              if (confirmAction === "publish") await handlePublish();
              if (confirmAction === "unpublish") await handleUnpublish();
              if (confirmAction === "archive") await handleArchive();
            }}
            onCancel={() => setConfirmAction(null)}
            isProcessing={isUpdating}
          />
        </div>
      )}

      {/* Scheduling Form (for publish) */}
      {showScheduling && (
        <div className="space-y-3 rounded-md border border-border-subtle bg-white p-4">
          <div className="font-medium text-text-primary">
            Set Availability Window (Optional)
          </div>

          <div>
            <label className="mb-1 block text-sm text-text-muted">
              Available From
            </label>
            <input
              type="datetime-local"
              value={availableFrom}
              onChange={(e) => setAvailableFrom(e.target.value)}
              className="w-full rounded-md border border-border-subtle px-3 py-2 text-sm"
            />
          </div>

          <div>
            <label className="mb-1 block text-sm text-text-muted">
              Available Until
            </label>
            <input
              type="datetime-local"
              value={availableUntil}
              onChange={(e) => setAvailableUntil(e.target.value)}
              className="w-full rounded-md border border-border-subtle px-3 py-2 text-sm"
            />
          </div>

          <div className="flex justify-end gap-2 border-t border-border-subtle pt-3">
            <button
              type="button"
              onClick={() => setShowScheduling(false)}
              className="rounded-md border border-border-subtle bg-white px-3 py-1.5 text-sm font-medium text-text-primary hover:bg-background-soft"
            >
              Cancel
            </button>
            <button
              type="button"
              onClick={() => {
                setShowScheduling(false);
                setConfirmAction("publish");
              }}
              className="rounded-md bg-primary-blue px-3 py-1.5 text-sm font-medium text-white hover:bg-primary-blue-light"
            >
              Continue to Publish
            </button>
          </div>
        </div>
      )}

      {/* Action Buttons */}
      {!confirmAction && !showScheduling && (
        <div className="flex flex-wrap gap-2">
          {exam.status === "draft" && (
            <>
              <button
                type="button"
                onClick={() => setConfirmAction("publish")}
                disabled={isUpdating}
                className="rounded-md bg-success-green px-4 py-2 text-sm font-medium text-white hover:opacity-90 disabled:opacity-50"
              >
                Publish Now
              </button>
              <button
                type="button"
                onClick={() => setShowScheduling(true)}
                disabled={isUpdating}
                className="rounded-md border border-border-subtle bg-white px-4 py-2 text-sm font-medium text-text-primary hover:bg-background-soft disabled:opacity-50"
              >
                Schedule Publish
              </button>
            </>
          )}

          {exam.status === "published" && (
            <>
              <button
                type="button"
                onClick={() => setConfirmAction("unpublish")}
                disabled={isUpdating}
                className="rounded-md border border-border-subtle bg-white px-4 py-2 text-sm font-medium text-text-primary hover:bg-background-soft disabled:opacity-50"
              >
                Unpublish
              </button>
              <button
                type="button"
                onClick={() => setConfirmAction("archive")}
                disabled={isUpdating}
                className="rounded-md border border-danger-red bg-white px-4 py-2 text-sm font-medium text-danger-red hover:bg-danger-red/10 disabled:opacity-50"
              >
                Archive
              </button>
            </>
          )}

          {exam.status === "archived" && (
            <div className="text-sm text-text-muted">
              Archived exams cannot be modified. Create a new version if needed.
            </div>
          )}
        </div>
      )}
    </div>
  );
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// Status Badge
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

function StatusBadge({ status }: { status: ExamStatus }) {
  const styles: Record<ExamStatus, string> = {
    draft: "bg-gray-100 text-gray-700",
    published: "bg-success-green/10 text-success-green",
    archived: "bg-text-muted/10 text-text-muted",
  };

  return (
    <span
      className={`rounded-full px-2.5 py-0.5 text-xs font-medium ${styles[status]}`}
    >
      {status.charAt(0).toUpperCase() + status.slice(1)}
    </span>
  );
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// Confirmation Prompt
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

interface ConfirmationPromptProps {
  action: "publish" | "unpublish" | "archive";
  onConfirm: () => void;
  onCancel: () => void;
  isProcessing: boolean;
}

function ConfirmationPrompt({
  action,
  onConfirm,
  onCancel,
  isProcessing,
}: ConfirmationPromptProps) {
  const messages = {
    publish: {
      title: "Publish Exam?",
      body: "Once published, this exam becomes read-only and visible to students. You will not be able to edit questions or options.",
      confirmLabel: "Publish Exam",
      confirmStyle: "bg-success-green text-white hover:opacity-90",
    },
    unpublish: {
      title: "Unpublish Exam?",
      body: "This exam will return to draft status and become hidden from students. Any existing attempts will remain but students cannot start new attempts.",
      confirmLabel: "Unpublish",
      confirmStyle: "bg-primary-blue text-white hover:bg-primary-blue-light",
    },
    archive: {
      title: "Archive Exam?",
      body: "Archived exams are permanently hidden from students and cannot be edited. Existing student attempts and data will be preserved.",
      confirmLabel: "Archive Exam",
      confirmStyle: "bg-danger-red text-white hover:opacity-90",
    },
  };

  const config = messages[action];

  return (
    <div>
      <div className="mb-2 font-medium text-text-primary">{config.title}</div>
      <div className="mb-4 text-sm text-text-muted">{config.body}</div>
      <div className="flex justify-end gap-2">
        <button
          type="button"
          onClick={onCancel}
          disabled={isProcessing}
          className="rounded-md border border-border-subtle bg-white px-3 py-1.5 text-sm font-medium text-text-primary hover:bg-background-soft disabled:opacity-50"
        >
          Cancel
        </button>
        <button
          type="button"
          onClick={onConfirm}
          disabled={isProcessing}
          className={`rounded-md px-3 py-1.5 text-sm font-medium disabled:opacity-50 ${config.confirmStyle}`}
        >
          {isProcessing ? "Processing..." : config.confirmLabel}
        </button>
      </div>
    </div>
  );
}
```

### src/features/parent/components/ExamResultCard.tsx
```
/**
 * ExamResultCard â€” Display single exam summary for parent
 */

import { Link } from "react-router-dom";
import type { ParentExamSummary } from "../types/parent-dashboard.types";

interface ExamResultCardProps {
  exam: ParentExamSummary;
}

export function ExamResultCard({ exam }: ExamResultCardProps) {
  return (
    <div className="rounded-lg border border-border-subtle bg-white p-4">
      <div className="mb-3 flex items-start justify-between">
        <div className="flex-1">
          <h3 className="font-semibold text-text-primary">{exam.exam_title}</h3>
          <div className="mt-1 flex items-center gap-3 text-sm text-text-muted">
            <span>Year {exam.year_level}</span>
            <span>{exam.subject}</span>
            <span>{exam.duration_minutes} min</span>
            <span>{exam.total_marks} marks</span>
          </div>
        </div>
        <StatusBadge status={exam.status} />
      </div>

      {/* Results */}
      {exam.status === "submitted" && (
        <div className="mt-3 border-t border-border-subtle pt-3">
          {exam.is_marked ? (
            <div className="flex items-center justify-between">
              <div>
                <div className="text-sm text-text-muted">Score</div>
                <div className="text-lg font-semibold text-text-primary">
                  {exam.total_score} / {exam.total_marks}
                  <span className="ml-2 text-base font-normal text-text-muted">
                    ({exam.percentage}%)
                  </span>
                </div>
              </div>
              {exam.attempt_id && (
                <Link
                  to={`/parent/exams/${exam.attempt_id}`}
                  className="text-sm text-primary-blue hover:underline"
                >
                  View Details â†’
                </Link>
              )}
            </div>
          ) : (
            <div className="text-sm text-text-muted">
              Submitted {new Date(exam.submitted_at!).toLocaleDateString()} â€¢
              Awaiting marking
            </div>
          )}
        </div>
      )}

      {exam.status === "in_progress" && (
        <div className="mt-3 border-t border-border-subtle pt-3">
          <div className="text-sm text-text-muted">Exam in progress</div>
        </div>
      )}

      {exam.status === "not_started" && (
        <div className="mt-3 border-t border-border-subtle pt-3">
          <div className="text-sm text-text-muted">Not yet started</div>
        </div>
      )}
    </div>
  );
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// Status Badge
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

function StatusBadge({
  status,
}: {
  status: "not_started" | "in_progress" | "submitted";
}) {
  const styles = {
    not_started: "bg-gray-100 text-gray-700",
    in_progress: "bg-primary-blue/10 text-primary-blue",
    submitted: "bg-success-green/10 text-success-green",
  };

  const labels = {
    not_started: "Not Started",
    in_progress: "In Progress",
    submitted: "Submitted",
  };

  return (
    <span
      className={`rounded-full px-2.5 py-0.5 text-xs font-medium ${styles[status]}`}
    >
      {labels[status]}
    </span>
  );
}
```

### src/features/parent/components/ProgressTable.tsx
```
/**
 * ProgressTable â€” Display progress summary by subject
 */

import type { ProgressSummary } from "../types/parent-dashboard.types";

interface ProgressTableProps {
  summary: ProgressSummary;
}

export function ProgressTable({ summary }: ProgressTableProps) {
  return (
    <div className="rounded-lg border border-border-subtle bg-white p-6">
      <h2 className="mb-4 text-lg font-semibold text-text-primary">
        Overall Progress
      </h2>

      {/* Summary Stats */}
      <div className="mb-6 grid gap-4 sm:grid-cols-4">
        <StatCard label="Total Exams" value={summary.total_exams} />
        <StatCard label="Completed" value={summary.completed_exams} />
        <StatCard label="In Progress" value={summary.in_progress} />
        <StatCard
          label="Average"
          value={
            summary.average_percentage !== null
              ? `${summary.average_percentage}%`
              : "â€”"
          }
        />
      </div>

      {/* By Subject */}
      {summary.exams_by_subject.length > 0 && (
        <>
          <h3 className="mb-3 font-medium text-text-primary">By Subject</h3>
          <div className="overflow-hidden rounded-md border border-border-subtle">
            <table className="w-full">
              <thead className="bg-background-soft">
                <tr>
                  <th className="px-4 py-2 text-left text-sm font-medium text-text-primary">
                    Subject
                  </th>
                  <th className="px-4 py-2 text-center text-sm font-medium text-text-primary">
                    Exams
                  </th>
                  <th className="px-4 py-2 text-center text-sm font-medium text-text-primary">
                    Average
                  </th>
                  <th className="px-4 py-2 text-center text-sm font-medium text-text-primary">
                    Highest
                  </th>
                  <th className="px-4 py-2 text-center text-sm font-medium text-text-primary">
                    Lowest
                  </th>
                </tr>
              </thead>
              <tbody className="divide-y divide-border-subtle">
                {summary.exams_by_subject.map((subject) => (
                  <tr
                    key={subject.subject}
                    className="hover:bg-background-soft"
                  >
                    <td className="px-4 py-3 text-sm font-medium text-text-primary">
                      {subject.subject}
                    </td>
                    <td className="px-4 py-3 text-center text-sm text-text-muted">
                      {subject.exam_count}
                    </td>
                    <td className="px-4 py-3 text-center text-sm text-text-primary">
                      {subject.average_percentage !== null
                        ? `${subject.average_percentage}%`
                        : "â€”"}
                    </td>
                    <td className="px-4 py-3 text-center text-sm text-text-primary">
                      {subject.highest_score !== null
                        ? `${subject.highest_score}%`
                        : "â€”"}
                    </td>
                    <td className="px-4 py-3 text-center text-sm text-text-primary">
                      {subject.lowest_score !== null
                        ? `${subject.lowest_score}%`
                        : "â€”"}
                    </td>
                  </tr>
                ))}
              </tbody>
            </table>
          </div>
        </>
      )}
    </div>
  );
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// Stat Card
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

function StatCard({ label, value }: { label: string; value: string | number }) {
  return (
    <div className="rounded-md border border-border-subtle bg-background-soft p-4">
      <div className="text-sm text-text-muted">{label}</div>
      <div className="mt-1 text-2xl font-semibold text-text-primary">
        {value}
      </div>
    </div>
  );
}
```

### src/features/reporting/components/ExamAttemptsTable.tsx
```
import { useState } from "react";
import type { AttemptRow } from "../hooks/useExamAttempts";

interface ExamAttemptsTableProps {
  attempts: AttemptRow[];
  onOpenAttempt: (attemptId: string) => void;
}

type SortField =
  | "student"
  | "status"
  | "score"
  | "started"
  | "submitted"
  | "time";
type SortDir = "asc" | "desc";

export function ExamAttemptsTable({
  attempts,
  onOpenAttempt,
}: ExamAttemptsTableProps) {
  const [sortField, setSortField] = useState<SortField>("submitted");
  const [sortDir, setSortDir] = useState<SortDir>("desc");

  const handleSort = (field: SortField) => {
    if (sortField === field) {
      setSortDir((d) => (d === "asc" ? "desc" : "asc"));
    } else {
      setSortField(field);
      setSortDir("desc");
    }
  };

  const sorted = [...attempts].sort((a, b) => {
    const dir = sortDir === "asc" ? 1 : -1;

    switch (sortField) {
      case "student":
        return a.student_id.localeCompare(b.student_id) * dir;
      // BUG-2 FIX: Added parentheses so `dir` multiplies the full expression
      case "status":
        return (statusOrder(a.status) - statusOrder(b.status)) * dir;
      case "score": {
        const aScore = a.result?.percentage ?? -1;
        const bScore = b.result?.percentage ?? -1;
        return (aScore - bScore) * dir;
      }
      case "started":
        return (
          (new Date(a.started_at).getTime() -
            new Date(b.started_at).getTime()) *
          dir
        );
      case "submitted": {
        const aTime = a.submitted_at ? new Date(a.submitted_at).getTime() : 0;
        const bTime = b.submitted_at ? new Date(b.submitted_at).getTime() : 0;
        return (aTime - bTime) * dir;
      }
      case "time": {
        const aT = a.time_taken_seconds ?? 0;
        const bT = b.time_taken_seconds ?? 0;
        return (aT - bT) * dir;
      }
      default:
        return 0;
    }
  });

  if (attempts.length === 0) {
    return (
      <div className="rounded-lg border border-border-subtle bg-white p-8 text-center">
        <p className="text-sm text-text-muted">
          No attempts found for this exam.
        </p>
      </div>
    );
  }

  return (
    <div className="overflow-hidden rounded-lg border border-border-subtle bg-white">
      <div className="overflow-x-auto">
        <table className="w-full text-left text-sm">
          <thead>
            <tr className="border-b border-border-subtle bg-background-soft">
              <SortHeader
                label="Student"
                field="student"
                current={sortField}
                dir={sortDir}
                onSort={handleSort}
              />
              <SortHeader
                label="Status"
                field="status"
                current={sortField}
                dir={sortDir}
                onSort={handleSort}
              />
              <SortHeader
                label="Score"
                field="score"
                current={sortField}
                dir={sortDir}
                onSort={handleSort}
              />
              <SortHeader
                label="Started"
                field="started"
                current={sortField}
                dir={sortDir}
                onSort={handleSort}
              />
              <SortHeader
                label="Submitted"
                field="submitted"
                current={sortField}
                dir={sortDir}
                onSort={handleSort}
              />
              <SortHeader
                label="Time Taken"
                field="time"
                current={sortField}
                dir={sortDir}
                onSort={handleSort}
              />
              <th className="px-4 py-3 font-medium text-text-muted">Action</th>
            </tr>
          </thead>
          <tbody>
            {sorted.map((attempt) => (
              <tr
                key={attempt.id}
                className="border-b border-border-subtle last:border-b-0 hover:bg-background-soft/50"
              >
                {/* Student */}
                <td className="px-4 py-3">
                  <span className="font-mono text-xs text-text-muted">
                    {attempt.student_id.slice(0, 8)}â€¦
                  </span>
                </td>

                {/* Status */}
                <td className="px-4 py-3">
                  <StatusBadge status={attempt.status} />
                </td>

                {/* Score */}
                <td className="px-4 py-3">
                  {attempt.result ? (
                    <div>
                      <span className="text-sm font-medium text-text-primary">
                        {attempt.result.total_score} /{" "}
                        {attempt.result.max_score}
                      </span>
                      <span className="ml-1.5 text-xs text-text-muted">
                        ({Math.round(attempt.result.percentage)}%)
                      </span>
                      {attempt.result.passed ? (
                        <span className="ml-1.5 text-xs text-success-green">
                          âœ“
                        </span>
                      ) : (
                        <span className="ml-1.5 text-xs text-danger-red">
                          âœ—
                        </span>
                      )}
                    </div>
                  ) : (
                    <span className="text-xs text-text-muted">â€”</span>
                  )}
                </td>

                {/* Started */}
                <td className="px-4 py-3 text-xs text-text-muted">
                  {formatTimestamp(attempt.started_at)}
                </td>

                {/* Submitted */}
                <td className="px-4 py-3 text-xs text-text-muted">
                  {attempt.submitted_at
                    ? formatTimestamp(attempt.submitted_at)
                    : "â€”"}
                </td>

                {/* Time taken */}
                <td className="px-4 py-3 text-xs text-text-muted">
                  {attempt.time_taken_seconds !== null
                    ? formatDuration(attempt.time_taken_seconds)
                    : "â€”"}
                </td>

                {/* Action */}
                <td className="px-4 py-3">
                  {attempt.status !== "started" ? (
                    <button
                      type="button"
                      onClick={() => onOpenAttempt(attempt.id)}
                      className="rounded-md bg-primary-blue px-3 py-1.5 text-xs font-medium text-white hover:bg-primary-blue-light"
                    >
                      {attempt.status === "evaluated" ? "Review" : "Mark"}
                    </button>
                  ) : (
                    <span className="text-xs text-text-muted">In progress</span>
                  )}
                </td>
              </tr>
            ))}
          </tbody>
        </table>
      </div>
    </div>
  );
}

// â”€â”€ Sub-components â”€â”€

function SortHeader({
  label,
  field,
  current,
  dir,
  onSort,
}: {
  label: string;
  field: SortField;
  current: SortField;
  dir: SortDir;
  onSort: (field: SortField) => void;
}) {
  const isActive = current === field;

  return (
    <th className="px-4 py-3">
      <button
        type="button"
        onClick={() => onSort(field)}
        className="flex items-center gap-1 font-medium text-text-muted hover:text-text-primary"
      >
        {label}
        {isActive && (
          <svg
            className={`h-3 w-3 transition-transform ${
              dir === "asc" ? "rotate-180" : ""
            }`}
            viewBox="0 0 12 12"
            fill="currentColor"
          >
            <path d="M6 8L2 4h8L6 8z" />
          </svg>
        )}
      </button>
    </th>
  );
}

function StatusBadge({ status }: { status: AttemptRow["status"] }) {
  switch (status) {
    case "evaluated":
      return (
        <span className="inline-flex items-center rounded-full bg-success-green/10 px-2.5 py-0.5 text-xs font-medium text-success-green">
          Evaluated
        </span>
      );
    case "submitted":
      return (
        <span className="inline-flex items-center rounded-full bg-accent-amber/10 px-2.5 py-0.5 text-xs font-medium text-accent-amber">
          Submitted
        </span>
      );
    case "started":
      return (
        <span className="inline-flex items-center rounded-full bg-background-soft px-2.5 py-0.5 text-xs font-medium text-text-muted">
          In Progress
        </span>
      );
    default:
      return null;
  }
}

// â”€â”€ Helpers â”€â”€

function statusOrder(status: string): number {
  switch (status) {
    case "submitted":
      return 0;
    case "evaluated":
      return 1;
    case "started":
      return 2;
    default:
      return 3;
  }
}

function formatTimestamp(iso: string): string {
  return new Date(iso).toLocaleString("en-AU", {
    dateStyle: "medium",
    timeStyle: "short",
  });
}

function formatDuration(totalSeconds: number): string {
  const hours = Math.floor(totalSeconds / 3600);
  const minutes = Math.floor((totalSeconds % 3600) / 60);
  const seconds = totalSeconds % 60;

  const parts: string[] = [];
  if (hours > 0) parts.push(`${hours}h`);
  if (minutes > 0) parts.push(`${minutes}m`);
  if (seconds > 0 || parts.length === 0) parts.push(`${seconds}s`);
  return parts.join(" ");
}
```

### src/features/reporting/components/ExamSummaryPanel.tsx
```
import type {
  ExamPackageSummary,
  ExamAttemptsSummary,
} from "../hooks/useExamAttempts";

interface ExamSummaryPanelProps {
  examPackage: ExamPackageSummary;
  summary: ExamAttemptsSummary;
}

export function ExamSummaryPanel({
  examPackage,
  summary,
}: ExamSummaryPanelProps) {
  return (
    <div className="rounded-lg border border-border-subtle bg-white p-5">
      {/* Exam title */}
      <div className="mb-4">
        <h2 className="text-lg font-semibold text-text-primary">
          {examPackage.title}
        </h2>
        <p className="mt-0.5 text-sm text-text-muted">
          Year {examPackage.year_level} Â· {examPackage.subject} Â·{" "}
          {examPackage.assessment_type.toUpperCase()} Â· Max{" "}
          {examPackage.total_marks} marks
        </p>
      </div>

      {/* Stats grid */}
      <div className="grid grid-cols-2 gap-3 sm:grid-cols-4">
        <StatCard
          label="Total Attempts"
          value={String(summary.total_attempts)}
        />
        <StatCard
          label="Submitted"
          value={String(summary.submitted_count)}
          sub="Awaiting evaluation"
        />
        <StatCard
          label="Evaluated"
          value={String(summary.evaluated_count)}
          sub={
            summary.evaluated_count > 0
              ? `${summary.pass_count} passed Â· ${summary.fail_count} not passed`
              : undefined
          }
        />
        <StatCard
          label="In Progress"
          value={String(
            summary.total_attempts -
              summary.submitted_count -
              summary.evaluated_count,
          )}
          sub="Started but not submitted"
        />
      </div>

      {/* Score stats â€” only if there are evaluated attempts */}
      {summary.evaluated_count > 0 && (
        <div className="mt-3 grid grid-cols-2 gap-3 sm:grid-cols-4">
          <StatCard
            label="Avg Score"
            value={
              summary.average_score !== null
                ? `${summary.average_score} / ${examPackage.total_marks}`
                : "â€”"
            }
          />
          <StatCard
            label="Median Score"
            value={
              summary.median_score !== null
                ? `${summary.median_score} / ${examPackage.total_marks}`
                : "â€”"
            }
          />
          <StatCard
            label="Avg %"
            value={
              summary.average_percentage !== null
                ? `${Math.round(summary.average_percentage)}%`
                : "â€”"
            }
          />
          <StatCard
            label="Median %"
            value={
              summary.median_percentage !== null
                ? `${Math.round(summary.median_percentage)}%`
                : "â€”"
            }
          />
        </div>
      )}
    </div>
  );
}

// â”€â”€ Stat card â”€â”€

function StatCard({
  label,
  value,
  sub,
}: {
  label: string;
  value: string;
  sub?: string;
}) {
  return (
    <div className="rounded-md bg-background-soft px-3 py-2.5">
      <p className="text-xs font-medium text-text-muted">{label}</p>
      <p className="mt-0.5 text-base font-semibold text-text-primary">
        {value}
      </p>
      {sub && <p className="mt-0.5 text-xs text-text-muted">{sub}</p>}
    </div>
  );
}
```

## State Management (Zustand / Stores)

## Supabase Integration

### src/context/auth-context.ts
```
import { createContext } from "react";
import type { Session, User, AuthError } from "@supabase/supabase-js";
import type { UserRole, Profile } from "../lib/database.types";

interface AuthState {
  session: Session | null;
  user: User | null;
  profile: Profile | null;
  role: UserRole | null;
  isLoading: boolean;
  isAuthenticated: boolean;
}

export interface AuthContextValue extends AuthState {
  signIn: (
    email: string,
    password: string,
  ) => Promise<{ error: AuthError | null }>;
  signUp: (
    email: string,
    password: string,
  ) => Promise<{ error: AuthError | null }>;
  signOut: () => Promise<void>;
  refreshProfile: () => Promise<void>;
}

export const AuthContext = createContext<AuthContextValue | null>(null);
```

### src/lib/supabase.ts
```
/**
 * MindMosaic â€” Supabase Client
 *
 * Single, shared Supabase client for frontend.
 *
 * Environment variables:
 *   VITE_SUPABASE_URL
 *   VITE_SUPABASE_ANON_KEY
 */

import { createClient } from "@supabase/supabase-js";
import type { Database } from "./database.types";

const supabaseUrl = import.meta.env.VITE_SUPABASE_URL;
const supabaseAnonKey = import.meta.env.VITE_SUPABASE_ANON_KEY;

// Validate environment variables at startup
if (!supabaseUrl || !supabaseAnonKey) {
  throw new Error(
    "Missing Supabase environment variables. Check your .env file:\n" +
    "VITE_SUPABASE_URL=https://your-project.supabase.co\n" +
    "VITE_SUPABASE_ANON_KEY=your-anon-key"
  );
}

if (!supabaseUrl.startsWith("https://")) {
  throw new Error("VITE_SUPABASE_URL must start with https://");
}

if (!supabaseAnonKey.startsWith("eyJ")) {
  throw new Error("VITE_SUPABASE_ANON_KEY must be a valid JWT");
}

export const supabase = createClient<Database>(supabaseUrl, supabaseAnonKey, {
  auth: {
    autoRefreshToken: true,
    persistSession: true,
    detectSessionInUrl: true,
    storage: window.localStorage,
  },
});

/**
 * Call a Supabase Edge Function with authentication
 */
export async function callEdgeFunction<T>(
  functionName: string,
  body: Record<string, unknown>,
  options: { signal?: AbortSignal } = {},
): Promise<{ data: T | null; error: string | null; status: number }> {
  try {
    const { data: { session } } = await supabase.auth.getSession();

    if (!session) {
      return { data: null, error: "Not authenticated", status: 401 };
    }

    const response = await fetch(
      `${supabaseUrl}/functions/v1/${functionName}`,
      {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
          Authorization: `Bearer ${session.access_token}`,
        },
        body: JSON.stringify(body),
        signal: options.signal,
      }
    );

    const data = await response.json();

    if (!response.ok) {
      return {
        data: null,
        error: data.error || data.message || `Request failed (${response.status})`,
        status: response.status,
      };
    }

    return { data: data as T, error: null, status: response.status };
  } catch (err) {
    const message = err instanceof Error ? err.message : "Network error";
    return { data: null, error: message, status: 500 };
  }
}
```

## Styling & Theme

### src/index.css
```
@import "tailwindcss";

/* =============================================================================
   MindMosaic Theme - Tailwind v4 Custom Theme
   
   This @theme block defines custom design tokens that generate utility classes.
   Example: --color-primary-blue generates bg-primary-blue, text-primary-blue, etc.
   ============================================================================= */

@theme {
  /* Primary Brand Colors */
  --color-primary-blue: #1d4ed8;
  --color-primary-blue-light: #2563eb;

  /* Background Colors */
  --color-background-soft: #eef5ff;

  /* Text Colors */
  --color-text-primary: #0f172a;
  --color-text-muted: #475569;

  /* Border Colors */
  --color-border-subtle: #d8e2f3;

  /* Status Colors */
  --color-accent-amber: #f59e0b;
  --color-success-green: #16a34a;
  --color-danger-red: #dc2626;
}

/* =============================================================================
   Base Styles
   ============================================================================= */

:root {
  --brand-font:
    "IBM Plex Sans", system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
}

body {
  font-family: var(--brand-font);
  letter-spacing: 0.01em;
  font-weight: 400;
}

/* =============================================================================
   Animation Keyframes (used by Tailwind animate-* classes)
   ============================================================================= */

@keyframes spin {
  to {
    transform: rotate(360deg);
  }
}

/* =============================================================================
   Day 23+ Utility Layers
   ============================================================================= */

@import "./styles/animations.css";
@import "./styles/layout.css";
```

### src/styles/animations.css
```
/**
 * MindMosaic â€” Animation Utilities
 *
 * Centralized animation keyframes for consistent motion across the app.
 * Import this file in index.css AFTER the @theme block.
 *
 * Usage in components:
 *   className="animate-slide-up"
 *   className="animate-fade-in"
 *   className="animate-shake"
 *
 * These are defined via @theme so Tailwind generates the utility classes.
 */

/* =============================================================================
   Animation Keyframes
   ============================================================================= */

@keyframes slide-up {
  from {
    opacity: 0;
    transform: translateY(8px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

@keyframes fade-in {
  from {
    opacity: 0;
  }
  to {
    opacity: 1;
  }
}

@keyframes shake {
  0%,
  100% {
    transform: translateX(0);
  }
  20%,
  60% {
    transform: translateX(-4px);
  }
  40%,
  80% {
    transform: translateX(4px);
  }
}

@keyframes pulse-soft {
  0%,
  100% {
    opacity: 1;
  }
  50% {
    opacity: 0.7;
  }
}

/* =============================================================================
   Tailwind v4 Animation Token Registration
   
   These register as animate-* utilities via @theme.
   ============================================================================= */

@theme {
  --animate-slide-up: slide-up 0.3s ease-out both;
  --animate-fade-in: fade-in 0.3s ease-out both;
  --animate-shake: shake 0.4s ease-in-out;
  --animate-pulse-soft: pulse-soft 2s ease-in-out infinite;
}

/* =============================================================================
   Utility: Staggered children
   
   Apply to a parent container to stagger child animations.
   Usage: <div className="stagger-children"> ... </div>
   Each direct child gets a progressively longer delay.
   ============================================================================= */

.stagger-children > :nth-child(1) {
  animation-delay: 0ms;
}
.stagger-children > :nth-child(2) {
  animation-delay: 50ms;
}
.stagger-children > :nth-child(3) {
  animation-delay: 100ms;
}
.stagger-children > :nth-child(4) {
  animation-delay: 150ms;
}
.stagger-children > :nth-child(5) {
  animation-delay: 200ms;
}
.stagger-children > :nth-child(6) {
  animation-delay: 250ms;
}

/* =============================================================================
   Reduced motion: respect user preferences
   ============================================================================= */

@media (prefers-reduced-motion: reduce) {
  *,
  *::before,
  *::after {
    animation-duration: 0.01ms !important;
    animation-iteration-count: 1 !important;
    transition-duration: 0.01ms !important;
  }
}
```

### src/styles/index.css
```
/**
 * DEPRECATED â€” This file is not imported by the application.
 *
 * All CSS entry loading is handled by src/index.css, which imports:
 *   - tailwindcss
 *   - @theme tokens
 *   - ./styles/animations.css
 *   - ./styles/layout.css
 *
 * Do not add CSS here. It will not be loaded.
 */
```

### src/styles/layout.css
```
/**
 * MindMosaic â€” Layout Utilities
 *
 * Consistent spacing and container classes used across the app.
 * Import this file in index.css AFTER the @theme block.
 *
 * Usage:
 *   className="layout-container"     â†’ centered max-width container
 *   className="section-padding"      â†’ consistent vertical section spacing
 *   className="card-base"            â†’ standard card with border, radius, shadow
 *   className="card-base-interactive"â†’ card with hover effect
 */

/* =============================================================================
   Layout Container
   ============================================================================= */

.layout-container {
  width: 100%;
  max-width: 72rem; /* 1152px */
  margin-left: auto;
  margin-right: auto;
  padding-left: 1.5rem;
  padding-right: 1.5rem;
}

@media (min-width: 640px) {
  .layout-container {
    padding-left: 2rem;
    padding-right: 2rem;
  }
}

/* =============================================================================
   Section Padding
   ============================================================================= */

.section-padding {
  padding-top: 3rem;
  padding-bottom: 3rem;
}

@media (min-width: 640px) {
  .section-padding {
    padding-top: 5rem;
    padding-bottom: 5rem;
  }
}

/* =============================================================================
   Card Base
   ============================================================================= */

.card-base {
  background-color: white;
  border-radius: 1rem; /* rounded-2xl */
  border: 1px solid var(--color-border-subtle, #d8e2f3);
  box-shadow: 0 1px 2px 0 rgb(0 0 0 / 0.05); /* shadow-sm */
}

.card-base-interactive {
  background-color: white;
  border-radius: 1rem;
  border: 1px solid var(--color-border-subtle, #d8e2f3);
  box-shadow: 0 1px 2px 0 rgb(0 0 0 / 0.05);
  transition: box-shadow 0.15s ease;
}

.card-base-interactive:hover {
  box-shadow:
    0 4px 6px -1px rgb(0 0 0 / 0.1),
    0 2px 4px -2px rgb(0 0 0 / 0.1);
}

/* =============================================================================
   Touch Target Minimum
   
   Apply to any interactive element that might be too small.
   Ensures 36px minimum hit area without changing visual size.
   ============================================================================= */

.touch-target {
  position: relative;
  min-height: 2.25rem; /* 36px */
  min-width: 2.25rem;
}

.touch-target::after {
  content: "";
  position: absolute;
  inset: -4px;
}

/* =============================================================================
   Focus Ring (accessibility)
   
   Consistent focus-visible ring across the app.
   Applied automatically to interactive elements.
   ============================================================================= */

.focus-ring:focus-visible {
  outline: 2px solid var(--color-primary-blue, #1d4ed8);
  outline-offset: 2px;
  border-radius: inherit;
}
```

## Notes
- Backend contracts must remain unchanged.
- Exam scoring and persistence are deterministic.
- Frontend revamp only.
